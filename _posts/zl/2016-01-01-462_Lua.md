---
layout: post
title: Lua 
tags: [lua文章]
categories: [topic]
---
<h2 id="简单模式和完全模式"><a href="#简单模式和完全模式" class="headerlink" title="简单模式和完全模式"></a>简单模式和完全模式</h2><ul>
<li>简单模式（simple model）拥有一个当前输入文件和一个当前输出文件，并且提供针对这些文件相关的操作。</li>
<li>完全模式（complete model） 使用外部的文件句柄来实现。它以一种面对对象的形式，将所有的文件操作定义为文件句柄的方法。</li>
</ul>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(filename [, mode])</span><br/></pre></td></tr></tbody></table></figure>

<p>mode 选项</p>
<table>
<thead>
<tr>
<th align="center">模式</th>
<th align="left">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">r</td>
<td align="left">只读，文件必须存在。默认。</td>
</tr>
<tr>
<td align="center">w</td>
<td align="left">只写，文件存在，则写入时覆盖原有内容。文件不存在，则创建文件。</td>
</tr>
<tr>
<td align="center">a</td>
<td align="left">附加写入，文件存在，则从文件末尾写入。文件不存在，则创建文件。</td>
</tr>
<tr>
<td align="center">b</td>
<td align="left">二进制模式，与r/w/a结合使用。</td>
</tr>
<tr>
<td align="center">+</td>
<td align="left">表示文件可读写，与r/w/a结合使用。</td>
</tr>
</tbody></table>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line">file01 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r&#34;</span>)</span><br/><span class="line">file02 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;rb&#34;</span>)</span><br/><span class="line">file03 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;w&#34;</span>)</span><br/><span class="line">file04 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;wb&#34;</span>)</span><br/><span class="line">file05 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;a&#34;</span>)</span><br/><span class="line">file06 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;ab&#34;</span>)</span><br/><span class="line">file07 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r+&#34;</span>)</span><br/><span class="line">file08 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r+b&#34;</span>)</span><br/><span class="line">file09 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;w+&#34;</span>)</span><br/><span class="line">file10 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;w+b&#34;</span>)</span><br/><span class="line">file11 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;a+&#34;</span>)</span><br/><span class="line">file12 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;a+b&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="从文件读取数据"><a href="#从文件读取数据" class="headerlink" title="从文件读取数据"></a>从文件读取数据</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">file01 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r&#34;</span>)</span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>(file01)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;简单模式读取的文件内容:n&#34;</span>..<span class="built_in">io</span>.<span class="built_in">read</span>())</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 完全模式</span></span><br/><span class="line">file02 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r&#34;</span>)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;完全模式读取的文件内容:n&#34;</span>..file02:<span class="built_in">read</span>())</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 关闭文件流</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>()</span><br/><span class="line">file02:<span class="built_in">close</span>()</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="向文件写入数据"><a href="#向文件写入数据" class="headerlink" title="向文件写入数据"></a>向文件写入数据</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">file01 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;a&#34;</span>)</span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">output</span>(file01)</span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&#34;-- 这是一行简单模式写入的文本。&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 完全模式</span></span><br/><span class="line">file02 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;a&#34;</span>)</span><br/><span class="line">file02:<span class="built_in">write</span>(<span class="string">&#34;-- 这是一行完全模式写入的文本。&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 关闭文件流</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file01)</span><br/><span class="line">file02:<span class="built_in">close</span>()</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="关闭文件"><a href="#关闭文件" class="headerlink" title="关闭文件"></a>关闭文件</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line">file01 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r&#34;</span>)</span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>(file01)</span><br/><span class="line">file02 = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#34;test.lua&#34;</span>, <span class="string">&#34;r&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file01)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 完全模式</span></span><br/><span class="line">file02:<span class="built_in">close</span>()</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="简单模式，io的方法"><a href="#简单模式，io的方法" class="headerlink" title="简单模式，io的方法"></a>简单模式，io的方法</h3><p>调用方式：io.方法名()。如：io.read()</p>
<ol>
<li>read()</li>
</ol>
<p>输入文件一行数据，并把游标指向下一行开始地址。</p>
<p>参数：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">“*l”</td>
<td align="left">读取下一行，在文件尾 (EOF) 处返回 nil。默认。</td>
</tr>
<tr>
<td align="center">“*n”</td>
<td align="left">读取一个数字并返回它。</td>
</tr>
<tr>
<td align="center">“*a”</td>
<td align="left">从当前位置读取整个文件。</td>
</tr>
<tr>
<td align="center">number</td>
<td align="left">返回一个指定字符个数的字符串，或在 EOF 时返回 nil。</td>
</tr>
</tbody></table>
<ol start="2">
<li>tmpfile()</li>
</ol>
<p>返回一个临时文件句柄，该文件以更新模式（附加）打开，程序结束时自动删除。</p>
<ol start="3">
<li>type(file)</li>
</ol>
<p>检测file是否一个可用的文件句柄。</p>
<ol start="4">
<li>flush()</li>
</ol>
<p>向文件写入缓冲中的所有数据。</p>
<ol start="5">
<li>lines(optional filename)</li>
</ol>
<p>打开指定的文件filename为只读模式并返回一个迭代函数,每次调用将获得文件中的一行内容,当到文件尾时，将返回nil,并自动关闭文件。</p>
<p>若不带参数时io.lines() io.input():lines(); 读取默认输入设备的内容，但结束时不关闭文件</p>
<h3 id="完全模式，文件句柄的方法"><a href="#完全模式，文件句柄的方法" class="headerlink" title="完全模式，文件句柄的方法"></a>完全模式，文件句柄的方法</h3><p>调用方式：文件句柄:方法名()。如：file:read()。</p>
<ol>
<li>read()</li>
</ol>
<p>作用和参数与简单模式一致。</p>
<ol start="2">
<li>seek(optional whence, optional offset)</li>
</ol>
<p>设置和获取当前文件位置,成功则返回最终的文件位置(按字节),失败则返回nil加错误信息。</p>
<p>参数 whence 取值：</p>
<table>
<thead>
<tr>
<th align="center">值</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">“cur”</td>
<td align="left">从当前位置开始。默认</td>
</tr>
<tr>
<td align="center">“set”</td>
<td align="left">从文件头开始</td>
</tr>
<tr>
<td align="center">“end”</td>
<td align="left">从文件尾开始</td>
</tr>
</tbody></table>
<p>offset，偏移量，默认为0。</p>
<p>不带参数file:seek()则返回当前位置。<br/>file:seek(“set”)则定位到文件头。<br/>file:seek(“end”)则定位到文件尾并返回文件大小。</p>
<ol start="3">
<li>flush()</li>
</ol>
<p>向文件写入缓冲中的所有数据。</p>