---
layout: post
title: Lua 学习 chapter6  
tags: [lua文章]
categories: [topic]
---


                
                

				<h3 id="目录">目录</h3>
<ol>
  <li>函数</li>
  <li>多个返回值</li>
  <li>可变长函数参数</li>
  <li>
    
  </li>
</ol>

<h2 id="函数">函数</h2>
<p>在lua中，函数是对语句和表达式抽象的主要方式。函数的调用需要一对空括号，里面放着参数。唯一的例外就是当参数只有一个且该参数是字符串或表构造器。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nb">print</span> <span class="s">[[a multi-line
message]]</span>   
<span class="cm">--[[&gt;print([[a multi-line
              message]])]]</span>

<span class="n">f</span><span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">}</span> <span class="c1">--&gt;f({x=10,y=3})</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>lua函数是存在语法糖的，即使用冒号来调用函数会把第一个参数默认认为是调用对象本身</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">o</span><span class="p">:</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1">--&gt;其中x就是o对象</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在lua进程中调用Lua语言编写的函数和用c编写的函数方式是一样的，没有任何区别。</p>

<p>在lua中，调用函数使用的参数个数可以和定义函数使用的参数个数不一致，当传入参数的个数大于定义的时候后面没有用到的参数就会被舍弃，当传入的参数个数少的时候，后面的参数就会被默认为nil。</p>

<h2 id="多个返回值">多个返回值</h2>
<p>在lua函数中，它允许一个函数返回多个返回值。
函数定义返回多个返回值，但是在调用的时候lua会根据被调用情况调整返回值的个数。</p>
<ol>
  <li>当函数被作为一条单独语句调用的时候，其所有的返回值都将被舍弃。</li>
  <li>当函数被作为表达式调用时，将只保留第一个返回值。</li>
  <li>当函数调用时一系列表达式中的最后一个表达式时，其所有的返回值才能被获取到。</li>
  <li>当函数调用是另一个函数调用的最后一个表达式时能返回多个值，否则只能返回一个值。</li>
  <li>将函数调用用一对圆括号括起来可以强制其只返回一个结果。</li>
</ol>

<h2 id="可变长函数参数">可变长函数参数</h2>
<p>lua语言中的函数是可边长函数参数，参数列表中的三个点表示该函数是可变长的。
当函数访问这个可变长参数的时候可以将其视作一个表达式。它的放回结果就是各个参数，当然要对其访问的时候，也可以通过表构造器来访问。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">v</span> <span class="k">in</span> <span class="nb">ipairs</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="k">do</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">v</span>
	<span class="k">end</span>
	<span class="kd">local</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="o">...</span>
	<span class="k">return</span> <span class="n">s</span>
<span class="k">end</span>


</pre></td></tr></tbody></table></code></pre></div></div>

<p>函数也可以由固定参数加可变参数，但是可变参数一定要在固定参数的后面。</p>

<p>在上面的例子中，直接使用表构造器还是存在问题的，如果中间存在nil表就不是连续的了，对于这种情况跟lua提供了函数<strong>table.pack</strong>，
该函数像{…}保存所有的参数，然后将其放在一个表中范慧慧，但是这个表还有一个保存了参数个数的额外字段 <strong>n</strong> 。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">nonils</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">arg</span> <span class="o">=</span> <span class="nb">table.pack</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">n</span> <span class="k">do</span>
		<span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
	<span class="k">end</span>
	<span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>可以使用上面的方法来判断参数是否存在空。</p>

<p>在lua中还有一个函数select，函数select总是存在一个固定参数selector和数量可变的参数，如果selector是数值n，则select函数返回n(包含n)之后的所有参数。否则selector应该是字符串”#”，select返回额外参数的总数。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">print</span><span class="p">(</span><span class="nb">select</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">))</span> <span class="c1">--&gt;a b c</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">select</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">))</span> <span class="c1">--&gt;b c</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">select</span><span class="p">(</span><span class="s2">"#"</span><span class="p">,</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">))</span> <span class="c1">--&gt;3</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>与pack相对应，table.unpack的参数是一个数组，返回值为数组内的所有元素。
顾名思义，pack将参数列表转换成一张表，而unpack将表转换成一组返回值。
如果有需要也可以显示的限制返回值的范围：</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">print</span><span class="p">(</span><span class="nb">table.unpack</span><span class="p">({</span><span class="s2">"M"</span><span class="p">,</span><span class="s2">"T"</span><span class="p">,</span><span class="s2">"Tu"</span><span class="p">,</span><span class="s2">"W"</span><span class="p">},</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="c1">--&gt; T  Tu</span>
</pre></td></tr></tbody></table></code></pre></div></div>



                
                
                <hr style="visibility: hidden;">