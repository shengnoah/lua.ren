---
layout: post
title: Lua语言学习 
tags: [lua文章]
categories: [topic]
---
<h2 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h2>
<h3 id="网上教程"><a href="#网上教程" class="headerlink" title="网上教程"></a>网上教程</h3><p><a href="http://coolshell.cn/articles/10739.html" target="_blank" rel="noopener noreferrer">Lua简明教程</a></p>
<p><a href="http://wiki.jikexueyuan.com/project/openresty/" target="_blank" rel="noopener noreferrer">极客学院Openresty教程</a></p>
<p><a href="http://wiki.jikexueyuan.com/project/openresty/openresty/install.html" target="_blank" rel="noopener noreferrer">Windows安装</a></p>
<p>使用 <code>tasklist /fi &#34;imagename eq nginx.exe&#34;</code> 命令查看 nginx 进程，其中一个是 master 进程，另一个是 worker 进程</p>
<p>cmd进入nginx的安装目录，输入<code>start nginx.exe</code>来启动nginx</p>
<p>cmd进入nginx的安装目录，输入<code>nginx -s reload</code>来重启nginx</p>
<h3 id="LuaJIT部分语法"><a href="#LuaJIT部分语法" class="headerlink" title="LuaJIT部分语法"></a>LuaJIT部分语法</h3><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line">wget http://luajit.org/download/LuaJIT-2.1.0-beta1.tar.gz</span><br/><span class="line">tar -xvf LuaJIT-2.1.0-beta1.tar.gz</span><br/><span class="line">cd LuaJIT-2.1.0-beta1</span><br/><span class="line">make</span><br/><span class="line">sudo make install</span><br/><span class="line"></span><br/><span class="line">luajit -v</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="基础数据类型"><a href="#基础数据类型" class="headerlink" title="基础数据类型"></a>基础数据类型</h4><p>nil</p>
<p>无效值</p>
<p>boolean</p>
<p><code>false</code>和<code>nil</code>为假，其余包括0全部为真。</p>
<p>number</p>
<p>实数类型，可以用<code>math.floor</code>向下取整和<code>math.cell</code>向上取整。</p>
<p>string</p>
<p><code>&#39;abc&#39;</code>，<code>&#34;abc&#34;</code>，<code>[=[abcn]=]</code>(不转义)</p>
<p>字符串不可改变，只能新建，相同字符串在内存中只有一个副本</p>
<p>table</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> corp = {</span><br/><span class="line">    web = <span class="string">&#34;www.google.com&#34;</span>,   </span><br/><span class="line">                              <span class="comment">--            value = &#34;www.google.com&#34;</span></span><br/><span class="line">    telephone = <span class="string">&#34;12345678&#34;</span>,   <span class="comment">--索引为字符串</span></span><br/><span class="line">    staff = {<span class="string">&#34;Jack&#34;</span>, <span class="string">&#34;Scott&#34;</span>, <span class="string">&#34;Gary&#34;</span>}, <span class="comment">--索引为字符串，值也是一个表</span></span><br/><span class="line">    <span class="number">100876</span>,              <span class="comment">--相当于 [1] = 100876，此时索引为数字</span></span><br/><span class="line">                         <span class="comment">--      key = 1, value = 100876</span></span><br/><span class="line">    <span class="number">100191</span>,              <span class="comment">--相当于 [2] = 100191，此时索引为数字</span></span><br/><span class="line">    [<span class="number">10</span>] = <span class="number">360</span>,          <span class="comment">--直接把数字索引给出</span></span><br/><span class="line">    [<span class="string">&#34;city&#34;</span>] = <span class="string">&#34;Beijing&#34;</span> <span class="comment">--索引为字符串</span></span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(corp.web)               <span class="comment">--&gt;output:www.google.com</span></span><br/><span class="line"><span class="built_in">print</span>(corp[<span class="string">&#34;telephone&#34;</span>])      <span class="comment">--&gt;output:12345678</span></span><br/><span class="line"><span class="built_in">print</span>(corp[<span class="number">2</span>])                <span class="comment">--&gt;output:100191</span></span><br/><span class="line"><span class="built_in">print</span>(corp[<span class="string">&#34;city&#34;</span>])           <span class="comment">--&gt;output:&#34;Beijing&#34;</span></span><br/><span class="line"><span class="built_in">print</span>(corp.staff[<span class="number">1</span>])          <span class="comment">--&gt;output:Jack</span></span><br/><span class="line"><span class="built_in">print</span>(corp[<span class="number">10</span>])               <span class="comment">--&gt;output:360</span></span><br/></pre></td></tr></tbody></table></figure>
<p>function</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">foo = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><p><code>a and b</code> 如果<code>a</code>为nil，则返回a，否则返回b<br/><code>a or b</code> 如果<code>a</code>为nil，则返回b，否则返回a<br/><code>not a</code> 返回true or false</p>
<p>字符串拼接</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#34;Hello &#34;</span> .. <span class="string">&#34;World&#34;</span>)    <span class="comment">--&gt;打印 Hello World</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">0</span> .. <span class="number">1</span>)                 <span class="comment">--&gt;打印 01 自动将数字转化为string</span></span><br/><span class="line"></span><br/><span class="line">str1 = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&#34;%s-%s&#34;</span>,<span class="string">&#34;hello&#34;</span>,<span class="string">&#34;world&#34;</span>)</span><br/><span class="line"><span class="built_in">print</span>(str1)              <span class="comment">--&gt;打印 hello-world</span></span><br/><span class="line"></span><br/><span class="line">str2 = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&#34;%d-%s-%.2f&#34;</span>,<span class="number">123</span>,<span class="string">&#34;world&#34;</span>,<span class="number">1.21</span>)</span><br/><span class="line"><span class="built_in">print</span>(str2)              <span class="comment">--&gt;打印 123-world-1.21</span></span><br/></pre></td></tr></tbody></table></figure>
<p>字符串拼接会不断的创建新字符串，若在循环中进行拼接，则对性能有较大影响，推荐使用<code>table.concat()</code></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> pieces = {}</span><br/><span class="line"><span class="keyword">for</span> i, elem <span class="keyword">in</span> <span class="built_in">ipairs</span>(my_list) <span class="keyword">do</span></span><br/><span class="line">    pieces[i] = my_process(elem)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="keyword">local</span> res = <span class="built_in">table</span>.<span class="built_in">concat</span>(pieces)</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h4><p>if</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br/><span class="line"><span class="keyword">if</span> x &gt; <span class="number">0</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;x is a positive number&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>if-else</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br/><span class="line"><span class="keyword">if</span> x &gt; <span class="number">0</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;x is a positive number&#34;</span>)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;x is a non-positive number&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>if-elseif-else</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line">score = <span class="number">90</span></span><br/><span class="line"><span class="keyword">if</span> score == <span class="number">100</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;Very good!Your score is 100&#34;</span>)</span><br/><span class="line"><span class="keyword">elseif</span> score &gt;= <span class="number">60</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;Congratulations, you have passed it,your score greater or equal to 60&#34;</span>)</span><br/><span class="line"><span class="comment">--此处可以添加多个elseif</span></span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;Sorry, you do not pass the exam! &#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>嵌套if</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line">score = <span class="number">0</span></span><br/><span class="line"><span class="keyword">if</span> score == <span class="number">100</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;Very good!Your score is 100&#34;</span>)</span><br/><span class="line"><span class="keyword">elseif</span> score &gt;= <span class="number">60</span> <span class="keyword">then</span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;Congratulations, you have passed it,your score greater or equal to 60&#34;</span>)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">    <span class="keyword">if</span> score &gt; <span class="number">0</span> <span class="keyword">then</span></span><br/><span class="line">        <span class="built_in">print</span>(<span class="string">&#34;Your score is better than 0&#34;</span>)</span><br/><span class="line">    <span class="keyword">else</span></span><br/><span class="line">        <span class="built_in">print</span>(<span class="string">&#34;My God, your score turned out to be 0&#34;</span>)</span><br/><span class="line">    <span class="keyword">end</span> <span class="comment">--与上一示例代码不同的是，此处要添加一个end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>while</p>
<p>有<code>break</code>，无<code>continue</code></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 表达式 <span class="keyword">do</span></span><br/><span class="line"><span class="comment">--body</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>repeat</p>
<p>一直执行，直到<code>条件</code>为真</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br/><span class="line">    body</span><br/><span class="line"><span class="keyword">until</span> 条件</span><br/></pre></td></tr></tbody></table></figure>
<p>for</p>
<p>数字 for（numeric for）</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var = begin, finish, step <span class="keyword">do</span></span><br/><span class="line">    <span class="comment">--body</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">5</span> <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(i)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- output:</span></span><br/><span class="line"><span class="number">1</span></span><br/><span class="line"><span class="number">2</span></span><br/><span class="line"><span class="number">3</span></span><br/><span class="line"><span class="number">4</span></span><br/><span class="line"><span class="number">5</span></span><br/></pre></td></tr></tbody></table></figure>
<ol>
<li>var从begin取到finish，左右都为闭区间</li>
<li>begin、finish、step 三个表达式只会在循环开始时执行一次</li>
<li>第三个表达式 step 是可选的，默认为 1</li>
<li>控制变量 var 的作用域仅在 for 循环内，需要在外面控制，则需将值赋给一个新的变量</li>
</ol>
<p>范型 for（generic for）</p>
<p>泛型 for 循环通过一个迭代器（iterator）函数来遍历所有值：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 打印数组a的所有值</span></span><br/><span class="line"><span class="keyword">local</span> a = {<span class="string">&#34;a&#34;</span>, <span class="string">&#34;b&#34;</span>, <span class="string">&#34;c&#34;</span>, <span class="string">&#34;d&#34;</span>}</span><br/><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;index:&#34;</span>, i, <span class="string">&#34; value:&#34;</span>, v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- output:</span></span><br/><span class="line">index:  <span class="number">1</span>  value: a</span><br/><span class="line">index:  <span class="number">2</span>  value: b</span><br/><span class="line">index:  <span class="number">3</span>  value: c</span><br/><span class="line">index:  <span class="number">4</span>  value: d</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 打印table t中所有的key</span></span><br/><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(k)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">function_name</span> <span class="params">(arc)</span></span>  <span class="comment">-- arc 表示参数列表，函数的参数列表可以为空</span></span><br/><span class="line">   <span class="comment">-- body</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>Lua函数的参数大部分是按<strong>值</strong>传递的，只有传入一个<strong>表table</strong>时，会进行<strong>引用</strong>传递。</p>
<p>参数补齐</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">fun1</span><span class="params">(a, b)</span></span>       <span class="comment">--两个形参，多余的实参被忽略掉</span></span><br/><span class="line">   <span class="built_in">print</span>(a, b)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">fun2</span><span class="params">(a, b, c, d)</span></span> <span class="comment">--四个形参，没有被实参初始化的形参，用nil初始化</span></span><br/><span class="line">   <span class="built_in">print</span>(a, b, c, d)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> x = <span class="number">1</span></span><br/><span class="line"><span class="keyword">local</span> y = <span class="number">2</span></span><br/><span class="line"><span class="keyword">local</span> z = <span class="number">3</span></span><br/><span class="line"></span><br/><span class="line">fun1(x, y, z)         <span class="comment">-- z被函数fun1忽略掉了，参数变成 x, y</span></span><br/><span class="line">fun2(x, y, z)         <span class="comment">-- 后面自动加上一个nil，参数变成 x, y, z, nil</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--&gt;output</span></span><br/><span class="line"><span class="number">1</span>   <span class="number">2</span></span><br/><span class="line"><span class="number">1</span>   <span class="number">2</span>   <span class="number">3</span>   ni</span><br/></pre></td></tr></tbody></table></figure>
<p>变长参数</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">( ... )</span></span>                <span class="comment">-- 形参为 ... ,表示函数采用变长参数</span></span><br/><span class="line"></span><br/><span class="line">   <span class="keyword">local</span> temp = {...}                     <span class="comment">-- 访问的时候也要使用 ...</span></span><br/><span class="line">   <span class="keyword">local</span> ans = <span class="built_in">table</span>.<span class="built_in">concat</span>(temp, <span class="string">&#34; &#34;</span>)    <span class="comment">-- 使用 table.concat 库函数对数</span></span><br/><span class="line">                                          <span class="comment">-- 组内容使用 &#34; &#34; 拼接成字符串。</span></span><br/><span class="line">   <span class="built_in">print</span>(ans)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">func(<span class="number">1</span>, <span class="number">2</span>)        <span class="comment">-- 传递了两个参数</span></span><br/><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment">-- 传递了四个参数</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--&gt;output</span></span><br/><span class="line"><span class="number">1</span> <span class="number">2</span></span><br/><span class="line"></span><br/><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br/></pre></td></tr></tbody></table></figure>
<p>返回值</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span>       <span class="comment">-- init 函数 返回两个值 1 和 &#34;lua&#34;</span></span><br/><span class="line">    <span class="keyword">return</span> <span class="number">1</span>, <span class="string">&#34;lua&#34;</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> x, y, z = init(), <span class="number">2</span>   <span class="comment">-- init 函数的位置不在最后，此时只返回 1</span></span><br/><span class="line"><span class="built_in">print</span>(x, y, z)              <span class="comment">--&gt;output  1  2  nil</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> a, b, c = <span class="number">2</span>, init()   <span class="comment">-- init 函数的位置在最后，此时返回 1 和 &#34;lua&#34;</span></span><br/><span class="line"><span class="built_in">print</span>(a, b, c)              <span class="comment">--&gt;output  2  1  lua</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 使用括号运算符</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>((init()), <span class="number">2</span>)   <span class="comment">--&gt;output  1  2</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">2</span>, (init()))   <span class="comment">--&gt;output  2  1</span></span><br/></pre></td></tr></tbody></table></figure>
<p>全动态函数调用</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">(x, y)</span></span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#39;run&#39;</span>, x, y)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">attack</span><span class="params">(targetId)</span></span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#39;targetId&#39;</span>, targetId)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">do_action</span><span class="params">(method, ...)</span></span></span><br/><span class="line">    <span class="keyword">local</span> args = {...} <span class="keyword">or</span> {}</span><br/><span class="line">    method(<span class="built_in">unpack</span>(args, <span class="number">1</span>, <span class="built_in">table</span>.<span class="built_in">maxn</span>(args)))</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">do_action(run, <span class="number">1</span>, <span class="number">2</span>)         <span class="comment">-- output: run 1 2</span></span><br/><span class="line">do_action(attack, <span class="number">1111</span>)      <span class="comment">-- output: targetId    1111</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><p>my.lua</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> foo={}</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getname</span><span class="params">()</span></span></span><br/><span class="line">    <span class="keyword">return</span> <span class="string">&#34;Lucy&#34;</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo.greeting</span><span class="params">()</span></span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;hello &#34;</span> .. getname())</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">return</span> foo</span><br/></pre></td></tr></tbody></table></figure>
<p>main.lua</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> fp = <span class="built_in">require</span>(<span class="string">&#34;my&#34;</span>)</span><br/><span class="line">fp.greeting()     <span class="comment">--&gt;output: hello Lucy</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="String库"><a href="#String库" class="headerlink" title="String库"></a>String库</h4><p>string.byte</p>
<p>返回ASCII码</p>
<p>用该函数来进行字符串相关的扫描和分析是最为高效的</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&#34;abc&#34;</span>, <span class="number">1</span>, <span class="number">3</span>))</span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&#34;abc&#34;</span>, <span class="number">3</span>)) <span class="comment">-- 缺少第三个参数，第三个参数默认与第二个相同，此时为 3</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&#34;abc&#34;</span>))    <span class="comment">-- 缺少第二个和第三个参数，此时这两个参数都默认为 1</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--&gt;output</span></span><br/><span class="line"><span class="number">97</span>  <span class="number">98</span>  <span class="number">99