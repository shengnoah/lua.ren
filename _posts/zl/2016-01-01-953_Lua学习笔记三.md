---
layout: post
title: Lua学习笔记三 
tags: [lua文章]
categories: [topic]
---
<p>Lua中可以用三种方式定义字符串：</p>
<ul>
<li>单引号   ‘hello world’</li>
<li>双引号  “heool world”</li>
<li>[[ ]]   [[hello world]]</li>
</ul>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">upper</span>(<span class="string">&#34;hello world&#34;</span>)) <span class="comment">--HELLO WORLD</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.lower(str)转小写</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">lower</span>(<span class="string">&#34;HELLO WORLD&#34;</span>)) <span class="comment">--hello world</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--[[string.gsub(mainStr,findStr,replaceStr,num)字符串替换，返回替换后的字符串和替换的次数</span></span><br/><span class="line"><span class="comment">   mainStr 整个需要被替换的字符串</span></span><br/><span class="line"><span class="comment">   findStr 要被替换的部分</span></span><br/><span class="line"><span class="comment">   replaceStr 新的字符串</span></span><br/><span class="line"><span class="comment">   要替换的数量，不填就是替换所有</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">gsub</span>(<span class="string">&#34;aaaa&#34;</span>,<span class="string">&#34;a&#34;</span>,<span class="string">&#34;b&#34;</span>,<span class="number">3</span>)) <span class="comment">--bbba	3</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.find()在一个指定的目标字符串中搜索指定的内容(第三个参数为索引,从第几个开始查找),返回其具体位置（从开始的第一个）。不存在则返回 nil</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">&#34;hello world&#34;</span>,<span class="string">&#34;o&#34;</span>,<span class="number">6</span>)) <span class="comment">--结果 8   8</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.reverse()字符串反转</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">reverse</span>(<span class="string">&#34;hello&#34;</span>))	</span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.format() 字符串格式化</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&#34;the value is:%d&#34;</span>,<span class="number">4</span>)) <span class="comment">--the value is:4</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.char()转成字符串 string.byte() 转成整数值（指定某个位置，不知道默认第一个）</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">char</span>(<span class="number">97</span>,<span class="number">98</span>,<span class="number">99</span>,<span class="number">100</span>)) <span class="comment">-- abcd</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&#34;abcd&#34;</span>)) <span class="comment">--97</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&#34;abcd&#34;</span>,<span class="number">2</span>))  <span class="comment">--98  第二个字母转成整数值 </span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.len(&#34;abcd&#34;) 字符串长度</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">len</span>(<span class="string">&#34;abcd&#34;</span>)) <span class="comment">--4</span></span><br/><span class="line"><span class="built_in">print</span>(#<span class="string">&#34;abcd&#34;</span>)  <span class="comment">--4</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.rep(&#34;&#34;,n) 字符串的n次拷贝</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">rep</span>(<span class="string">&#34;abcd&#34;</span>,<span class="number">2</span>)) <span class="comment">--abcdabcd</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- .. 字符串拼接</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;abc&#34;</span>..<span class="string">&#34;d&#34;</span>) <span class="comment">--abcd </span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.gmatch(str, pattern) 回一个迭代器函数，每一次调用这个函数，返回一个在字符串 str 找到的下一个符合 pattern 描述的子串</span></span><br/><span class="line"><span class="keyword">for</span> world <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(<span class="string">&#34;Hi hello world&#34;</span>,<span class="string">&#34;%a+&#34;</span>) <span class="keyword">do</span></span><br/><span class="line">	<span class="built_in">print</span>(world)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">--[[ 结果</span></span><br/><span class="line"><span class="comment">Hi</span></span><br/><span class="line"><span class="comment">hello</span></span><br/><span class="line"><span class="comment">world</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--string.match(str, pattern, init)只寻找源字串str中的第一个配对. 参数init可选, 指定搜寻过程的起点, 默认为1。</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">match</span>(<span class="string">&#34;I have 2 questions for you.&#34;</span>, <span class="string">&#34;%d+ %a+&#34;</span>)) <span class="comment">--2 questions</span></span><br/></pre></td></tr></tbody></table></figure>
<h1 id="Lua数组"><a href="#Lua数组" class="headerlink" title="Lua数组"></a>Lua数组</h1><h2 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h2><p>Lua中数组索引从1开始</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">array = {<span class="string">&#34;hello&#34;</span>,<span class="string">&#34;world&#34;</span>}</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">0</span>,<span class="number">2</span> <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(array[i])</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>结果：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="literal">nil</span></span><br/><span class="line">hello</span><br/><span class="line">world</span><br/></pre></td></tr></tbody></table></figure>
<p>可以以负数作为数组的索引：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">array = {}</span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">-1</span>,<span class="number">2</span> <span class="keyword">do</span></span><br/><span class="line">	array[i] = i</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> array = {}</span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">	array[i] = {}</span><br/><span class="line">	<span class="keyword">for</span> j = <span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">		array[i][j] = i * j</span><br/><span class="line">	<span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><h2 id="泛型for迭代器"><a href="#泛型for迭代器" class="headerlink" title="泛型for迭代器"></a>泛型for迭代器</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">table</span>) <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<blockquote>
<p>泛型 for 在自己内部保存迭代函数，实际上它保存三个值：迭代函数、状态常量、控制变量</p>
</blockquote>
<h2 id="无状态的迭代器"><a href="#无状态的迭代器" class="headerlink" title="无状态的迭代器"></a>无状态的迭代器</h2><p>无状态的迭代器是指不保留任何状态的迭代器</p>
<h2 id="多状态的迭代器"><a href="#多状态的迭代器" class="headerlink" title="多状态的迭代器"></a>多状态的迭代器</h2><p>可以通过闭包来实现</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/></pre></td><td class="code"><pre><span class="line">array = {<span class="string">&#34;Google&#34;</span>, <span class="string">&#34;Runoob&#34;</span>}</span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span>  <span class="params">(collection)</span></span></span><br/><span class="line">   <span class="keyword">local</span> index = <span class="number">0</span></span><br/><span class="line">   <span class="keyword">local</span> count = #collection</span><br/><span class="line">   <span class="comment">-- 闭包函数</span></span><br/><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br/><span class="line">      index = index + <span class="number">1</span></span><br/><span class="line">      <span class="keyword">if</span> index &lt;= count</span><br/><span class="line">      <span class="keyword">then</span></span><br/><span class="line">         <span class="comment">--  返回迭代器的当前元素</span></span><br/><span class="line">         <span class="keyword">return</span> collection[index]</span><br/><span class="line">      <span class="keyword">end</span></span><br/><span class="line">   <span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elementIterator(array)</span><br/><span class="line"><span class="keyword">do</span></span><br/><span class="line">   <span class="built_in">print</span>(element)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h1 id="table"><a href="#table" class="headerlink" title="table"></a>table</h1><blockquote>
<p>table 是 Lua 的一种数据结构用来帮助我们创建不同的数据类型，如：数组、字典等。</p>
</blockquote>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 初始化表</span></span><br/><span class="line"><span class="built_in">table</span> = {}</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 指定值</span></span><br/><span class="line"><span class="built_in">table</span>[<span class="number">1</span>]= <span class="string">&#34;Lua&#34;</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 移除引用</span></span><br/><span class="line"><span class="built_in">table</span> = <span class="literal">nil</span></span><br/><span class="line"><span class="comment">-- lua 垃圾回收会释放内存</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="table的操作"><a href="#table的操作" class="headerlink" title="table的操作"></a>table的操作</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/></pre></td><td class="code"><pre><span class="line">t = {<span class="string">&#34;aaa&#34;</span>,<span class="string">&#34;bbb&#34;</span>,<span class="string">&#34;ccc&#34;</span>}</span><br/><span class="line"><span class="comment">--[[</span></span><br/><span class="line"><span class="comment">	table.concat (t , sep , start , end)</span></span><br/><span class="line"><span class="comment">	将t的所有元素连接起来，用sep作为连接符</span></span><br/><span class="line"><span class="comment">	从start开始到end结束</span></span><br/><span class="line"><span class="comment">	sep,start,end可以不写</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;concat:&#34;</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>( t, <span class="string">&#34;, &#34;</span>)) <span class="comment">--aaa, bbb, ccc</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--[[</span></span><br/><span class="line"><span class="comment">	table.insert (table, pos, value):</span></span><br/><span class="line"><span class="comment">	在t的pos位置插入value</span></span><br/><span class="line"><span class="comment">	pos可以省略，表示在末尾插入</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(t,<span class="string">&#34;ddd&#34;</span>)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;t[4]:&#34;</span>,t[<span class="number">4</span>])	<span class="comment">--ddd</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--[[</span></span><br/><span class="line"><span class="comment">	 table.remove (t , pos)</span></span><br/><span class="line"><span class="comment">	 删除t的pos位置上的元素</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">remove</span>(t)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;t[4]:&#34;</span>,t[<span class="number">4</span>]) <span class="comment">--nil</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--[[</span></span><br/><span class="line"><span class="comment">	table.sort (t , comp)</span></span><br/><span class="line"><span class="comment">	给t升序排序</span></span><br/><span class="line"><span class="comment">	comp可以省略</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/><span class="line">tt = {<span class="string">&#34;ddd&#34;</span>,<span class="string">&#34;fff&#34;</span>,<span class="string">&#34;xxx&#34;</span>,<span class="string">&#34;aaa&#34;</span>}</span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(tt)</span><br/><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(tt) <span class="keyword">do</span></span><br/><span class="line">	<span class="built_in">print</span>(i,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">--[[</span></span><br/><span class="line"><span class="comment">1	aaa</span></span><br/><span class="line"><span class="comment">2	ddd</span></span><br/><span class="line"><span class="comment">3	fff</span></span><br/><span class="line"><span class="comment">4	xxx</span></span><br/><span class="line"><span class="comment">--]]</span></span><br/></pre></td></tr></tbody></table></figure>
<p><em>无论是<code>#</code>还是<code>table.getn</code>都会在索引中断的地方停止计数，所以要自己去table的长度</em></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">table_leng</span><span class="params">(t)</span></span></span><br/><span class="line">  <span class="keyword">local</span> leng=<span class="number">0</span></span><br/><span class="line">  <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br/><span class="line">    leng=leng+<span class="number">1</span></span><br/><span class="line">  <span class="keyword">end</span></span><br/><span class="line">  <span class="keyword">return</span> leng;</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>