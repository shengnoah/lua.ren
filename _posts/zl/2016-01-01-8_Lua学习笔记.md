---
layout: post
title: Lua学习笔记 
tags: [lua文章]
categories: [topic]
---

		
		
		
		<p>关于Lua的<a href="http://www.lua.org/about.html" target="_blank" rel="external noopener noreferrer">官方定义</a>：</p>

<p>别的我就不多安利了</p>

<h2 id="type">type</h2>
<h3 id="table">table</h3>
<p>table是类似class的hash_map，由data和method两部分组成。简而言之，数据和行为是分离的，后者在Lua中称为metatable。<br>metatable有很多特有的键，在此我们粗暴的认为特有键类似c++中的操作符，它们的值一般为function或table。</p>
<h4 id="setmetatable">setmetatable</h4>
<p>我们可以通过setmetatable来赋予table不同的动作。</p>
<figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td>
<td class="code"><pre><span class="line">t = {}              </span><br><span class="line">mt = {}             </span><br><span class="line"><span class="built_in">setmetatable</span>(t, mt) <span class="comment">-- 设定mt为t的metatable</span></span><br><span class="line"><span class="built_in">getmetatable</span>(t)     <span class="comment">-- 返回mt</span></span><br></pre></td>
</tr></table></figure>
<p>以上代码可以缩略为：<br><figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br></pre></td>
<td class="code"><pre><span class="line">t = <span class="built_in">setmetatable</span>({}, {})</span><br></pre></td>
</tr></table></figure></p>
<h4 id="__index与__newindex">__index与__newindex</h4>
<figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td>
<td class="code"><pre><span class="line">other = {}</span><br><span class="line">t = <span class="built_in">setmetatable</span>({}, { __newindex = other })</span><br><span class="line">t.foo = <span class="number">3</span></span><br><span class="line">t.foo     <span class="comment">-- nil</span></span><br><span class="line">other.foo <span class="comment">-- 3</span></span><br><span class="line">t = <span class="built_in">setmetatable</span>({}, { __index = other })</span><br><span class="line">t.foo     <span class="comment">-- 3</span></span><br><span class="line">other.foo <span class="comment">-- 3</span></span><br></pre></td>
</tr></table></figure>
<ul>
<li>
<code>__index</code>类似于<code>[]</code>操作符</li>
<li>
<code>__newindex</code>类似于<code>[]=</code>操作符</li>
</ul>
<figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td>
<td class="code"><pre><span class="line">t = <span class="built_in">setmetatable</span>({}, {</span><br><span class="line">  __newindex = <span class="function"><span class="keyword">function</span><span class="params">(t, key, value)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(value) == <span class="string">"number"</span> <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">rawset</span>(t, key, value * value)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">rawset</span>(t, key, value)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">t.foo = <span class="string">"foo"</span></span><br><span class="line">t.foo <span class="comment">-- "foo"</span></span><br><span class="line">t.bar = <span class="number">4</span></span><br><span class="line">t.bar <span class="comment">-- 16</span></span><br></pre></td>
</tr></table></figure>
<ul>
<li>
<code>rawget</code>和<code>rawset</code>可以避免调用重载后的操作符（__index和__newindex）</li>
</ul>
<h4 id="__tostring">__tostring</h4>
<figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td>
<td class="code"><pre><span class="line">t = <span class="built_in">setmetatable</span>({ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> }, {</span><br><span class="line">  __tostring = <span class="function"><span class="keyword">function</span><span class="params">(t)</span></span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span> sum = sum + v <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Sum: "</span> .. sum</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t) <span class="comment">-- prints out "Sum: 6"</span></span><br></pre></td>
</tr></table></figure>
<h4 id="operator">operator</h4>
<p>运算符只能是函数</p>
<ul>
<li>__add</li>
<li>__sub</li>
<li>__mul</li>
<li>__div</li>
<li>__mod</li>
<li>__unm</li>
<li>__concat</li>
<li>__eq</li>
<li>__lt</li>
<li>__le</li>
</ul>
<h3 id="function">function</h3>
<p>一个机智的计数器</p>
<figure class="highlight lua"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td>
<td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">newCounter1 = InitCounter()</span><br><span class="line"><span class="built_in">print</span>(newCounter1()) <span class="comment">-- 1</span></span><br><span class="line"><span class="built_in">print</span>(newCounter1()) <span class="comment">-- 2</span></span><br><span class="line">newCounter2 = InitCounter()</span><br><span class="line"><span class="built_in">print</span>(newCounter2()) <span class="comment">-- 1</span></span><br></pre></td>
</tr></table></figure>
<h2 id="wheel">wheel</h2>
<p>德堪邀请我入坑，考虑了一下还是可行的。<br>现在手头还没拿到项目，所以自己造轮子玩。</p>