---
layout: post
title: Nginx安装Lua模块 
tags: [lua文章]
categories: [topic]
---
<h3 id="NGINX安装LUA（基于LNMP）："><a href="#NGINX安装LUA（基于LNMP）：" class="headerlink" title="NGINX安装LUA（基于LNMP）："></a>NGINX安装LUA（基于LNMP）：</h3><p>1.下载安装LuaJIT 2.1：<a href="http://luajit.org/download.html" target="_blank" rel="noopener noreferrer">http://luajit.org/download.html</a></p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">wget http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz</span><br/><span class="line">tar zxf LuaJIT-2.1.0-beta3.tar.gz</span><br/><span class="line"><span class="built_in">cd</span> LuaJIT-2.1.0-beta3</span><br/><span class="line">make PREFIX=/usr/<span class="built_in">local</span>/luajit</span><br/><span class="line">make install PREFIX=/usr/<span class="built_in">local</span>/luajit</span><br/></pre></td></tr></tbody></table></figure>
<p>2.下载最新的ngx_devel_kit（NDK）模块：<a href="https://github.com/simpl/ngx_devel_kit/tags" target="_blank" rel="noopener noreferrer">https://github.com/simpl/ngx_devel_kit/tags</a></p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz</span><br/><span class="line">tar -xzvf v0.3.0.tar.gz</span><br/></pre></td></tr></tbody></table></figure>
<p>3.下载最新的lua-nginx-module 模块：<a href="https://github.com/openresty/lua-nginx-module/tags" target="_blank" rel="noopener noreferrer">https://github.com/openresty/lua-nginx-module/tags</a></p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.11.tar.gz</span><br/><span class="line">tar -xzvf v0.10.11.tar.gz</span><br/></pre></td></tr></tbody></table></figure>
<p>然后执行以下命令</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/luajit/lib</span><br/><span class="line"><span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/luajit/include/luajit-2.1</span><br/></pre></td></tr></tbody></table></figure>
<p>接下来我们就要开始升级nginx版本了，在升级nginx版本之前，想进入lnmp的解压包，我们要在lnmp一键包目录下的lnmp.conf文件里的Nginx_Modules_Options加上编译参数：</p>
<figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">Nginx_Modules_Options=<span class="string">&#39;--with-ld-opt=-Wl,-rpath,/usr/local/luajit/lib --add-module=/root/lua-nginx-module-0.10.11 --add-module=/root/ngx_devel_kit-0.3.0&#39;</span></span><br/></pre></td></tr></tbody></table></figure>
<p>加上以上这段参数之后，我们就使用lnmp一键包中的./upgrade.sh nginx升级脚本升级一遍nginx即可完成lua扩展的安装。等重新编译完，nginx中就能使用lua扩展了。</p>