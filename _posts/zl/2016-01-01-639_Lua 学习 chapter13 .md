---
layout: post
title: Lua 学习 chapter13  
tags: [lua文章]
categories: [topic]
---
<h3 id="目录">目录</h3>
<ol>
  <li>位和字节</li>
  <li>无符号的输出</li>
  <li>打包和解包二进制数据</li>
</ol>

<blockquote>
  <p>What is the cost of lies? It’s not that we’ll mistake them for the truth. The real danger is that if we hear enough lies, then we no longer recognize the truth at all. What can we do then? What else is left but to abandon even the hope of truth and content ourselves instaed with stories? In these stories, it doesn’t matter who the heroes are. All we want to know is: who is to blame? No friends. Or, at least, not important ones.</p>
</blockquote>

<h2 id="位和字节">位和字节</h2>
<p>在lua中位运算和其它语言基本一致，包含按位与、按位或、按位异或、按位取反、逻辑右移以及逻辑左移。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="err">&amp;</span> <span class="mh">0xabcd</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="err">|</span> <span class="mh">0xabcd</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="err">~</span> <span class="mh">0xabcd</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="err">~</span><span class="mh">0xff</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="o">&gt;&gt;</span> <span class="o">-</span><span class="mi">12</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%x&#34;</span><span class="p">,</span> <span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">80</span><span class="p">))</span>
<span class="cm">--[[
cd
abff
ab32
ffffffffffffff00
ff000
ff000
0
--]]</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="无符号的输出">无符号的输出</h2>
<p>整形表示中使用一个比特来存储符号位，所以用来表示最大的整数就是2^63 - 1,而不是64次方。</p>

<h2 id="打包和解包二进制数据">打包和解包二进制数据</h2>
<p>函数string.pack会把值打包为二进制字符串，而unpack则从中提取这些值。 
在下面的例子里面，打包成什么格式的字符串取决于什么样的编码方式，不同的数据编码方式也不同。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;iii&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
<span class="n">string</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&#34;iii&#34;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>整形：</p>
<ol>
  <li>b(char)</li>
  <li>h(short)</li>
  <li>i(int)</li>
  <li>l(long)</li>
  <li>j(lua语言中整数的大小)</li>
  <li>in(n代表大小，7会产生7个字节的整形数）</li>
</ol>

<p>字符串：</p>
<ol>
  <li>z(