---
layout: post
title: lua 
tags: [lua文章]
categories: [topic]
---
<h2 id="Lua-入门"><a href="#Lua-入门" class="headerlink" title="Lua 入门"></a>Lua 入门</h2><p>最近想系统花几天时间学习 Lua 是因为在看 《redis 实战》的过程中发现 Lua 可与 redis 匹配产生叠加性能。nginx+Lua+redis 的联姻又可以再次增强 redis 的功力。</p>
<h3 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h3><p>  Lua 是用标准 C 语言编写的强大的、开源、轻量级、嵌入式的脚本语言。提供面向过程, 面向对象, 面向函数式, 数据驱动的编程方式。</p>
<h3 id="设计目的"><a href="#设计目的" class="headerlink" title="设计目的"></a>设计目的</h3><p>  嵌入到应用程序中, 为应用程序提供灵活的扩展和定制功能。</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>轻量级: 使用标准 C 语言编写并以源码形式开放, 编译后只有 100 多k, 非常便于嵌入到别的程序中。</li>
<li>可扩展: Lua 提供了非常易于使用的扩展接口和机制: 由宿主(通常是 C 或 C++)提供这些功能， 使用起来就像内置的功能一般。</li>
<li>其他特性: 自动内存管理; 提供了一种通用的类型的表(<strong>table</strong>), 用来实现数组, 哈希表, 集合, 对象; 语言内置模式匹配; 闭包(<strong>closure</strong>); 函数也可以看作一个值; 提供多线程等。</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>游戏开发</li>
<li>独立应用脚本</li>
<li>Web 应用脚本</li>
<li>扩展和数据库插件: MySQL Proxy 和 MySQL WorkBench</li>
<li>安全系统, 如入侵检测系统</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br/><span class="line">curl -R -O http://www.lua.org/ftp/lua-5.3.0.tar.gz</span><br/><span class="line">tar zxf lua-5.3.0.tar.gz</span><br/><span class="line"><span class="built_in">cd</span> lua-5.3.0</span><br/><span class="line">make linux <span class="built_in">test</span></span><br/><span class="line">make install</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">➜  ~ lua -i</span><br/><span class="line">Lua 5.2.3  Copyright (C) 1994-2013 Lua.org, PUC-Rio</span><br/><span class="line">&gt; <span class="built_in">print</span>(<span class="string">&#34;Hello Lua!&#34;</span>)</span><br/><span class="line">Hello Lua!</span><br/><span class="line">&gt;</span><br/></pre></td></tr></tbody></table></figure>
<p>并没有诸如 <strong>exit</strong> 的命令退出! 直接 Ctrl + c, 呵。</p>
<h3 id="First-Blood-Demo"><a href="#First-Blood-Demo" class="headerlink" title="First Blood Demo !"></a>First Blood Demo !</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">➜ touch first-blood.lua</span><br/><span class="line">➜ lua <span class="built_in">echo</span> <span class="string">&#39;print(&#34;hello world lua!&#34;)&#39;</span> &gt; first-blood.lua</span><br/><span class="line"><span class="built_in">echo</span> <span class="built_in">print</span>(<span class="string">&#34;hello world lua&#34;</span>) &gt; first-blood.lua</span><br/><span class="line">➜  lua lua first-blood.lua </span><br/><span class="line">hello world lua!</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="两种注释方式"><a href="#两种注释方式" class="headerlink" title="两种注释方式"></a>两种注释方式</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">-- single line commentary <span class="keyword">for</span> lua</span><br/><span class="line">--[[</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#39;multiple&#39;</span>)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#39;commentary&#39;</span>)</span><br/><span class="line">]]--</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="八种数据类型"><a href="#八种数据类型" class="headerlink" title="八种数据类型"></a>八种数据类型</h3><ul>
<li>nil </li>
<li>boolean</li>
<li>number, 双精度类型浮点实数</li>
<li>string </li>
<li>userdata, 表示任意存储在变量中的 C 数据结构</li>
<li>function, 由C 或者 Lua 写的函数</li>
<li>thread, 表示执行的独立线路, 用于执行协同程序</li>
<li>table, Lua 中的表(table), 其实是个<strong>关联数组</strong>(associative arrays), 数组的索引可以是数字或者字符串。使用<strong>{}</strong>来构造创建。</li>
</ul>
<h3 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h3><ul>
<li><strong>数字</strong>, <strong>字母</strong> 和 <strong>下划线</strong> 构成合法变量, <strong>区分大小写</strong>。</li>
<li>默认变量都是全局的, 使用 <strong>local</strong> 显示声明局部变量。使用前无需声明，默认值是 <strong>nil</strong>, 删除一个变量直接将该变量值致 <strong>nil</strong> 即可。</li>
<li>字符串连接使用 <strong>..</strong> 。</li>
<li><strong>#</strong> 计算字符串长度。</li>
<li>索引从 <strong>1</strong> 开始!</li>
<li><strong>table</strong> 长度不固定, 添加新数据时长度自动增长。未初始化值为 <strong>nil</strong>。</li>
<li><strong>线程</strong> VS <strong>协程</strong>: 线程可以同时运行多个，协程任意时刻只能运行一个，并且出于运行状态的协程只有被挂起(<strong>suspend</strong>)时才会暂停。</li>
<li>table 的索引可以使用<strong>[i]</strong>或者 <strong>.</strong> 操作, 如: table1[“fix”], table.fix。</li>
<li><strong>^</strong> 和 <strong>..</strong> 是右连接, 其他运算符是左连。</li>
</ul>
<h3 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h3><ul>
<li>for 循环</li>
<li>while</li>
<li>repeat … until</li>
<li>break, 跳出当前循环语句, 并执行脚本紧接着的语句。</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>Lua 函数可以 <strong>return</strong> 多个结果值。</li>
<li>Lua 函数可以在参数列表中使用 <strong>…</strong> 作为可变参数。</li>
<li>函数可以作为参数传递给函数, 有点像 <strong>Lisp</strong> 里面的。</li>
</ul>
<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><ul>
<li>加减乘除求余之外, 特殊的运算符号 <strong>^</strong> 乘幂;</li>
<li>关系运算符号中 <strong>~=</strong> 表示不等于; </li>
<li>逻辑运算符号三板斧: and, or , not;</li>
<li><strong>..</strong> 号连接, <strong>#</strong> 一元运算符, 返回字符串或表的长度(pirnt(#’abc’))。</li>
<li><p>运算符优先级排行榜:</p>
<figure class="highlight gams"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line">^</span><br/><span class="line"><span class="keyword">not</span> - (unary)</span><br/><span class="line"></span><br/><span class="line">+ -</span><br/><span class="line">..</span><br/><span class="line">&lt; &gt; &lt;= &gt;= ~= ==</span><br/><span class="line"><span class="keyword">and</span> </span><br/><span class="line"><span class="keyword">or</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
</ul>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>
<li><a href="https://www.Lua.org/" target="_blank" rel="noopener noreferrer">Lua官网</a></li>
<li><a href="http://www.runoob.com/Lua/Lua-tutorial.html" target="_blank" rel="noopener noreferrer">Lua 基本入门网上教程</a></li>
<li><a href="https://github.com/lua/lua" target="_blank" rel="noopener noreferrer">github 源码</a></li>
<li><a href="http://lua-users.org/wiki/" target="_blank" rel="noopener noreferrer">Lua wiki tools</a></li>
</ul>