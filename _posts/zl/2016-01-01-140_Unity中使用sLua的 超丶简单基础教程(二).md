---
layout: post
title: Unity中使用sLua的 超丶简单基础教程(二) 
tags: [lua文章]
categories: [topic]
---
<p><img src="https://Lafree317.github.io/../../images/Slua-1.png" alt=""/></p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://lafree317.github.io/2018/01/20/2018-01-20%20-%20Unity%E4%B8%AD%E4%BD%BF%E7%94%A8sLua%E7%9A%84%20%E8%B6%85%E4%B8%B6%E7%AE%80%E5%8D%95%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B(%E4%B8%80)/" target="_blank" rel="noopener noreferrer">Unity中使用sLua的 超丶简单基础教程(一)</a></p>
<p>上一篇博客讲了一下简单调用LuaState读取Lua代码并执行</p>
<p>本篇要讲一下如何更改路径并使得Lua可以调用UnityEngine代码的方法</p>
<p>虽然简短但也是长时间爬坑试验出来的(因为基础教程真的好少啊….)希望对大家有帮助..</p>

<h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>在创建一个新的场景,一个新的CreateEmpty把C#脚本挂上去代码如下:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/></pre></td><td class="code"><pre><span class="line">using System;</span><br/><span class="line">using System.Collections;</span><br/><span class="line">using System.Collections.Generic;</span><br/><span class="line">using UnityEngine;</span><br/><span class="line">using System.IO;</span><br/><span class="line">using SLua;</span><br/><span class="line"></span><br/><span class="line">public class TestLua : MonoBehaviour {</span><br/><span class="line"></span><br/><span class="line">	void Start () {</span><br/><span class="line">		LuaSvr svr = new LuaSvr();// 如果不先进行某个LuaSvr的初始化的话,下面的mianState会爆一个为null的错误..</span><br/><span class="line">        LuaSvr.mainState.loaderDelegate += LuaReourcesFileLoader;</span><br/><span class="line">		svr.init(null, () =&gt; // 如果不用init方法初始化的话,在Lua中是不能import的</span><br/><span class="line">		{</span><br/><span class="line">            svr.start(&#34;Test&#34;);</span><br/><span class="line">		});</span><br/><span class="line">	}</span><br/><span class="line"></span><br/><span class="line">    // SLua Loader代理方法</span><br/><span class="line">    private static byte[] LuaReourcesFileLoader(string strFile)</span><br/><span class="line">    {</span><br/><span class="line">        // 这里为了测试就不先判断为空,开发的时候再加上</span><br/><span class="line">        string filename = Application.dataPath + &#34;/Scripts/Lua/&#34; + strFile.Replace(&#39;.&#39;, &#39;/&#39;) + &#34;.txt&#34;;</span><br/><span class="line">        return File.ReadAllBytes(filename);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>
<p>然后在Assest/Scripts/Lua/中创建一个Lua.txt脚本 命名路径都可以更改代码如下:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line">import &#34;UnityEngine&#34;</span><br/><span class="line"></span><br/><span class="line">function main()</span><br/><span class="line">    print(&#34;Lua创建了一个Cube&#34;)</span><br/><span class="line">    local cube = GameObject.CreatePrimitive(PrimitiveType.Cube)</span><br/><span class="line">end</span><br/><span class="line"></span><br/><span class="line">main()</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615b60570c81eb1?w=504&amp;h=324&amp;f=png&amp;s=66637" alt=""/></p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>上一篇主要说了一下如何引用SLua读取lua脚本<br/>这一篇主要说了一下Lua如何调用UnityEngine的方法<br/>下一遍我会说一下开发一个中间层,把Start Awake Update等方法都传递到Lua中<br/>最终完成一个纯Lua项目</p>
<p>本篇教程很基础,如果有精力会将之后学习到的知识都整理成博客分享给大家~</p>