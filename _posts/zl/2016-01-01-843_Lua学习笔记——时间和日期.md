---
layout: post
title: Lua学习笔记——时间和日期 
tags: [lua文章]
categories: [topic]
---
<h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><p>首先我们看一张思维导图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/quanxiaoye/ImgHosting/root/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.jpg" alt=""/></p>
<p><strong>备注：</strong></p>
<p><strong>1. 纪元：</strong>一个固定日期，在 POSIX 和 Windows 平台中这个固定日期是 Jan 01, 1970, 00:00 UTC。</p>
<p><strong>2. 日期表：</strong>在 lua 中表示时间的一种方式，这个表具有以下几个重要字段：year、month、day、hour、        min、sec、wday、yday、isdst。</p>
<ul>
<li><p>wday：本周中的第几天（第一天是星期日）</p>
</li>
<li><p>yday：当年中的第几天</p>
</li>
<li><p>isdst：布尔类型。如果使用夏令时则为真。</p>
</li>
<li><p>例如：Sep 16,1998,23:48:10 用日期表的格式表示为：<br/>{year=1998, month=9, day=16, yday=259, wday=4, hour=23, min=48, sec=10, isdst=false}</p>
</li>
</ul>
<p>日期表中各个参数的范围如下：（秒的最大范围是60，允许闰秒的存在。）</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">范围</th>
</tr>
</thead>
<tbody><tr>
<td align="center">year</td>
<td align="center">一整年</td>
</tr>
<tr>
<td align="center">month</td>
<td align="center">1~12</td>
</tr>
<tr>
<td align="center">day</td>
<td align="center">1~31</td>
</tr>
<tr>
<td align="center">hour</td>
<td align="center">0~23</td>
</tr>
<tr>
<td align="center">min</td>
<td align="center">0~59</td>
</tr>
<tr>
<td align="center">sec</td>
<td align="center">0~60</td>
</tr>
<tr>
<td align="center">wday</td>
<td align="center">1~7</td>
</tr>
<tr>
<td align="center">yday</td>
<td align="center">1~366</td>
</tr>
</tbody></table>
<p><strong>3. os.clock()：</strong>在性能测试中，可用来记录程序的运行时间。如下：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">clock</span>() - x)</span><br/></pre></td></tr></tbody></table></figure>

<h3 id="实际使用"><a href="#实际使用" class="headerlink" title="实际使用"></a>实际使用</h3><h4 id="1-获取当前时间的整数表达"><a href="#1-获取当前时间的整数表达" class="headerlink" title="1. 获取当前时间的整数表达"></a>1. 获取当前时间的整数表达</h4><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当前时间为 2019-10-8 19:00:00</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">time</span>())      <span class="comment">-- 1570532400</span></span><br/></pre></td></tr></tbody></table></figure>

<h4 id="2-获取当前时间的格式化表示"><a href="#2-获取当前时间的格式化表示" class="headerlink" title="2. 获取当前时间的格式化表示"></a>2. 获取当前时间的格式化表示</h4><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当前时间为 2019-10-8 19:00:00</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">date</span>())      <span class="comment">-- Tue Oct  8 19:00:00 2019</span></span><br/></pre></td></tr></tbody></table></figure>

<h4 id="3-获取指定天数之后的日期"><a href="#3-获取指定天数之后的日期" class="headerlink" title="3. 获取指定天数之后的日期"></a>3. 获取指定天数之后的日期</h4><p>下面我们先看一个计算当前天数 40 天之后的日期的例子：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当前时间为 2019-10-8 19:00:00</span></span><br/><span class="line">t = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&#34;*t&#34;</span>)     <span class="comment">-- 获取当前日期</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&#34;%Y/%m/%d&#34;</span>, <span class="built_in">os</span>.<span class="built_in">time</span>(t)))    <span class="comment">-- 2019-10-8</span></span><br/><span class="line"><span class="built_in">print</span>(t.day, t.month)    <span class="comment">-- 8 10</span></span><br/><span class="line">t.day = t.day + <span class="number">40</span></span><br/><span class="line"><span class="built_in">print</span>(t.day, t.month)    <span class="comment">-- 48 10</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&#34;%Y/%m/%d&#34;</span>, <span class="built_in">os</span>.<span class="built_in">time</span>(t)))    <span class="comment">-- 2019-11-17  (归一化)</span></span><br/><span class="line">t = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&#34;*t&#34;</span>, <span class="built_in">os</span>.<span class="built_in">time</span>(t))</span><br/><span class="line"><span class="built_in">print</span>(t.day, t.month)    <span class="comment">-- 17 11 -- 2019-11-17  (归一化)</span></span><br/><span class="line">t.month = t.month + <span class="number">1</span></span><br/><span class="line"><span class="built_in">print</span>(t.day, t.month)    <span class="comment">-- 17 12</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&#34;%Y/%m/%d&#34;</span>, <span class="built_in">os</span>.<span class="built_in">time</span>(t)))    <span class="comment">-- 2019-12-17</span></span><br/></pre></td></tr></tbody></table></figure>

<p>在上面的例子中，我们看到，在加完天数之后，我们先将我们的日期表使用 os.time() 转换成整数，然后再用 os.date() 就可以做到日期的归一化显示。</p>