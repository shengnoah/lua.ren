---
layout: post
title: TypeEvaluator 和 TimeInterpolator 
tags: [lua文章]
categories: [topic]
---
<p>本文看看 TypeEvaluator 和 TimeInterpolator 的源码。</p>

<h3 id="首先来看一下Choreographer"><a href="#首先来看一下Choreographer" class="headerlink" title="首先来看一下Choreographer"></a>首先来看一下Choreographer</h3><p>Android系统从4.1(API 16)开始加入 Choreographer 这个类来控制同步处理输入(Input)、动画(Animation)、绘制(Draw)三个UI操作。其实UI显示的时候每一帧要完成的事情只有这三种。Choreographer接收显示系统的时间脉冲(垂直同步信号-VSync信号)，在下一个frame渲染时控制执行这些操作。Choreographer中文翻译过来是”舞蹈指挥”，字面上的意思就是优雅地指挥以上三个UI操作一起跳一支舞。这个词可以概括这个类的工作，如果android系统是一场芭蕾舞，他就是Android UI显示这出精彩舞剧的编舞，指挥台上的演员们相互合作，精彩演出。</p>
<p>而属性动画的每一帧数据计算就来自于 Choreographer .</p>
<h3 id="看一下-TypeEvaluator"><a href="#看一下-TypeEvaluator" class="headerlink" title="看一下 TypeEvaluator:"></a>看一下 TypeEvaluator:</h3><p>TypeEvaluator 为类型估值器，它根据当前已执行时间占总时间的比值来计算新的属性值。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> android.animation;</div><div class="line"></div><div class="line"></div><div class="line"> * Interface for use with the {<span class="doctag">@link</span> ValueAnimator#setEvaluator(TypeEvaluator)} function. Evaluators</div><div class="line"> * allow developers to create animations on arbitrary property types, by allowing them to supply</div><div class="line"> * custom evaluators for types that are not automatically understood and used by the animation</div><div class="line"> * system.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@see</span> ValueAnimator#setEvaluator(TypeEvaluator)</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> &lt;<span class="title">T</span>&gt; </span>{</div><div class="line"></div><div class="line">    </div><div class="line">     * This function returns the result of linearly interpolating the start and end values, with</div><div class="line">     * &lt;code&gt;fraction&lt;/code&gt; representing the proportion between the start and end values. The</div><div class="line">     * calculation is a simple parametric calculation: &lt;code&gt;result = x0 + t * (x1 - x0)&lt;/code&gt;,</div><div class="line">     * where &lt;code&gt;x0&lt;/code&gt; is &lt;code&gt;startValue&lt;/code&gt;, &lt;code&gt;x1&lt;/code&gt; is &lt;code&gt;endValue&lt;/code&gt;,</div><div class="line">     * and &lt;code&gt;t&lt;/code&gt; is &lt;code&gt;fraction&lt;/code&gt;.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> fraction   The fraction from the starting to the ending values</div><div class="line">     * <span class="doctag">@param</span> startValue The start value.</div><div class="line">     * <span class="doctag">@param</span> endValue   The end value.</div><div class="line">     * <span class="doctag">@return</span> A linear interpolation between the start and end values, given the</div><div class="line">     *         &lt;code&gt;fraction&lt;/code&gt; parameter.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, T startValue, T endValue)</span></span>;</div><div class="line"></div><div class="line">}</div></pre></td></tr></tbody></table></figure>
<p>要点：<br/>1.泛型参数 T ，代表了动画行径中的动画进度之的类型.<br/>2.只有一个方法 evaluate 根据 fraction 计算动画的进度值.</p>
<p>关键之处是 Animator 对象是如何和 TypeEvaluator 起作用的。</p>