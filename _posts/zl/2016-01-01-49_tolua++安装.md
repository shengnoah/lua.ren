---
layout: post
title: tolua++安装 
tags: [lua文章]
categories: [topic]
---
<div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/11/11/lua_cpp_bind/" rel="next" title="C++与Lua本质原始交互API">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  C++与Lua本质原始交互API
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/11/11/lua_pairs_ipairs/" rel="prev" title="Lua中ipairs和pairs的区别与使用">
              <p class="post-nav-pre-next-title">
                  Lua中ipairs和pairs的区别与使用
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <p>我们用一个例子来说明.</p>
<p>本文环境为 : </p>
<ul>
<li>ubuntu1404</li>
<li>g++ 4.8.4</li>
<li>python</li>
<li>git</li>
<li>lua5.1( 因为tolua++只支持到5.1, 安装5.1教程看 <a href="/2015/11/08/lua_install_tutorial/" title="Lua的win和linux环境简单安装">Lua的win和linux环境简单安装</a> )</li>
</ul>
<p><strong>. . .</strong></p>
<p>1. git clone <a href="mailto:git@github.com" target="_blank" rel="noopener noreferrer">git@github.com</a>:LuaDist/toluapp.git<br/>2. sudo apt-get install scons<br/>3. cd toluapp/</p>
<p>4. vi custom.py  然后添加内容 : </p>
<figure class="highlight python"><figcaption><span>custom.py</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">CCFLAGS = [<span class="string">&#39;-I/usr/include/lua5.1&#39;</span>, <span class="string">&#39;-O2&#39;</span>, <span class="string">&#39;-ansi&#39;</span>]</span><br/><span class="line"><span class="comment"># 自己通过命令 sudo find / -name &#34;*liblua*&#34; 来查静态库.a文件在哪, 然后把路径填到下面</span></span><br/><span class="line">LIBPATH = [<span class="string">&#39;/usr/lib/x86_64-linux-gnu&#39;</span>]</span><br/><span class="line">LIBS = [<span class="string">&#39;lua5.1&#39;</span>, <span class="string">&#39;dl&#39;</span>, <span class="string">&#39;m&#39;</span>]</span><br/><span class="line"><span class="comment">#prefix = &#39;/mingw&#39;</span></span><br/><span class="line"><span class="comment">#build_dev=1</span></span><br/><span class="line">tolua_bin = <span class="string">&#39;tolua++5.1&#39;</span></span><br/><span class="line">tolua_lib = <span class="string">&#39;tolua++5.1&#39;</span></span><br/><span class="line">TOLUAPP = <span class="string">&#39;tolua++5.1&#39;</span></span><br/></pre></td></tr></tbody></table></figure>

<p>5. scons all<br/>6. scons install</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>用以下五个文件测试, 输入命令 : </p>
<p>1. tolua++5.1 -o lua_Student.cpp Student.pkg<br/>2. g++ *.cpp -I/usr/include/lua5.1 -llua5.1 -lm -ltolua++5.1<br/>3. 如果执行 <code>./a.out</code> 之后, 打印结果如下则为环境全部安装成功 : </p>
<pre><code>1
2
3
4
5
6
7
8
9
10
Student Run
Student Run10
1
2
3
4
5
6
7
8
9
10
Student Run
Student Run10
1
2
3
4
5
6
7
8
9
10
Student Run
Student Run10
...</code></pre><h2 id="五个测试文件"><a href="#五个测试文件" class="headerlink" title="五个测试文件"></a>五个测试文件</h2><figure class="highlight c++"><figcaption><span>Student.h</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"> </span><br/><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br/><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br/><span class="line"> </span><br/><span class="line"><span class="class"><span class="keyword">class</span> </span></span><br/><span class="line"><span class="class">{</span></span><br/><span class="line"><span class="keyword">public</span>:</span><br/><span class="line">	Student();</span><br/><span class="line">	~Student();</span><br/><span class="line"> </span><br/><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Run</span><span class="params">()</span></span>;</span><br/><span class="line"> </span><br/><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Run</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br/><span class="line">};</span><br/></pre></td></tr></tbody></table></figure>

<figure class="highlight c++"><figcaption><span>Student.cpp</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;Student.h&#34;</span></span></span><br/><span class="line"> </span><br/><span class="line"> </span><br/><span class="line">Student::Student()</span><br/><span class="line">{</span><br/><span class="line">}</span><br/><span class="line"> </span><br/><span class="line"><span class="keyword">void</span> Student::Run()</span><br/><span class="line">{</span><br/><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&#34;Student Run&#34;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br/><span class="line">}</span><br/><span class="line"> </span><br/><span class="line"><span class="keyword">void</span> Student::Run(<span class="keyword">int</span> a)</span><br/><span class="line">{</span><br/><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&#34;Student Run&#34;</span> &lt;&lt;a&lt;&lt; <span class="built_in">endl</span>;</span><br/><span class="line">}</span><br/><span class="line"> </span><br/><span class="line">Student::~Student()</span><br/><span class="line">{</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line">$#include&#34;Student.h&#34;</span><br/><span class="line"> </span><br/><span class="line">class Student</span><br/><span class="line">{</span><br/><span class="line">public:</span><br/><span class="line">	Student();</span><br/><span class="line">	~Student();</span><br/><span class="line"> </span><br/><span class="line">	void Run();</span><br/><span class="line">	void Run @ Run2(int a);</span><br/><span class="line">};</span><br/></pre></td></tr></tbody></table></figure>

<figure class="highlight lua"><figcaption><span>test.lua</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">studentB=Student:new() <span class="comment">--实例化Student全局对象</span></span><br/><span class="line"> </span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Run</span><span class="params">()</span></span></span><br/><span class="line">	studentB:Run();</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"> </span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Run2</span><span class="params">(a)</span></span></span><br/><span class="line">	studentB:Run2(a);</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"> </span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span>  </span><br/><span class="line">	<span class="keyword">local</span> b = {}  </span><br/><span class="line">	<span class="keyword">local</span> index  </span><br/><span class="line">	  </span><br/><span class="line">	<span class="keyword">for</span> index = <span class="number">1</span>,<span class="number">10</span>,<span class="number">1</span> <span class="keyword">do</span>  </span><br/><span class="line">		<span class="built_in">print</span>(index)  </span><br/><span class="line">	<span class="keyword">end</span>  </span><br/><span class="line"><span class="keyword">end</span>  </span><br/><span class="line">  </span><br/><span class="line">show()  </span><br/><span class="line"> </span><br/><span class="line">Run()</span><br/><span class="line"> </span><br/><span class="line">Run2(<span class="number">10</span>)</span><br/></pre></td></tr></tbody></table></figure>

<figure class="highlight c++"><figcaption><span>main.cpp</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br/><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">extern</span> <span class="string">&#34;C&#34;</span></span><br/><span class="line">{</span><br/><span class="line">        <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;lua.h&#34;</span></span></span><br/><span class="line">        <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;lualib.h&#34;</span></span></span><br/><span class="line">        <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;lauxlib.h&#34;</span></span></span><br/><span class="line">        <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;luaconf.h&#34;</span></span></span><br/><span class="line">}</span><br/><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&#34;tolua++.h&#34;</span></span></span><br/><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&#34;Student.h&#34;</span></span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">tolua_Student_open</span><span class="params">(lua_State* tolua_S)</span></span>;</span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br/><span class="line"><span class="function"></span>{</span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br/><span class="line">        {</span><br/><span class="line">            sleep(<span class="number">2</span>);</span><br/><span class="line"></span><br/><span class="line">            lua_State* L = luaL_newstate();</span><br/><span class="line">            luaL_openlibs(L);</span><br/><span class="line"></span><br/><span class="line">            tolua_Student_open(L);</span><br/><span class="line"></span><br/><span class="line">            luaL_dofile(L, <span class="string">&#34;./test.lua&#34;</span>);</span><br/><span class="line">            lua_close(L);</span><br/><span class="line">        }</span><br/><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>

<p><strong>在运行的时候</strong>把test.lua文件的<code>Run2(10)</code> 改为 <code>Run2(99)</code> 之后,<br/>打印也会跟着变为 : </p>
<pre><code>1
2
3
4
5
6
7
8
9
10
Student Run
Student Run10
1
2
3
4
5
6
7
8
9
10
Student Run
Student Run99
1
2
3
4
5
6
7
8
9
10
Student Run
Student Run99
...</code></pre>