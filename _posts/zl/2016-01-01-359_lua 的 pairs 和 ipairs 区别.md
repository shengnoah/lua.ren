---
layout: post
title: lua 的 pairs 和 ipairs 区别 
tags: [lua文章]
categories: [topic]
---
<p>看下文档上对 pairs 和 ipairs 的描述：</p>
<h3 id="pairs"><a href="#pairs" class="headerlink" title="pairs"></a>pairs</h3><blockquote>
<p>If t has a metamethod __pairs, calls it with t as argument and returns the first three results from the call.</p>
<p>Otherwise, returns three values: the next function, the table t, and nil, so that the construction</p>
<pre><code>for k,v in pairs(t) do body end
</code></pre><p>will iterate over all key–value pairs of table t.</p>
<p>See function next for the caveats of modifying the table during its traversal.</p>
</blockquote>
<h3 id="ipairs"><a href="#ipairs" class="headerlink" title="ipairs"></a>ipairs</h3><blockquote>
<p>Returns three values (an iterator function, the table t, and 0) so that the construction</p>
<pre><code>for i,v in ipairs(t) do body end
</code></pre><p>will iterate over the key–value pairs (1,t[1]), (2,t[2]), …, up to the first nil value.</p>
</blockquote>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>主要看这两段描述：</p>
<p>pairs 是 <code>will iterate over all key–value pairs of table t.</code> 可以遍历所有的 key - value。</p>
<p>ipairs 是 <code>will iterate over the key–value pairs (1,t[1]), (2,t[2]), …, up to the first nil value.</code> 只会遍历从 1 开始的 key-value。</p>
<p>所以通过下面几个例子来深入的理解下：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/></pre></td><td class="code"><pre><span class="line">t1 = {</span><br/><span class="line">  name = <span class="string">&#34;rcx&#34;</span>,</span><br/><span class="line">  age = <span class="number">18</span></span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line">t2 = {</span><br/><span class="line">  [<span class="number">1</span>] = <span class="string">&#34;a&#34;</span>,</span><br/><span class="line">  [<span class="number">2</span>] = <span class="string">&#34;b&#34;</span>,</span><br/><span class="line">   x = <span class="string">&#34;3&#34;</span></span><br/><span class="line">}</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;ipairs(t1)  begin&#34;</span>)</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t1) <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;ipairs(t1)  end&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;ipairs(t2)  begin&#34;</span>)</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t2) <span class="keyword">do</span></span><br/><span class="line"><span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;ipairs(t2)  end&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;pairs(t1)  begin&#34;</span>)</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(t1) <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;pairs(t1)  end&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;pairs(t2)  begin&#34;</span>)</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(t2) <span class="keyword">do</span></span><br/><span class="line">  <span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;pairs(t2)  end&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure>
<p>输出结果是：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line">ipairs(t1)  begin</span><br/><span class="line">ipairs(t1)  end</span><br/><span class="line">ipairs(t2)  begin</span><br/><span class="line"><span class="number">1</span>	a</span><br/><span class="line"><span class="number">2</span>	b</span><br/><span class="line">ipairs(t2)  end</span><br/><span class="line">pairs(t1)  begin</span><br/><span class="line">name	rcx</span><br/><span class="line">age	<span class="number">18</span></span><br/><span class="line">pairs(t1)  end</span><br/><span class="line">pairs(t2)  begin</span><br/><span class="line"><span class="number">1</span>	a</span><br/><span class="line"><span class="number">2</span>	b</span><br/><span class="line">x	<span class="number">3</span></span><br/><span class="line">pairs(t2)  end</span><br/></pre></td></tr></tbody></table></figure>
<p>从结果上可以看出来 ipairs 遍历 t1 的时候没有任何输出，是因为 ipairs 只会遍历下标从 1 开始的。</p>
<p>第二个 ipairs 遍历 t2 没输出 x 3 ，是因为当根据前一个下标加 1，在 key 中找不到就结束了。</p>
<p>总结，iparis 适合遍历类似数组的，pairs 适合遍历类似 map 的。</p>
<p>—EOF—</p>