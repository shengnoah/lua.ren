---
layout: post
title: cocos2dx lua 常见错误汇总与解决方案 
tags: [lua文章]
categories: [topic]
---
<p>cocos2dx lua开比较苦恼的是，没办法断点或者直接一步一步调试处理，但是幸好官方有点良心，给了一个打印的调试Log，我们可以使用它调试和查找对应的错误。</p>
<p>这里就记录一些，个人学习和实战中遇到的一些错误和问题的总结</p>

<ul>
<li>not found view “ApiTest” in search paths “app.views”  <ul>
<li>ApiTest不在Views里面或者名字写错了，或者没有初始化</li>
</ul>
</li>
</ul>
<ul>
<li>attempt to index upvalue ‘HttpSingleton’ (a boolean value)<ul>
<li>末尾没有返回HttpSingleton</li>
</ul>
</li>
</ul>
<ul>
<li>attempt to index local ‘self’ (a nil value) <ul>
<li>参数传错了或者将逗号(.)与冒号(:)搞混了</li>
</ul>
</li>
</ul>
<ul>
<li>attempt to call method ‘schedulerScriptFunc’ (a nil value)<ul>
<li>方法写错了</li>
</ul>
</li>
</ul>
<ul>
<li>attempt to call global ‘getScheduler’ (a nil value)<ul>
<li>代码或者语法错误</li>
</ul>
</li>
</ul>
<ul>
<li>syntax error during pre-compilation<ul>
<li>严重的语法错误</li>
</ul>
</li>
</ul>
<ul>
<li>invalid ‘cobj’ in function ‘lua_cocos2dx_Node_getLocalZOrder’<ul>
<li>这个报错是lua的变量还在，但是他底层对应的C++对象已被销毁。</li>
</ul>
</li>
</ul>
<ul>
<li>InterpolationMissingOptionError: Bad value substitution:<ul>
<li>在执行genbindings.py脚本文件时，不要在该文件的外部路径执行，需要CD到该文件目录下执行./genbindings.py</li>
</ul>
</li>
</ul>
<ul>
<li>TranslationUnitLoadError: Error parsing translation unit.<ul>
<li>基本都是.ini文件没有配置正确，仔细检查一下 .ini文件里的 “headers = ”指向的路径是否正确</li>
</ul>
</li>
</ul>
<ul>
<li>Xcode编译错误，header error<ul>
<li>再此外，把.hpp和.cpp加进cocos2d_lua_bindings.xcodeproj时，target需要勾选ios。在设置 UserHeaderSearchPaths 时，注意选择该proj的Ios target进行设置 ，不要选择了mac target 选项，否则ios环境编译不过</li>
</ul>
</li>
</ul>
<ul>
<li>mportError: No module named yaml<ul>
<li>安装了yaml模块，如果还是报错找不到这个模块，这个就是是路径问题，因为我从新安装了python，然而：这里使用的python是系统默认的#!/usr/bin/python，处理好python版本和当前匹配的版本<ul>
<li>网上说还有其他方式解决(待验证)<ul>
<li>import sys</li>
<li>sys.path.append(‘/xxx/xxxxx/‘) 加进去也行。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>attempt to perform arithmetic on local ‘x’ (a nil value)<ul>
<li>忘了记录…..</li>
</ul>
</li>
</ul>
<p>这里专门说需要关于cocos2dx lua开发中的错误，其实cocos2dx lua中也和iOS中一样，分为两种错误：编译时错误和运行时错误</p>
<ul>
<li>编译错误，一般是语法上存在问题，编译过不去;</li>
<li>运行错误，是指程序在运行过程中出现错误，只能说是程序存在一定的边界bug;</li>
</ul>
<h3 id="编译时错误和运行时错误"><a href="#编译时错误和运行时错误" class="headerlink" title="编译时错误和运行时错误"></a>编译时错误和运行时错误</h3><h4 id="编译错误，"><a href="#编译错误，" class="headerlink" title="编译错误，"></a>编译错误，</h4><p>比如上面一条</p>
<pre><code>error:syntax error during pre-compliation
</code></pre><p>就属于编译语法错误，这里报错其实还会有一些提示信息，如果我们可以通过提示信息，找到LuaStack，在LuaStack中有个LuaStack::luaLoadBuffer(…)，然后查看源码如下：</p>
<pre><code>switch (r)
{
　　case LUA_ERRSYNTAX:     // 编译出错
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: syntax error during pre-compilation.&#34;, chunkName);
　　break;
　　case LUA_ERRMEM:        // 内存分配错误
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: memory allocation error.&#34;, chunkName);
　　break;
　　case LUA_ERRRUN:        // 运行错误
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: run error.&#34;, chunkName);
　　break;
　　case LUA_YIELD:         // 线程被挂起
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: thread has suspended.&#34;, chunkName);
　　break;
　　case LUA_ERRFILE:
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: cannot open/read file.&#34;, chunkName);
　　break;
　　case LUA_ERRERR:        // 运行错误处理函数时发生错误
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, while running the error handler function.&#34;, chunkName);
　　break;
　　default:
　　CCLOG(&#34;[LUA ERROR] load &#34;%s&#34;, error: unknown.&#34;, chunkName);
}
</code></pre><p>所以，无论怎样，出现错误时，都能将错误信息返回到堆栈的最顶层</p>
<h5 id="如果遇到编译错误是，可以通过如下的代码来打印错误信息：在以上-之外的后面加"><a href="#如果遇到编译错误是，可以通过如下的代码来打印错误信息：在以上-之外的后面加" class="headerlink" title="如果遇到编译错误是，可以通过如下的代码来打印错误信息：在以上{}之外的后面加"></a>如果遇到编译错误是，可以通过如下的代码来打印错误信息：在以上{}之外的后面加</h5><pre><code>const char* error = lua_tostring(L, -1);
CCLOG(&#34;[LUA ERROR] error result: %s&#34;,error);
lua_pop(L, 1);
</code></pre><p>　　</p>
<h4 id="运行错误"><a href="#运行错误" class="headerlink" title="运行错误"></a>运行错误</h4><p>而针对于运行错误，一般情况下，你可以参考如下代码(此代码在main.lua中)：</p>
<pre><code>-- lua提供，调用其他函数，可以捕捉到错误，第一个参数为要调用的函数， 第二个参数为捕捉到错误时所调用的函数
-- 返回的参数status为错误状态， msg为错误信息
local status, msg = xpcall(main, __G__TRACKBACK__)
if not status then
print(msg)
end
</code></pre><ul>
<li>推荐<ul>
<li><a href="http://www.cocoachina.com/bbs/read.php?tid=200145" target="_blank" rel="noopener noreferrer">http://www.cocoachina.com/bbs/read.php?tid=200145</a></li>
<li><a href="https://blog.csdn.net/msdb198901/article/details/52128175" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/msdb198901/article/details/52128175 </a></li>
</ul>
</li>
</ul>