---
layout: post
title: LuaTable函数库 
tags: [lua文章]
categories: [topic]
---
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(<span class="built_in">table</span>,[ pos,] value) </span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">remove</span>(<span class="built_in">table</span>[, pos]) </span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">concat</span>(<span class="built_in">table</span>[, sep[, i[, j]]]) </span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(<span class="built_in">table</span>[, comp]) // 见Lua排序</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">getn</span>() //<span class="number">5.0</span>费</span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">maxn</span>() //<span class="number">5.2</span>费</span><br/></pre></td></tr></tbody></table></figure>

<p>#####insert, remove</p>
<p>insert 和 remove 只能用于数组元素的插入和移出， 进行插入和移出时，会将后面的元素对齐起来。<br/>  所以在 for 循环中进行 insert 和 remove 的时候要注意插入和移除时是否<strong>漏掉</strong>了某些项：<br/>    local t = {1,2,3,3,5,3,6}<br/>    for i,v in ipairs(t) do<br/>      if v == 3 then<br/>        table.remove(t,i)<br/>      end<br/>    end<br/>    – 错误，第四个 3 没有被移除，ipairs 内部会维护一个变量记录遍历的位置，remove 掉第三个数字 3 之后，ipairs 下一个返回的值是 5 而不是 3 </p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>} </span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>, #t <span class="keyword">do</span> </span><br/><span class="line">  <span class="keyword">if</span> t[i] == <span class="number">3</span> <span class="keyword">then</span> </span><br/><span class="line">    <span class="built_in">table</span>.<span class="built_in">remove</span>(t,i) </span><br/><span class="line">    i = i<span class="number">-1</span> </span><br/><span class="line">  <span class="keyword">end</span> </span><br/><span class="line"><span class="keyword">end</span> </span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> t = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>} </span><br/><span class="line"><span class="keyword">for</span> i=#t, <span class="number">1</span>, <span class="number">-1</span> <span class="keyword">do</span> </span><br/><span class="line">  <span class="keyword">if</span> t[i] == <span class="number">3</span> <span class="keyword">then</span> </span><br/><span class="line">    <span class="built_in">table</span>.<span class="built_in">remove</span>(t,i) </span><br/><span class="line">  <span class="keyword">end</span> </span><br/><span class="line"><span class="keyword">end</span> </span><br/><span class="line"><span class="comment">-- 正确，从后往前遍历 </span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> t = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>} </span><br/><span class="line"><span class="keyword">local</span> i = <span class="number">1</span> </span><br/><span class="line"><span class="keyword">while</span> t[i] <span class="keyword">do</span> </span><br/><span class="line">  <span class="keyword">if</span> t[i] == <span class="number">3</span> <span class="keyword">then</span> </span><br/><span class="line">    <span class="built_in">table</span>.<span class="built_in">remove</span>(t,i) </span><br/><span class="line">  <span class="keyword">else</span> </span><br/><span class="line">    i = i+<span class="number">1</span> </span><br/><span class="line">  <span class="keyword">end</span> </span><br/><span class="line"><span class="keyword">end</span> </span><br/><span class="line"><span class="comment">-- 正确，自己控制 i 的值是否增加</span></span><br/></pre></td></tr></tbody></table></figure>

<h5 id="Concat"><a href="#Concat" class="headerlink" title="Concat"></a>Concat</h5><p>concat 可以将 table 的数组部分拼接成一个字符串，中间用 seq 分隔。<br/>  lua 中字符串的存储方式与 C 不一样，lua 中的每个字符串都是单独的一个拷贝，拼接两个字符串会产生一个新的拷贝，如果拼接操作特别多，就会影响性能：<br/>    local beginTime = os.clock()<br/>    local str = “”<br/>    for i=1, 30000 do<br/>      str = str .. i<br/>    end<br/>    local endTime = os.clock()<br/>    print(endTime - beginTime)<br/>    – 消耗 0.613 秒，产生了 30000 个字符串拷贝，但只有最后一个是有用的</p>
<p>​    local beginTime = os.clock()<br/>​    local t = {}<br/>​    for i=1, 30000 do<br/>​      t[i] = i<br/>​    end<br/>​    local str = table.concat(t, “”)<br/>​    local endTime = os.clock()<br/>​    print(endTime - beginTime)<br/>​    – 消耗 0.024 秒，利用 concat，一次性把字符串拼接出来，只产生了一个字符串拷贝 </p>
<h5 id="maxn"><a href="#maxn" class="headerlink" title="maxn"></a>maxn</h5><ul>
<li>原型：table.maxn (tab_table)</li>
<li>解释：返回一个表<code>tab_table</code>中的最大正数索引，如果没有正数索引的话返回0。</li>
<li>总结#<ul>
<li>这个函数比较简单，行为和函数解释一致，<strong>不要求索引必须连续，返回一个最大的正数索引</strong>。</li>
<li>有运行结果可知，当表中<strong>只有</strong>非数字索引或者负数索引时，函数返回0。</li>
<li>其中官方文档中有一句话，大意是说这个函数的工作原理就是线性的遍历了这个表</li>
</ul>
</li>
</ul>
<p><a href="https://www.cnblogs.com/whiteyun/archive/2009/08/10/1543139.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/whiteyun/archive/2009/08/10/1543139.html</a></p>
<p><a href="https://www.cnblogs.com/slysky/p/5360387.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/slysky/p/5360387.html</a></p>