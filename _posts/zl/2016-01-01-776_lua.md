---
layout: post
title: lua 
tags: [lua文章]
categories: [topic]
---
<h2 id="LuaInterface-库"><a href="#LuaInterface-库" class="headerlink" title="LuaInterface 库"></a>LuaInterface 库</h2><p><span class="exturl" data-url="aHR0cDovL2x1YWZvcmdlLm5ldC9wcm9qZWN0cy9sdWFpbnRlcmZhY2Uv" title="http://luaforge.net/projects/luainterface/">LuaInterface下载地址<i class="fa fa-external-link"></i></span></p>
<ul>
<li>LuaInterface是一个用于在Lua语言和Microsoft .NET平台的公共语言运行时（CLR）之间集成的库。 Lua脚本可以使用它来实例化CLR对象，访问属性，调用方法，甚至使用Lua函数处理事件。</li>
<li>LuaInterface.Lua类是CLR访问Lua解释器的主要接口，一个LuaInterface.Lua类对象就代表了一个Lua解释器（或Lua执行环境），Lua解释器可以同时存在多个，并且它们之间是完全相互独立的。</li>
</ul>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="在-C-中调用-Lua"><a href="#在-C-中调用-Lua" class="headerlink" title="在 C# 中调用 Lua"></a>在 C# 中调用 Lua</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">MyMath = {}</span><br/><span class="line"></span><br/><span class="line">MyMath.Name = <span class="string">&#34;MyMath&#34;</span></span><br/><span class="line">MyMath.PI = <span class="number">3.1415</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(first, second)</span></span></span><br/><span class="line">    <span class="keyword">return</span> first+second</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">return</span> MyMath</span><br/></pre></td></tr></tbody></table></figure>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br/><span class="line"><span class="keyword">using</span> System;</span><br/><span class="line"><span class="keyword">using</span> LuaInterface;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">class</span> <span class="title">Program</span> {</span><br/><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span> {</span><br/><span class="line">        <span class="comment">// 创建 Lua 解释器</span></span><br/><span class="line">        Lua lua = <span class="keyword">new</span> Lua();</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 执行 Lua 语句</span></span><br/><span class="line">        lua.DoString(<span class="string">&#34;print(&#39;Lua in C#&#39;)&#34;</span>);</span><br/><span class="line"></span><br/><span class="line">        lua.DoString(<span class="string">@&#34;</span></span><br/><span class="line"><span class="string">            for i=1, 5, 1 do</span></span><br/><span class="line"><span class="string">                print(i);</span></span><br/><span class="line"><span class="string">            end</span></span><br/><span class="line"><span class="string">        &#34;</span>);</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 执行 Lua 文件，参数为 Lua 文件所在路径，下面 MyMath.lua 文件放在项目输出目录中</span></span><br/><span class="line">        lua.DoFile(<span class="string">&#34;MyMath.lua&#34;</span>);</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 使用 Lua 文件中的变量</span></span><br/><span class="line">        Console.WriteLine(lua.GetString(<span class="string">&#34;MyMath.Name&#34;</span>));</span><br/><span class="line">        Console.WriteLine(lua.GetNumber(<span class="string">&#34;MyMath.PI&#34;</span>));</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 使用 Lua 文件中的函数</span></span><br/><span class="line">        LuaFunction Add = lua.GetFunction(<span class="string">&#34;MyMath.Add&#34;</span>);</span><br/><span class="line">        Console.WriteLine(Add.Call(<span class="number">1</span>, <span class="number">2</span>)[<span class="number">0</span>]);</span><br/><span class="line"></span><br/><span class="line">        Console.ReadLine();</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line">Lua in C#</span><br/><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">MyMath</span><br/><span class="line">3.1415</span><br/><span class="line">3</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="在-Lua-中调用-C"><a href="#在-Lua-中调用-C" class="headerlink" title="在 Lua 中调用 C"></a>在 Lua 中调用 C</h3><pre><code>测试项目名称：CSharpAndLua
</code></pre><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tools.cs</span></span><br/><span class="line"><span class="keyword">using</span> System;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">namespace</span> <span class="title">CSharpAndLuaTest</span> {</span><br/><span class="line">    <span class="keyword">class</span> <span class="title">Tools</span> {</span><br/><span class="line"></span><br/><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Show</span>(<span class="params"></span>)</span> {</span><br/><span class="line">            Console.WriteLine(<span class="string">&#34;Show something ... &#34;</span>);</span><br/><span class="line">        }</span><br/><span class="line"></span><br/><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Print</span>(<span class="params"></span>)</span> {</span><br/><span class="line">            Console.WriteLine(<span class="string">&#34;This is member method.&#34;</span>);</span><br/><span class="line">        }</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Main.lua</span></span><br/><span class="line"><span class="built_in">require</span>(<span class="string">&#34;luanet&#34;</span>)   <span class="comment">-- 引用 luanet 程序集</span></span><br/><span class="line">luanet.load_assembly(<span class="string">&#34;CSharpAndLua&#34;</span>) <span class="comment">-- 加载程序集</span></span><br/><span class="line">Tools = luanet.import_type(<span class="string">&#34;CSharpAndLuaTest.Tools&#34;</span>); <span class="comment">-- 引用类型</span></span><br/><span class="line"></span><br/><span class="line">Tools.Show();   <span class="comment">-- 调用静态方法</span></span><br/><span class="line"></span><br/><span class="line">myTools = Tools()</span><br/><span class="line">myTools:Print() <span class="comment">-- 调用成员方法</span></span><br/></pre></td></tr></tbody></table></figure>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br/><span class="line"><span class="keyword">using</span> System;</span><br/><span class="line"><span class="keyword">using</span> LuaInterface;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">namespace</span> <span class="title">CSharpAndLua</span> {</span><br/><span class="line">    <span class="keyword">class</span> <span class="title">Program</span> {</span><br/><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span> {</span><br/><span class="line">            <span class="comment">// 创建 Lua 解释器</span></span><br/><span class="line">            Lua lua = <span class="keyword">new</span> Lua();</span><br/><span class="line">            lua.DoFile(<span class="string">&#34;Main.lua&#34;</span>);</span><br/><span class="line"></span><br/><span class="line">            Console.ReadLine();</span><br/><span class="line">        }</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">Show something ...</span><br/><span class="line">This is member method.</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="热更新初尝试"><a href="#热更新初尝试" class="headerlink" title="热更新初尝试"></a>热更新初尝试</h3><ol>
<li>打开项目程序集所在的根目录bin</li>
<li>更改Lua脚本代码内容</li>
<li>运行程序集</li>
</ol>
<p>修改 lua 文件<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Main.lua</span></span><br/><span class="line"><span class="built_in">require</span>(<span class="string">&#34;luanet&#34;</span>)   <span class="comment">-- 引用 luanet 程序集</span></span><br/><span class="line">luanet.load_assembly(<span class="string">&#34;CSharpAndLua&#34;</span>) <span class="comment">-- 加载程序集</span></span><br/><span class="line">Tools = luanet.import_type(<span class="string">&#34;CSharpAndLuaTest.Tools&#34;</span>); <span class="comment">-- 引用类型</span></span><br/><span class="line"></span><br/><span class="line">Tools.Show();   <span class="comment">-- 调用静态方法</span></span><br/><span class="line"></span><br/><span class="line">myTools = Tools()</span><br/><span class="line">myTools:Print() <span class="comment">-- 调用成员方法</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;Update this file.&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure><br/><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line">Show something ...</span><br/><span class="line">This is member method.</span><br/><span class="line">Update this file.</span><br/></pre></td></tr></tbody></table></figure><p></p>