---
layout: post
title: 399. Evaluate Division 
tags: [lua文章]
categories: [topic]
---
<a href="https://github.com/techlarry/note/edit/master/wiki/docs/Leetcode/399. Evaluate Division.md" title="编辑此页" class="md-icon md-content__icon"></a>
                
                
                  
                



  
    <a href="https://techlarry.github.io/tags/Leetcode/" style="color:white" class="tag"> Leetcode </a>
  

  
    <a href="https://techlarry.github.io/tags/Graph/" style="color:white" class="tag"> Graph </a>
  


                <p>Equations are given in the format <code class="codehilite">A / B = k</code>, where <code class="codehilite">A</code> and <code class="codehilite">B</code> are variables represented as strings, and <code class="codehilite">k</code> is a real number (floating point number). Given some queries, return the answers. If the answer does not exist, return <code class="codehilite">-1.0</code>.</p>
<p>Example:
</p><div class="codehilite"><pre><span></span>Given a / b = 2.0, b / c = 3.0. 
queries are: a / c = ?, b / a = ?, a / e = ?, a / a = ?, x / x = ? . 
return [6.0, 0.5, -1.0, 1.0, -1.0 ].
</pre></div><p></p>
<p>The input is: <code class="codehilite">String[][] equations, double[] values, String[][] queries</code> , where <code class="codehilite">equations.size() == values.size()</code>, and the values are positive. This represents the equations. Return <code class="codehilite">double[]</code>.</p>
<p>According to the example above:</p>
<div class="codehilite"><pre><span></span>equations = [ [&#34;a&#34;, &#34;b&#34;], [&#34;b&#34;, &#34;c&#34;] ],
values = [2.0, 3.0],
queries = [ [&#34;a&#34;, &#34;c&#34;], [&#34;b&#34;, &#34;a&#34;], [&#34;a&#34;, &#34;e&#34;], [&#34;a&#34;, &#34;a&#34;], [&#34;x&#34;, &#34;x&#34;] ]. 
</pre></div>

<p>The input is always valid. You may assume that evaluating the queries will result in no division by zero and there is no contradiction.</p>
<h4 id="_1">分析<a class="headerlink" href="#_1" title="Permanent link">¶</a></h4>
<p>这道题目的难点在于发现可以用图论解决。对于方程<code class="codehilite">A/B = C</code>，可以把A、B视为图的节点，AB构成图的一条边，C为边的权重。以这种方式构建有向图，那么对于任意方程<code class="codehilite">x/y</code>的问题可以转化为<em>在有向图中，是否存在一条路径<span><span class="MathJax_Preview">x-y</span><script type="math/tex">x-y</script></span>，如果存在则返回路径的权重</em>。可以用DFS解决，时间复杂度为<span><span class="MathJax_Preview">O(Qtimes(E+V))</span><script type="math/tex">O(Qtimes(E+V))</script></span>，其中<span><span class="MathJax_Preview">Q</span><script type="math/tex">Q</script></span>为查询的数量，<span><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span>为方程数量，<span><span class="MathJax_Preview">V</span><script type="math/tex">V</script></span>为方程中字母的数量。</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">double</span><span class="o">[]</span> <span class="nf">calcEquation</span><span class="o">(</span><span class="n">String</span><span class="o">[][]</span> <span class="n">equations</span><span class="o">,</span> <span class="kt">double</span><span class="o">[]</span> <span class="n">values</span><span class="o">,</span> <span class="n">String</span><span class="o">[][]</span> <span class="n">queries</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">equations</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">values</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">queries</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{};</span>
    <span class="c1">// construct graph</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span> <span class="c1">// graph</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">equations</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">equations</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="n">w</span> <span class="o">=</span> <span class="n">equations</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">graph</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">v</span><span class="o">))</span> <span class="n">graph</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;());</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">graph</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">w</span><span class="o">))</span> <span class="n">graph</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;());</span>
        <span class="n">graph</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">v</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="n">graph</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">w</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mark</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();;</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">distTo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();;</span>
    <span class="kt">double</span><span class="o">[]</span> <span class="n">res</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">queries</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">queries</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="n">w</span> <span class="o">=</span> <span class="n">queries</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
        <span class="c1">// invalid query</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">graph</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">graph</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">w</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">res</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">;</span>  <span class="k">continue</span><span class="o">;</span> <span class="o">}</span>
        <span class="c1">// clear dfs result</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">distTo</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="n">mark</span><span class="o">.</span><span class="na">clear</span><span class="o">();}</span>

        <span class="c1">// start dfs</span>
        <span class="n">distTo</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">);</span>
        <span class="n">dfs</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="n">mark</span><span class="o">,</span> <span class="n">distTo</span><span class="o">,</span> <span class="n">v</span><span class="o">);</span>

        <span class="c1">// check result</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">mark</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">w</span><span class="o">))</span> <span class="n">res</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">;</span>
        <span class="k">else</span> <span class="n">res</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">distTo</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">w</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">dfs</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">graph</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mark</span><span class="o">,</span>
                 <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">distTo</span><span class="o">,</span> <span class="n">String</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">mark</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">w</span><span class="o">:</span> <span class="n">graph</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">v</span><span class="o">).</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">mark</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">w</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">distTo</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="n">distTo</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">v</span><span class="o">)*</span><span class="n">graph</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">v</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">w</span><span class="o">));</span>
            <span class="n">dfs</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="n">mark</span><span class="o">,</span> <span class="n">distTo</span><span class="o">,</span> <span class="n">w</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>