---
layout: post
title: fflua更新 
tags: [lua文章]
categories: [topic]
---
<h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>fflua 发布了有段时间了，很多网友都用了，并且提供了一些很好的反馈。其中一个就是c++接口注册到lua中时，对引用的支持。这样使用起来更加方便。</p>
<h2 id="原有方式："><a href="#原有方式：" class="headerlink" title="原有方式："></a>原有方式：</h2><p>fflua 中注册c++的类用如下方式：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> </span></span><br/><span class="line"><span class="class">{</span></span><br/><span class="line"><span class="keyword">public</span>:</span><br/><span class="line">    <span class="keyword">base_t</span>():v(<span class="number">789</span>){}</span><br/><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dump</span><span class="params">()</span></span></span><br/><span class="line"><span class="function">    </span>{</span><br/><span class="line">        <span class="built_in">printf</span>(<span class="string">&#34;in %s a:%dn&#34;</span>, __FUNCTION__, v);</span><br/><span class="line">    }</span><br/><span class="line">    <span class="keyword">int</span> v;</span><br/><span class="line">};</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">fflua_register_t</span>&lt;<span class="keyword">base_t</span>, ctor()&gt;(ls, <span class="string">&#34;base_t&#34;</span>)  <span class="comment">//! 注册构造函数</span></span><br/><span class="line">                    .def(&amp;<span class="keyword">base_t</span>::dump, <span class="string">&#34;dump&#34;</span>)     <span class="comment">//! 注册基类的函数</span></span><br/><span class="line">                    .def(&amp;<span class="keyword">base_t</span>::v, <span class="string">&#34;v&#34;</span>);          <span class="comment">//! 注册基类的属性</span></span><br/></pre></td></tr></tbody></table></figure>
<p>当c++类注册成功，后lua代码中可以操作类对象的指针，并且可以作为参数传递给c++的接口：</p>
<pre><code class="cpp"><span class="function"><span class="keyword">void</span> <span class="title">dumy_base</span><span class="params">(<span class="keyword">base_t</span>* p)</span></span>
<span class="function"></span>{
    <span class="built_in">printf</span>(<span class="string">&#34;in %s begin ------------n&#34;</span>, __FUNCTION__);
}
<span class="keyword">fflua_register_t</span>&lt;&gt;(ls).def(&amp;dumy, <span class="string">&#34;dumy&#34;</span>);  <span class="comment">//! 注册静态函数</span>
<span class="comment">//有网友跟我反映，原来的接口很多都是使用引用作为参数，为了接收lua传过来的参数，还得需要重新写一个函数，比较麻烦，于是fflua增加了对引用的支持：</span>

<span class="function"><span class="keyword">void</span> <span class="title">dumy_base</span><span class="params">(<span class="keyword">base_t</span>&amp; p)</span></span>
<span class="function"></span>{
    <span class="built_in">printf</span>(<span class="string">&#34;in %s begin ------------n&#34;</span>, __FUNCTION__);
}
<span class="keyword">fflua_register_t</span>&lt;&gt;(ls).def(&amp;dumy, <span class="string">&#34;dumy&#34;</span>); <span class="comment">//! 注册静态函数</span>
</code></pre>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>最新代码：<a href="https://github.com/fanchy/fflua" target="_blank" rel="noopener noreferrer">https://github.com/fanchy/fflua</a></p>