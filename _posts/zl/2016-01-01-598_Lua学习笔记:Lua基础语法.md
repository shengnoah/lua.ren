---
layout: post
title: Lua学习笔记:Lua基础语法 
tags: [lua文章]
categories: [topic]
---
<div class="content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>虽然接触Lua已经很久了但是一直以来也没有做很完整的笔记，以至于长时间不用就会容易生疏，所以做一下笔记以便以后拿出来翻阅。</strong></p>
<h1 id="初始Lua"><a href="#初始Lua" class="headerlink" title="初始Lua"></a>初始Lua</h1><ul>
<li><strong>第一次接触Lua感觉这玩意的语法和python、js很像，解释型语言、弱类型等等，写起来是真省心，维护起来是真费事…</strong></li>
<li><strong>作为游戏的脚本热更起来是真舒服，有问题抛一个AB包搞定。</strong></li>
</ul>
<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li><strong>只有布尔、字符串、数字、table和nil。但是没有一个明确的类型定义，完全按照赋值来进行推断是什么类型。</strong></li>
<li><strong>默认是public，如果想private需要变量前加local。</strong></li>
<li><strong>可以一次性多复制，如果变量和值不对称，没有复制的变量为nil。（如下）</strong><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line">a,b,c = <span class="number">1</span>,<span class="number">2</span></span><br/><span class="line"><span class="built_in">print</span>(a)</span><br/><span class="line"><span class="built_in">print</span>(b)</span><br/><span class="line"><span class="built_in">print</span>(c)</span><br/><span class="line"></span><br/><span class="line"><span class="number">1</span></span><br/><span class="line"><span class="number">2</span></span><br/><span class="line"><span class="literal">nil</span></span><br/><span class="line"><span class="comment">-- 要想不为空必须对等赋值：a,b,c = 1,2,3</span></span><br/></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><ul>
<li><strong>在Lua中一个local的作用域可以是一个循环、一个table（和c#中的class类似）、也可以是一个 do end，是如果你想控制一个local变量的值作用域某个区间，那么可以使用do end来明确划分一个block。如下，第一段代码print(a)结果为空，因为a是local并且作用域是do end，第二段代码因为外部有全局的a变量，所以可以打印出10</strong><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br/><span class="line"> <span class="keyword">local</span> a = <span class="number">1</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(a) <span class="comment">-- 结果为nil</span></span><br/></pre></td></tr></tbody></table></figure>

</li>
</ul>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br/><span class="line"><span class="keyword">do</span></span><br/><span class="line"> <span class="keyword">local</span> a = <span class="number">1</span></span><br/><span class="line"> <span class="built_in">print</span>(a)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(a) <span class="comment">-- 结果为1    10</span></span><br/></pre></td></tr></tbody></table></figure>

<h2 id="循环-for-while-do-repeat-until"><a href="#循环-for-while-do-repeat-until" class="headerlink" title="循环 forwhile dorepeat until"></a>循环 forwhile dorepeat until</h2><ul>
<li><p><strong>需要注意的是for循环默认是从1开始的，这个很不爽容易造成我们写程序误判，尤其是c#和lua交互的时候需要注意</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ta = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>}</span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, #ta <span class="keyword">do</span></span><br/><span class="line"><span class="built_in">print</span>(i) <span class="comment">-- 结果 1 2 3 4 5</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">```  </span><br/><span class="line">``` lua</span><br/><span class="line"><span class="comment">-- 循环从0开始的示例</span></span><br/><span class="line"><span class="keyword">local</span> ta = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>}</span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>, #ta <span class="keyword">do</span></span><br/><span class="line"><span class="built_in">print</span>(i) <span class="comment">-- 结果 0 1 2 3 4 5</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">``` </span><br/><span class="line">- **<span class="keyword">while</span> <span class="keyword">do</span>**</span><br/><span class="line">``` lua</span><br/><span class="line">a=<span class="number">10</span></span><br/><span class="line"><span class="keyword">while</span>( a &lt; <span class="number">20</span> )</span><br/><span class="line"><span class="keyword">do</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;a 的值为:&#34;</span>, a)</span><br/><span class="line">   a = a+<span class="number">1</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">-- a 的值为: 10 a 的值为: 11 ..... a 的值为: 19</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong>repeat…until 循环语句不同于 for 和 while循环，for 和 while 循环的条件语句在当前循环执行开始时判断，而 repeat…until 循环的条件语句在当前循环结束后判断。</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br/><span class="line"><span class="keyword">repeat</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;a的值为:&#34;</span>, a)</span><br/><span class="line">   a = a + <span class="number">1</span></span><br/><span class="line"><span class="keyword">until</span>( a &gt; <span class="number">15</span> ) </span><br/><span class="line"><span class="comment">-- a的值为: 10 a的值为:11 ..... a的值为:15</span></span><br/></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><ul>
<li><strong>lua中除了for循环还可以用迭代，需要注意pairs 和 ipairs异同</strong><blockquote>
<p><strong>相同：都是能遍历集合（表、数组）<br/> 不同：<code>ipairs</code> 仅仅遍历值，按照索引升序遍历，索引中断停止遍历。即不能返回 nil,只能返回数字 0，如果遇到 nil 则退出。它只能遍历到集合中出现的第一个不是整数的 key。<br/><code>pairs</code>能遍历集合的所有元素。即 pairs 可以遍历集合中所有的 key，并且除了迭代器本身以及遍历表本身还可以返回 nil。</strong></p>
</blockquote>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tabFiles = {</span><br/><span class="line">        [<span class="number">1</span>] = <span class="string">&#34;test2&#34;</span>,</span><br/><span class="line">        [<span class="number">6</span>] = <span class="string">&#34;test3&#34;</span>,</span><br/><span class="line">        [<span class="number">4</span>] = <span class="string">&#34;test1&#34;</span></span><br/><span class="line">    }</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span> <span class="keyword">do</span></span><br/><span class="line"><span class="built_in">print</span>(k..<span class="string">&#34;---&#34;</span>..v)</span><br/><span class="line"><span class="keyword">end</span>    </span><br/><span class="line"><span class="comment">-- 结果 程序会在test2处断开</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span> <span class="keyword">do</span></span><br/><span class="line"><span class="built_in">print</span>(k..<span class="string">&#34;---&#34;</span>..v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">-- 结果会输出 1---test2 6---test3 4---test1</span></span><br/></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><blockquote>
<p><strong>终于写到强大的table了，table是lua中的数据结构，可以用来做数组、字典、还可以用来模拟类等等</strong><br/><strong>Lua table 使用关联型数组，你可以用任意类型的值来作数组的索引，但这个值不能是 nil。</strong><br/><strong>table是不固定大小的，可以根据需要进行扩容</strong></p>
</blockquote>
<p><strong>数组</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> arry = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>} <span class="comment">-- 下标是从1开始的</span></span><br/></pre></td></tr></tbody></table></figure>

<p><strong>字典</strong>   </p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> dic = {name = <span class="string">&#34;小明&#34;</span>,sex = <span class="string">&#34;男&#34;</span>}</span><br/></pre></td></tr></tbody></table></figure>

<p><strong>table容易出现的问题</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line">temp = <span class="number">1</span></span><br/><span class="line">tab = {[temp] = <span class="number">1</span>, <span class="number">11</span>}</span><br/><span class="line"><span class="built_in">print</span>(tab[<span class="number">1</span>])</span><br/><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab) <span class="keyword">do</span></span><br/><span class="line">	<span class="built_in">print</span>(i,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 输出的结果是 ： </span></span><br/><span class="line"><span class="number">11</span></span><br/><span class="line"><span class="number">1</span>	<span class="number">11</span></span><br/></pre></td></tr></tbody></table></figure>

<p><strong>why?第一个print中为何结果不是1，因为tab[]这个用法的参数是key，而像11这样没有显示定义key的value默认的key就是1，所以这句话认为是输出key=1的value了。而且从遍历看居然只有一个数据，也就是说value 1的数据被替换掉了。</strong><br/><strong>所以使用table这种数据结构时注意下面几点：</strong></p>
<ul>
<li><p><strong>所有元素之间，总是用逗号 “，” 隔开；</strong></p>
</li>
<li><p><strong>所有索引值都需要用 “[“和”]”括起来；如果是字符串，还可以去掉引号和中括号； 即如果没有[]括起，则认为是字符串索引</strong></p>
</li>
<li><p><strong>如果不写索引，则索引就会被认为是数字，并按顺序自动从 1往后编；</strong></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2></li>
<li><p><strong>function可以返回也可以不返回结果，在定义时没有明确的约束。</strong></p>
</li>
<li><p><strong>支持多返回值。</strong></p>
</li>
<li><p><strong>Lua函数不支持参数默认值，可以通过or来实现。</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(a , b)</span></span></span><br/><span class="line">    a = a <span class="keyword">or</span> <span class="number">1.1</span></span><br/><span class="line">    b = b <span class="keyword">or</span> <span class="number">2.2</span></span><br/><span class="line">    <span class="keyword">return</span> a + b</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"> </span><br/><span class="line"><span class="built_in">print</span>(sum())</span><br/></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong>支持闭包</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/></pre></td><td class="code"><pre><span class="line">tab = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>}</span><br/><span class="line"> </span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iter</span><span class="params">()</span></span></span><br/><span class="line">    <span class="keyword">local</span> index = <span class="number">0</span></span><br/><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br/><span class="line">        index = index + <span class="number">1</span> </span><br/><span class="line">        <span class="keyword">return</span> tab[index]</span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"> </span><br/><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> iter() <span class="keyword">do</span></span><br/><span class="line">   <span class="built_in">print</span>(i)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong>支持可变参数</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">average</span><span class="params">(...)</span></span></span><br/><span class="line">   result = <span class="number">0</span></span><br/><span class="line">   <span class="keyword">local</span> <span class="built_in">arg</span>={...}</span><br/><span class="line">   <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br/><span class="line">      result = result + v</span><br/><span class="line">   <span class="keyword">end</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;总共传入 &#34;</span> .. #<span class="built_in">arg</span> .. <span class="string">&#34; 个数&#34;</span>)</span><br/><span class="line">   <span class="keyword">return</span> result/#<span class="built_in">arg</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;平均值为&#34;</span>,average(<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br/></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h2 id="和-的区别"><a href="#和-的区别" class="headerlink" title=":和.的区别"></a>:和.的区别</h2><p><strong>这个也是很多接触lua的新手容易迷惑的地方，其实：是个语法糖，调用的函数会自动传递参数self</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a = {x = <span class="number">0</span>}</span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a.foo</span><span class="params">(self, a)</span></span></span><br/><span class="line">    self.x = a</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a:foo</span><span class="params">(a)</span></span></span><br/><span class="line">    self.x = a</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 调用时</span></span><br/><span class="line">a.foo(a, <span class="number">2</span>)</span><br/><span class="line">a.foo2(<span class="number">2</span>)</span><br/></pre></td></tr></tbody></table></figure>
  </div>