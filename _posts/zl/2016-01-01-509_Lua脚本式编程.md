---
layout: post
title: Lua脚本式编程 
tags: [lua文章]
categories: [topic]
---
<h3 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1.基本语法"></a>1.基本语法</h3><p>单行注释：–<br/>多行注释：–[[ 内容–]]</p>
<p>lua最好<strong>不要使用</strong>下划线加大字母的标识符，因为lua的保留字是这样的。<br/>lua不允许使用特殊字符如@$%来定义标志符。</p>
<p>默认情况下，变量总是认为全局。<br/>删除全局变量，只需要将变量赋值nil .</p>
<p>lua的数据类型：nil 、boolean、number、string、userdata、function、thread和table。</p>
<p>nil作为比较时应该加上双引号，例如</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">type(x) == &#34;nil&#34;</span><br/></pre></td></tr></tbody></table></figure>
<p>boolean类型只有两个可选值：true 和 false<br/>lua把false和nil看作是“假”，其他都为真。</p>
<p>number（数字）：lua只有一种number类型，double双精度类型，默认类型可以修改luaconf.h里面的定义。</p>
<p>string（字符串）：由一对双引号或单引号来表示，也可以用2个方括号“[[ ]]”来表示“一块”字符串。</p>
<p>对一个数字字符串上进行算术操作时，lua会尝试将这个数字字符串转换成一个数字。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">print(“<span class="number">2</span>”+<span class="number">6</span>)   <span class="number">8.0</span></span><br/><span class="line">print(<span class="string">&#34;2&#34;</span>+<span class="string">&#34;6&#34;</span>) <span class="number">8.0</span></span><br/></pre></td></tr></tbody></table></figure>
<p>字符串连接使用的是 . .如：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#34;a&#34;</span> .. <span class="string">&#34;b&#34;</span>)  ab</span><br/><span class="line">print(<span class="number">157</span> .. <span class="number">428</span>) <span class="number">157428</span></span><br/></pre></td></tr></tbody></table></figure>
<p>#计算字符串的长度。</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line">len =<span class="string">&#34;www.runoob.com&#34;</span></span><br/><span class="line">print(#len)	                 14</span><br/><span class="line">print(#&#34;www.runoob.com&#34;) 14</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="2-宿主语言C-C"><a href="#2-宿主语言C-C" class="headerlink" title="2.宿主语言C/C++"></a>2.宿主语言C/C++</h3><p>==虚拟栈==<br/>        无论何时lua调用C，被调用的函数都得到一个新的栈，这个栈独立于C函数本身的栈，也独立于之前的栈。<br/>        方便起见，所有正对栈的API查询操作都不严格遵守栈的操作规则。而是可以用一个索引来指向栈上的任何元素：<br/>        ==正的索引指的是栈上的绝对位置（从1开始），负的索引指从栈顶开始的偏移量。==</p>
<p>Lua_checkstack:扩大可用堆栈的尺寸<br/>LUA_MINSTACK一般被定义为20。</p>
<p>压入栈的数据类型包括数值、字符串、指针、table、闭包。</p>
<p><img src="https://yuhongjiu8888.github.io/./attachments/1545806848964.drawio.html" alt="Diagram"/></p>
<p>Lua_pushcclosure(L,func,0)；创建并压入一个闭包<br/>Lua_createtable(L,0,0)；新建并压入一个表<br/>Lua_pushnumber(L,343)；压入一个数字<br/>Lua_pushstring(L,”Nystr”)；压入一个字符串</p>
<p>Lua中，number、boolean、nil、lightuserdata四种类型的值是直接存在栈上元素里和垃圾回收无关。<br/>Lua中，string、table、closure、userdata、thread存在栈上元素里的只是指针，他们都会在生命周期结束后被垃圾回收。</p>
<p>Lua_push<em>族函数都有“创建一个类型的值并压入”的语义。<br/>Lua value -&gt; C value时，是通过Lua_to</em>族api实现的。</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">取表中元素 </span><br/><span class="line"><span class="keyword">void</span> lua_getfield(lua_state *L,int index,<span class="keyword">const</span> char *K)</span><br/><span class="line">操作： arr = stack[index]</span><br/><span class="line">			stack.push(arr[K])</span><br/><span class="line">			取表中键为K的元素，这里的表是由index指向的栈上的一个表。</span><br/><span class="line">			栈高度+<span class="number">1</span>，栈顶元素是（stack[index]）[K]。</span><br/></pre></td></tr></tbody></table></figure>