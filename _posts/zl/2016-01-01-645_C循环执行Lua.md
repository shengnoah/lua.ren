---
layout: post
title: C循环执行Lua 
tags: [lua文章]
categories: [topic]
---
<div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
    </div>
    

    <h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><p>先定义好树莓派相关操作函数</p>
<p>在创建Lua状态机时注册函数</p>
<p>main函数启动后，先执行初始化函数</p>
<p>初始化函数中，获取当前程序目录，并设置相关目录路径（初始化目录和工作目录）</p>
<p>然后扫描初始化目录，依次执行里面的Lua文件，根据执行结果选择是否跳过</p>
<p>初始化完成后，执行循环工作处理，每次循环都扫描工作目录，依次执行里面的Lua文件，根据执行结果选择是否跳出循环</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>运行程序后，只要往 /lua/work/ 目录中放 Lua 文件就可以了</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;time.h&gt;</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;dirent.h&gt;</div><div class="line">#include &lt;sys/types.h&gt;</div><div class="line">#include &lt;sys/stat.h&gt;</div><div class="line"></div><div class="line">#include &lt;wiringPi.h&gt;</div><div class="line"></div><div class="line">#include &lt;lua/lua.h&gt;</div><div class="line">#include &lt;lua/lauxlib.h&gt;</div><div class="line">#include &lt;lua/lualib.h&gt;</div><div class="line"></div><div class="line">#define DIR_LUA_INIT &#34;/lua/init/&#34;</div><div class="line">#define DIR_LUA_WORK &#34;/lua/work/&#34;</div><div class="line"></div><div class="line">static int G_SLEEP_TIME = 2000;</div><div class="line">static char *G_DIR_LUA_INIT = NULL;</div><div class="line">static char *G_DIR_LUA_WORK = NULL;</div><div class="line"></div><div class="line">int pi_init();</div><div class="line">int pi_work();</div><div class="line">int pi_scan(char *path);</div><div class="line">int pi_call(char *path, char *name);</div><div class="line">lua_State *pi_create_lua();</div><div class="line"></div><div class="line">//程序初始化</div><div class="line">int pi_init() {</div><div class="line">    //printf(&#34;[PI] 御风PI程序已启动!n&#34;);</div><div class="line"></div><div class="line">    //初始化wiringPi</div><div class="line">    int rc = wiringPiSetup();</div><div class="line">    if (rc == -1) {</div><div class="line">        //printf(&#34;[PI] 初始化wiringPi失败!n&#34;);</div><div class="line">        return -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    //获取目录</div><div class="line">    char path_base[1000] = { 0 };</div><div class="line">    int len_base, len_init, len_work;</div><div class="line">    memset(path_base, &#39;