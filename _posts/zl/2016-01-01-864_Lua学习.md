---
layout: post
title: Lua学习 
tags: [lua文章]
categories: [topic]
---
<ul>
<li>轻量级嵌入式脚本语言</li>
<li>动态类型语言
</li>
</ul>
<h1 id="语法">语法</h1><h2 id="数据类型">数据类型</h2><ul>
<li><p>nil boolean number string userdata function thread table<br/>使用<code>type()</code>返回类型</p>
</li>
<li><p>Boolean  </p>
<ul>
<li>boolean和nil都被看做false</li>
<li>0和空串被看做true</li>
</ul>
</li>
<li><p>Number  </p>
<ul>
<li>全部用浮点表示</li>
<li>16进制表示也可以用2进制指数方式<br/>  <code>0x2.2p2</code> 等于(2+2/16)*2^2</li>
</ul>
</li>
<li><p>String  </p>
<ul>
<li>String不能被修改，替换其中字符后会创建一个新字符串</li>
<li>Lua自动处理字串内存分配问题，直接操作超长字串也OK</li>
<li>使用<code>#string</code>来查看字串长度</li>
<li>使用<code>[==[....]==]</code>来包含字面文字（Literal Text）<br/>其中=可以是0个或任意多个</li>
<li>使用<code>..</code>来连接字串</li>
<li>string转number:<code>tonumber()</code><br/>number转string:<code>tostring()</code></li>
</ul>
</li>
<li><p>Table</p>
<ul>
<li>Table是对象</li>
<li>变量指向Table的引用</li>
<li>Table存储键-值对<br/>创建Table: <code>a={}</code><br/>赋值:<code>a[&#34;x&#34;]=10</code></li>
<li><code>a.x</code>和<code>a[&#34;x&#34;]</code>是相同的，注意第二项的x是字串值，不是变量名</li>
<li>Lua的array<strong>从1开始</strong>，不是从0开始  </li>
<li>对于没有洞（中间没有nil项）的Table（可以称之为Sequence）,用<code>#a</code>来获取长度（或者说最后一项的index）</li>
</ul>
</li>
<li><p>Function</p>
<ul>
<li>Function可以被当做变量，参数和返回值</li>
<li>Lua可以调用C函数</li>
</ul>
</li>
<li><p>Userdata和Thread<br/>  N/A</p>
</li>
</ul>
<h2 id="表达式">表达式</h2><ul>
<li><p>算术表达式<br/>  <strong>+, -, *, /, ^, %, -（负号）</strong><br/>  全部操作都是针对浮点数<br/>  支持浮点的求模, <span color="gray"><em>a%b==a-math.floor(a/b)*b</em></span></p>
</li>
<li><p>关系表达式<br/>  <strong>&lt;, &gt;, &lt;=, &gt;=, ==, ~=</strong><br/>  不同类型不相等<br/>  table和userdata类型，引用同一个对象才相等<br/>  大小仅用于number和string类型</p>
</li>
<li><p>逻辑表达式<br/>  <strong>and, or, not</strong><br/>  and和or使用短路方式</p>
<pre><code>x=x <span class="operator">or</span> v 

<span class="operator">a</span> <span class="operator">and</span> b <span class="operator">or</span> c <span class="comment">--相当于C语言的a?b:c</span>
</code></pre></li>
<li><p>连接表达式<br/>  <strong>..</strong><br/>  支持数字的连接，但要在前后加空格</p>
</li>
<li><p>长度表达式<br/>  <strong>#</strong><br/>  仅对序列(sequence)有效</p>
</li>
<li><p>优先级</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">优先级</th>
<th style="text-align:left">操作符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:left">^</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:left">not # -(neg)</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:left">* / %</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:left">+ -</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:left">..</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:left">&lt; &gt; &lt;= &gt;= ~= ==</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:left">and</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:left">or</td>
</tr>
</tbody>
</table>
<p>只有^和..是右结合性</p>
<ul>
<li>table构造器<br/><code>a={&#34;xxx&#34;,&#34;yyy&#34;,&#34;zzz&#34;}</code>按数字index初始化<br/><code>a={x=10,y=20}</code>按键值对初始化<br/><code>a={[&#34;x&#34;]=10,[1]=&#34;xxx&#34;}</code> 初始化的标准形式</li>
</ul>
<h2 id="语句">语句</h2><ul>
<li>支持用逗号分隔的多重赋值：<code>a,b=10, 2*x</code><br/>可以用这个形式交换数据：<code>a,b=b,a</code><br/>虽然没有单独赋值快，但可以接受函数返回多个返回值</li>
<li>局部变量：<code>local i =1</code></li>
<li><p>控制结构</p>
<pre><code><span class="keyword">if</span> a&lt;<span class="number">0</span> <span class="keyword">then</span> a=<span class="number">0</span> <span class="keyword">end</span>
<span class="keyword">if</span> a&lt;b <span class="keyword">then</span> a=b <span class="keyword">else</span> b=a <span class="keyword">end</span>
<span class="keyword">if</span> .. <span class="keyword">then</span> .. <span class="keyword">elseif</span> .. <span class="keyword">else</span> .. <span class="keyword">end</span>

<span class="keyword">while</span> .. <span class="keyword">do</span> .. <span class="keyword">end</span>
<span class="keyword">repeat</span> .. <span class="keyword">until</span>

<span class="keyword">for</span> var= start, <span class="keyword">end</span>, [step] <span class="keyword">do</span> .. [<span class="keyword">break</span>] .. <span class="keyword">end</span>
<span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span> ... <span class="keyword">end</span>
</code></pre><p>return只能放在每个代码块的最后，想插入return可以写成<code>do return end</code><br/>goto可以跳到标签，但不可以跳进块，也不可从函数跳出。标签的写法<code>::label::</code></p>
</li>
</ul>
<h2 id="函数">函数</h2><ul>
<li>仅有一个参数，且参数是字面量字符串或者表构造器的时候，可以省略()：<code>print &#34;hello world&#34;</code> <code>f{x=10,y=20}</code></li>
</ul>
<h2 id="注释">注释</h2><pre><code><span class="comment">--这是一个单行注释  </span>

<span class="comment">--[[
    这是一个多行注释
--]]</span>

<span class="comment">---[[</span>
加一个小杠可以取消多行注释，很方便
<span class="comment">--]]</span>
</code></pre><h1 id="进阶">进阶</h1><p>待补充</p>
<h1 id="获取和安装">获取和安装</h1><p>官网下载安装包-&gt;make macosx install</p>
<h1 id="lua运行环境">lua运行环境</h1><ul>
<li><p>脚本运行</p>
<pre><code><span class="shebang">#!/usr/local/bin/lua</span>
</code></pre></li>
<li><p>lua解释器</p>
<pre><code>lua -i <span class="operator">-e</span> <span class="string">&#34;嵌入式lua语句&#34;</span> <span class="operator">-l</span>库 脚本名 脚本参数
</code></pre><p>  -e后面跟嵌入式lua语句<br/>  -l后面跟库<br/>  -i是运行完脚本后打开交互式环境</p>
<p>  arg[-3]=”lua”, arg[0]=脚本名，arg[1]=arg1…</p>
</li>
</ul>
<h1 id="Q&amp;A">Q&amp;A</h1><ul>
<li>Q:Lua的基本特征是什么？<br/>A:Lua的基本特征是…</li>
</ul>