---
layout: post
title: LuaTable判空 
tags: [lua文章]
categories: [topic]
---
<p><strong>Lua判断表为空t = {}的逻辑</strong></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">next</span>(a) == <span class="literal">nil</span> <span class="keyword">then</span></span><br/></pre></td></tr></tbody></table></figure><p><strong>next(table[,index])</strong></p><blockquote>
<p>运行程序来遍历表中的所有域。 第一个参数是要遍历的表，第二个参数是表中的某个键。 <code>next</code> 返回该键的下一个键及其关联的值。 如果用 <strong>nil</strong> 作为第二个参数调用 <code>next</code> 将返回初始键及其关联值。 当以最后一个键去调用，或是以 <strong>nil</strong> 调用一张空表时， <code>next</code> 返回 <strong>nil</strong>。 如果不提供第二个参数，将认为它就是 <strong>nil</strong>。 特别指出，你可以用 <code>next(t)</code> 来判断一张表是否是空的。</p>
<p>索引在遍历过程中的次序无定义， <em>即使是数字索引也是这样</em>。 （如果想按数字次序遍历表，可以使用数字形式的 <strong>for</strong> 。） -Lua 5.3参考手册</p>
</blockquote>




<p><strong>(转)</strong>在项目的脚本lua中经常有这样的需求，</p>
<p>1、local a = {}</p>
<p>2、对a进行处理</p>
<p>3、对a是否为空表进行判断</p>
<p>关于对a是否为空表的判断，如果直接这样做：</p>
<p>if a == {} then</p>
<p>这样的结果就是a == {}永远返回false，是一个逻辑错误。因为这里比较的是table a和一个匿名table的内存地址。</p>
<p>也有些代码如此做：</p>
<p>if table.maxn(a) == 0 then</p>
<p>这样做也不保险，除非table的key都是数字，而没有hash部分。</p>
<p>难道真的要遍历table发现有东西就return false跳出才能断定它是否为空吗？这样做是可以的，至少目前项目中前人是这么封装的，不过代码太难看. </p>
<p>网上小搜了一下，发现原来官方手册里早已经给了答案，那就是靠lua内置的next函数</p>
<p>即如此用：if next(a) == nil then</p>
<p>next其实就是pairs遍历table时用来取下一个内容的函数.</p>