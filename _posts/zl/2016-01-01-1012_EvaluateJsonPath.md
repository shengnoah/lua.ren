---
layout: post
title: EvaluateJsonPath 
tags: [lua文章]
categories: [topic]
---
<hr/> <p>编辑人：<strong><strong>酷酷的诚</strong></strong>  邮箱：<strong>zhangchengk@foxmail.com</strong></p> <hr/> <p>内容：</p> <h2 id="描述"><a href="#描述" class="header-anchor">#</a> 描述</h2> <p>该处理器根据流文件的内容计算一个或多个JsonPath表达式。这些表达式的结果被写入到FlowFile属性，或者写入到FlowFile本身的内容中，这取决于处理器的配置。通过添加用户自定义的属性来输入jsonpath，添加的属性的名称映射到输出流中的属性名称(如果目标是flowfile-attribute;否则，属性名将被忽略)。属性的值必须是有效的JsonPath表达式。“auto-detect”的返回类型将根据配置的目标进行确定。当“Destination”被设置为“flowfile-attribute”时，将使用“scalar”的返回类型。当“Destination”被设置为“flowfile-content”时，将使用“JSON”返回类型。如果JsonPath计算为JSON数组或JSON对象，并且返回类型设置为“scalar”，则流文件将不进行修改，并将路由到失败。如果所提供的JsonPath计算为指定的值，JSON的返回类型可以返回“scalar”。如果目标是“flowfile-content”，并且JsonPath没有计算到一个已定义的路径，那么流文件将被路由到“unmatched”，无需修改其内容。如果目标是“flowfile-attribute”，而表达式不匹配任何内容，那么将使用空字符串创建属性作为值，并且FlowFile将始终被路由到“matched”。</p> <h2 id="属性配置"><a href="#属性配置" class="header-anchor">#</a> 属性配置</h2> <p>在下面的列表中，必需属性的名称以粗体显示。任何其他属性(不是粗体)都被认为是可选的，并且指出属性默认值（如果有默认值），以及属性是否支持表达式语言。</p> <table><thead><tr><th style="text-align:left">属性名称</th> <th style="text-align:left">默认值</th> <th style="text-align:left">可选值</th> <th style="text-align:left">描述</th></tr></thead> <tbody><tr><td style="text-align:left"><strong>Destination</strong></td> <td style="text-align:left">flowfile-content</td> <td style="text-align:left"><li>flowfile-content</li><li>flowfile-content</li></td> <td style="text-align:left">指示是否将JsonPath计算结果写入流文件内容或流文件属性;如果使用flowfile-attribute，则必须指定属性名称属性。如果设置为flowfile-content，则只能指定一个JsonPath，并且忽略属性名。</td></tr> <tr><td style="text-align:left"><strong>Return Type</strong></td> <td style="text-align:left">auto-detect</td> <td style="text-align:left"><li>auto-detect</li><li>json</li><li>scalar</li></td> <td style="text-align:left">指示JSON路径表达式的期望返回类型。选择“auto-detect”，“flowfile-content”的返回类型自动设置为“json”，“flowfile-attribute”的返回类型自动设置为“scalar”。</td></tr> <tr><td style="text-align:left"><strong>Path Not Found Behavior</strong></td> <td style="text-align:left">ignore</td> <td style="text-align:left"><li>warn</li><li>ignore</li></td> <td style="text-align:left">指示在将Destination设置为“flowfile-attribute”时如何处理丢失的JSON路径表达式。当没有找到JSON路径表达式时，选择“warn”将生成一个警告。</td></tr> <tr><td style="text-align:left"><strong>Null Value Representation</strong></td> <td style="text-align:left">empty string</td> <td style="text-align:left"><li>empty string</li><li>empty string</li></td> <td style="text-align:left">指示产生空值的JSON路径表达式的所需表示形式。</td></tr></tbody></table> <h2 id="动态属性："><a href="#动态属性：" class="header-anchor">#</a> 动态属性：</h2> <p>该处理器允许用户指定属性的名称和值。</p> <table><thead><tr><th style="text-align:left">属性名称</th> <th style="text-align:left">属性值</th> <th style="text-align:left">描述</th></tr></thead> <tbody><tr><td style="text-align:left">用户自由定义的属性名称</td> <td style="text-align:left">用户自由定义的属性值</td> <td style="text-align:left">在该处理器生成的文件流上添加用户自定义的属性。如果使用表达式语言，则每批生成的流文件只执行一次计算 .<br/>支持表达式语言:true(只使用变量注册表进行计算)</td></tr></tbody></table> <h2 id="连接关系"><a href="#连接关系" class="header-anchor">#</a> 连接关系</h2> <table><thead><tr><th style="text-align:left">名称</th> <th style="text-align:left">描述</th></tr></thead> <tbody><tr><td style="text-align:left">failure</td> <td style="text-align:left">当不能根据流文件的内容计算JsonPath时，流文件被路由到这个关系;例如，如果流文件不是有效的JSON</td></tr> <tr><td style="text-align:left">unmatched</td> <td style="text-align:left">当JsonPath不匹配流文件的内容，并且目标被设置为流文件内容时，流文件被路由到这个关系</td></tr> <tr><td style="text-align:left">matched</td> <td style="text-align:left">当成功地计算了JsonPath并修改了流文件后，流文件将被路由到这个关系</td></tr></tbody></table> <h2 id="读取属性"><a href="#读取属性" class="header-anchor">#</a> 读取属性</h2> <p>没有指定。</p> <h2 id="写属性"><a href="#写属性" class="header-anchor">#</a> 写属性</h2> <p>没有指定。</p> <h2 id="状态管理"><a href="#状态管理" class="header-anchor">#</a> 状态管理</h2> <p>此组件不存储状态。</p> <h2 id="限制"><a href="#限制" class="header-anchor">#</a> 限制</h2> <p>此组件不受限制。</p> <h2 id="输入要求"><a href="#输入要求" class="header-anchor">#</a> 输入要求</h2> <p>此组件需要传入关系。</p> <h2 id="系统资源方面的考虑"><a href="#系统资源方面的考虑" class="header-anchor">#</a> 系统资源方面的考虑</h2> <p>没有指定。</p> <h2 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h2> <p>通常当需要从流文件json中提取某些数据作为流属性时，使用此处理器；或者从流文件json内容中提取一部分内容作为下一个流文件内容，使用此处理器。</p> <h2 id="示例说明"><a href="#示例说明" class="header-anchor">#</a> 示例说明</h2> <p>流程模板xml(1.9.2)</p> <a href="../template/EvaluateJsonPath.xml" download="EvaluateJsonPath.xml">EvaluateJsonPath.xml</a> <p>1：提取流文件json内容，作为输出流的属性。（注意：当输出选择flowfile-attribute时，及时jsonpath匹配不到值，流文件也会路由到matched）</p> <p><img src="https://nifichina.gitee.io/image/processors/EvaluateJsonPath/config.png" alt=""/></p> <p>输入json如下：</p> <p><img src="https://nifichina.gitee.io/image/processors/EvaluateJsonPath/input.png" alt=""/></p> <p>输出结果如下：</p> <p><img src="https://nifichina.gitee.io/image/processors/EvaluateJsonPath/result.png" alt=""/></p> <p>2：提取流文件json内容，作为输出流的内容。（注意：当选择flowfile-content时，用户只能自定义添加一个属性；如果jsonPath匹配不到，会路由到unmatched）</p> <p><img src="https://nifichina.gitee.io/image/processors/EvaluateJsonPath/config2.png" alt=""/></p> <p>输出流内容：</p> <p><img src="https://nifichina.gitee.io/image/processors/EvaluateJsonPath/result2.png" alt=""/></p>