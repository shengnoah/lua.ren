---
layout: post
title: Lua 学习 chapter2  
tags: [lua文章]
categories: [topic]
---


                
                

				<h3 id="目录">目录</h3>
<ol>
  <li>Eeight Queen</li>
  <li>判断是否可以放置</li>
  <li>递归放置</li>
  <li>只打印第一个值</li>
  <li>排列的方式</li>
  <li>对比</li>
</ol>



<h2 id="eight-queen">Eight Queen</h2>
<p>8皇后问题：
在一个8*8的棋盘上放置八个皇后，她们之间相互不能影响。
通过一个表来存储，键值表示行，值表示列。</p>

<h2 id="判断是否可以放置">判断是否可以放置</h2>
<p>因为键值已经保证不会再同一行，所以我们需要判断的就只有列和斜方向的。
在斜方向，左斜和右斜。右斜列减行相同则同处一斜行。左斜行列相加则处于同斜行。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">checkAttack</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="o">==</span> <span class="n">c</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="ow">or</span> <span class="c1">--行列式</span>
                <span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">==</span> <span class="n">c</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="k">then</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="递归放置">递归放置</h2>
<p>通过判断是否每一行都放置了棋子来决定是否打印这个棋谱。
在addQueen中，每一个节点都会一直的递归，所有的节点递归结束。
当然在中间不满足条件的后面的节点就不会递归了。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">addQueen</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">N</span> <span class="k">then</span>
        <span class="n">printTable</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="k">for</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="k">do</span>
            <span class="k">if</span> <span class="n">checkAttack</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
                <span class="n">table</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
                <span class="n">addQueen</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="只打印第一个值">只打印第一个值</h2>
<p>在addQueen前面加一个判断，如果打印了一个可行解就不再进行冗余递归了。</p>

<h2 id="排列的方式">排列的方式</h2>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre><span class="c1">---@param t table|number</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">deepCopy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"number"</span> <span class="k">then</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">do</span>
            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="k">end</span>

<span class="c1">---@param table table</span>
<span class="c1">---@param n number</span>
<span class="c1">---return table</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">insertNumber</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepCopy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="k">end</span>

<span class="c1">---@param t1 table</span>
<span class="c1">---@param t2 table</span>
<span class="c1">---@return table</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">mergeTable</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">length</span> <span class="o">=</span> <span class="o">#</span><span class="n">t1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">t2</span> <span class="k">do</span>
        <span class="nb">table.insert</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">length</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="c1">---@param table table</span>
<span class="c1">---@param n number</span>
<span class="c1">---@return table</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">arrangement</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">temp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">t</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">tt</span> <span class="o">=</span> <span class="n">insertNumber</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">mergeTable</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">temp</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">getArrangement</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">table</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">N</span> <span class="k">do</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">arrangement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">table</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="n">tr</span> <span class="o">=</span> <span class="n">getArrangement</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span> <span class="k">do</span>
    <span class="kd">local</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">do</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checkAttack</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="k">break</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="k">then</span>
        <span class="n">printTable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Total number:"</span><span class="p">,</span> <span class="o">#</span><span class="n">tr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Total answer2:"</span> <span class="o">..</span> <span class="n">totalResult</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Method2 time:"</span><span class="p">,</span> <span class="nb">os.clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="对比">对比</h2>

<p><img src="https://i.imgur.com/GTTE5EV.png" alt=""></p>

<p><img src="https://i.imgur.com/slauuLs.png" alt=""></p>

<p>方法2：排列花费1.604秒，检测花费将近1.1秒，这说明排列还是浪费了很多时间在检测和排列上面的。</p>



                
                
                <hr style="visibility: hidden;">