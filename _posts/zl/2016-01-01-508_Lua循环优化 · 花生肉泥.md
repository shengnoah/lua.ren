---
layout: post
title: Lua循环优化 · 花生肉泥 
tags: [lua文章]
categories: [topic]
---
<h3 id="关于大量字符串连接-（速度提升100倍）"><a href="#关于大量字符串连接-（速度提升100倍）" class="headerlink" title="关于大量字符串连接 （速度提升100倍）"></a>关于大量字符串连接 （速度提升100倍）</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">a = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="keyword">local</span> s = <span class="string">&#39;&#39;</span></span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">100000</span> <span class="keyword">do</span></span><br/><span class="line">    s = s .. <span class="string">&#39;a&#39;</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">b = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="built_in">print</span>(b-a)    <span class="comment">-- 1.708秒</span></span><br/><span class="line"></span><br/><span class="line">a = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="keyword">local</span> s = <span class="string">&#39;&#39;</span></span><br/><span class="line"><span class="keyword">local</span> t = {}</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">100000</span> <span class="keyword">do</span></span><br/><span class="line">    t[#t+<span class="number">1</span>] = <span class="string">&#39;a&#39;</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">s = <span class="built_in">table</span>.<span class="built_in">concat</span>(t,<span class="string">&#39;&#39;</span>)</span><br/><span class="line">b = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="built_in">print</span>(b-a)    <span class="comment">-- 0.011秒</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="关于创建大量小size的表（大概速度提升1倍）"><a href="#关于创建大量小size的表（大概速度提升1倍）" class="headerlink" title="关于创建大量小size的表（大概速度提升1倍）"></a>关于创建大量小size的表（大概速度提升1倍）</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建大量小size表时，应该先填充好表的大小</span></span><br/><span class="line">a = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">2000000</span> <span class="keyword">do</span></span><br/><span class="line">    <span class="keyword">local</span> a = {}</span><br/><span class="line">    a[<span class="number">1</span>] = <span class="number">1</span>;a[<span class="number">2</span>] = <span class="number">2</span>;a[<span class="number">3</span>] = <span class="number">3</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">b = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="built_in">print</span>(b-a)    <span class="comment">-- 1.361秒</span></span><br/><span class="line"></span><br/><span class="line">a = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">2000000</span> <span class="keyword">do</span></span><br/><span class="line">    <span class="keyword">local</span> a = {<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>}</span><br/><span class="line">    a[<span class="number">1</span>] = <span class="number">1</span>;a[<span class="number">2</span>] = <span class="number">2</span>;a[<span class="number">3</span>] = <span class="number">3</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">b = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br/><span class="line"><span class="built_in">print</span>(b-a)    <span class="comment">-- 0.623秒</span></span><br/></pre></td></tr></tbody></table></figure>