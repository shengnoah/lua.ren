---
layout: post
title: lua tutorial 
tags: [lua文章]
categories: [topic]
---
<hr/>
    <div id="content">
      <h2 id="what-is-lua-">What is Lua ?</h2>

<p><img src="https://wenchma.github.io//img/lua.png" alt=""/></p>

<p>Lua is a powerful, efficient, lightweight, embeddable scripting language, 用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。
Lua 是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组，由Roberto Ierusalimschy、Waldemar Celes 和 Luiz Henrique de Figueiredo所组成并于1993年开发。</p>

<p>Lua supports procedural programming, object-oriented programming, functional programming, data-driven programming, and data description.</p>

<h2 id="installation">Installation</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -R -O http://www.lua.org/ftp/lua-5.3.3.tar.gz
tar zxf lua-5.3.3.tar.gz
cd lua-5.3.3
# build Lua
make linux

# test your building
make test

# if ok
$ sudo make install
cd src &amp;&amp; mkdir -p /usr/local/bin /usr/local/include /usr/local/lib /usr/local/man/man1 /usr/local/share/lua/5.1 /usr/local/lib/lua/5.1
cd src &amp;&amp; install -p -m 0755 lua luac /usr/local/bin
cd src &amp;&amp; install -p -m 0644 lua.h luaconf.h lualib.h lauxlib.h ../etc/lua.hpp /usr/local/include
cd src &amp;&amp; install -p -m 0644 liblua.a /usr/local/lib
cd doc &amp;&amp; install -p -m 0644 lua.1 luac.1 /usr/local/man/man1
$ lua -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
</code></pre></div></div>

<p>You can also install lua pkg management tool (like python pip, ruby gem):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get install luarocks
$ sudo luarocks install luasocket
Installing http://luarocks.org/repositories/rocks/luasocket-3.0rc1-2.src.rock...
Using http://luarocks.org/repositories/rocks/luasocket-3.0rc1-2.src.rock... switching to &#39;build&#39; mode
Archive:  /tmp/luarocks_luarocks-rock-luasocket-3.0rc1-2-1445/luasocket-3.0rc1-2.src.rock
  inflating: luasocket-3.0rc1-2.rockspec  
 extracting: v3.0-rc1.zip            
Archive:  v3.0-rc1.zip
</code></pre></div></div>

<blockquote>
  <p>Note: <code class="highlighter-rouge">make xxx</code>, where xxx is your platform name. eg. linux, macosx, freebsd…</p>
</blockquote>

<h2 id="lua-tutorial">Lua Tutorial</h2>

<h3 id="lua-hello-world">Lua Hello World</h3>

<ol>
  <li>Interactive mode:</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ lua
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
&gt; print(&#34;hello&#34;..&#34; world&#34;)
hello world
&gt;
</code></pre></div></div>

<ol>
  <li>Lua scripts:</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/local/bin/lua</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello&#34;</span><span class="o">..</span><span class="s2">&#34; World！&#34;</span><span class="p">)</span>

<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">lua</span> 
<span class="n">Hello</span> <span class="n">World</span><span class="err">！</span>

<span class="err">$</span> <span class="n">lua</span> <span class="n">test</span><span class="p">.</span><span class="n">lua</span> 
<span class="n">Hello</span> <span class="n">World</span><span class="err">！</span>
</code></pre></div></div>

<h3 id="example-http-request">Example: Http Request</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env lua</span>
<span class="kd">local</span> <span class="n">http</span><span class="o">=</span><span class="nb">require</span><span class="p">(</span><span class="s2">&#34;socket.http&#34;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">ltn12</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&#34;ltn12&#34;</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">request_body</span> <span class="o">=</span> <span class="s">[[login=admin&amp;password=pass]]</span>
<span class="kd">local</span> <span class="n">response_body</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&#34;/v1/users&#34;</span>
<span class="kd">local</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://example.com&#34;</span>
<span class="kd">local</span> <span class="n">token</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>

<span class="kd">local</span> <span class="n">res</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">response_headers</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">{</span>
	<span class="n">url</span> <span class="o">=</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">&#34;%s/%s&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span>
	<span class="n">method</span> <span class="o">=</span> <span class="s2">&#34;GET&#34;</span><span class="p">,</span>
	<span class="n">headers</span> <span class="o">=</span>
	  <span class="p">{</span>
	  	<span class="p">[</span><span class="s2">&#34;Content-Type&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;application/x-www-form-urlencoded&#34;</span><span class="p">;</span>
	  <span class="p">},</span>
	  <span class="n">source</span> <span class="o">=</span> <span class="n">ltn12</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">request_body</span><span class="p">),</span>
	  <span class="n">sink</span> <span class="o">=</span> <span class="n">ltn12</span><span class="p">.</span><span class="n">sink</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">response_body</span><span class="p">),</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">response_headers</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;table&#34;</span> <span class="k">then</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">response_headers</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Response body:&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;table&#34;</span> <span class="k">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">table.concat</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>
  <span class="k">else</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Not a table:&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>
  <span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>Note: If for https request, you can use Lua ssl lib. <code class="highlighter-rouge">require(&#34;ssl.https&#34;)</code>.
  First, install Lua package manager: <code class="highlighter-rouge">sudo apt-get install luarocks</code></p>
</blockquote>

<h3 id="trouble-shooting">Trouble Shooting</h3>

<p>If :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># luarocks install luasec OPENSSL_LIBDIR=/usr/lib/x86_64-linux-gnu/
Warning: Failed searching manifest: Failed extracting manifest file
Installing https://raw.githubusercontent.com/rocks-moonscript-org/moonrocks-mirror/master/luasec-0.6-1.rockspec...
Using https://raw.githubusercontent.com/rocks-moonscript-org/moonrocks-mirror/master/luasec-0.6-1.rockspec... switching to &#39;build&#39; mode

Error: Could not find expected file openssl/ssl.h, or openssl/ssl.h for OPENSSL -- you may have to install OPENSSL in your system and/or pass OPENSSL_DIR
or OPENSSL_INCDIR to the luarocks command. Example: luarocks install luasec OPENSSL_DIR=/usr/local
</code></pre></div></div>

<p>It means to install <code class="highlighter-rouge">openssl</code> lib first. To install openssl:
$ sudo apt-get install  openssl libssl-dev.
then,
<code class="highlighter-rouge">sudo luarocks install luasec OPENSSL_LIBDIR=/usr/lib/x86_64-linux-gnu/</code> or <code class="highlighter-rouge">sudo luarocks install luasec</code>.</p>

<h3 id="reference">Reference</h3>

<ul>
  <li><a href="http://www.lua.org/manual/5.3/">Lua 5.3 Manual</a></li>
  <li><a href="http://www.runoob.com/lua/lua-tutorial.html">Lua Tutorial</a></li>
</ul>

    </div>
    <hr/>