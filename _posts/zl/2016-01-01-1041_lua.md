---
layout: post
title: lua 
tags: [lua文章]
categories: [topic]
---
**Contents**

##### command

    
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    10  
    11  
    12  
    13  
    14  
    15  
    16  
    17  
    18  
    19  
    20  
    21  
    22  
    23  
    24  
    25  
    26  
    27  
    28  
    29  
    30  
    31  
    32  
    33  
    34  
    35  
    36  
    37  
    38  
    39  
    40  
    41  
    42  
    43  
    44  
    45  
    46  
    47  
    48  
    49  
    50  
    51  
    52  
    53  
    54  
    55  
    56  
    57  
    58  
    59  
    60  
    61  
    62  
    63  
    64  
    65  
    66  
    67  
    68  
    69  
    70  
    71  
    72  
    73  
    74  
    75  
    76  
    77  
    78  
    79  
    80  
    81  
    82  
    83  
    84  
    85  
    86  
    87  
    88  
    89  
    90  
    91  
    92  
    93  
    94  
    95  
    96  
    97  
    98  
    99  
    100  
    101  
    

|

    
    
    command_func = {}  
      
    function command_func.help()  
    	print("{"i", "input", "require", "GetFirstInputFile"}")  
    	print("{"i", "input", " no", "GetFirstInputFile"}")  
    	print("separator is "#"!")  
    end  
      
    --将长参数和短参数分开  存到tab中  
    function command_func.argToTab(arg)  
    	local tabArg = {}  
    	local argTabKey = nil  
    	for i,v in ipairs(arg) do  
    		cFirstChar = string.sub(v, 1, 1)  
    		if cFirstChar == "-" then  
    			argTabKey = v  
    		elseif argTabKey ~= nil then  
    			if tabArg[argTabKey] == nil then  
    				tabArg[argTabKey] = v  
    			else  
    				tabArg[argTabKey] =  tabArg[argTabKey] .. "#" ..v  
    			end  
    		end  
    	end  
    	return tabArg  
    end  
      
    function command_func.integrationSameMeanArg(tabArg, commandList)  
    	if next(tabArg) == nil or next(commandList) == nil then  
    		print("command is error")  
    		return nil  
    	end  
    	for commandListKey,commandListValue in ipairs(commandList) do  
    		flag = false  
    		local allCommand = nil  
    		for tabArgKey,tabArgValue in pairs(tabArg) do  
    			if tabArgKey == commandListValue[1] or tabArgKey == commandListValue[2] then			  
    				allCommand = tabArgValue  
    			end  
    		end  
    		tabArg[commandListValue[1]] = allCommand  
    		tabArg[commandListValue[2]] = nil  
    	end  
    	return tabArg  
    end  
      
    function command_func.comandAnalysis(arg, commandList)  
    	local argMatchcommandList = false  
      
    	local tabArg =  command_func.argToTab(arg)  
    	if next(tabArg) == nil then  
    		print("command is empty")  
    		return false  
    	end  
      
    	local commandList = command_func.processCommandListAndCheckLegality(commandList)  
    	if commandList == nil then  
    		return false  
    	end  
      
    	tabArg = command_func.integrationSameMeanArg(tabArg, commandList)  
    	if tabArg == nil then  
    		return false  
    	end  
      
    	for commandListKey, commandListValue in ipairs(commandList) do  
    		argMatchcommandList = false  
    		for tabArgKey, tabArgValue in pairs(tabArg) do  
    			if tabArgKey == commandListValue[1] or tabArgKey == commandListValue[2] then  
    				commandListValue[4](tabArgValue)  
    				argMatchcommandList = true  
    			end  
    		end  
      
    		if commandListValue[3] == "require" and argMatchcommandList == false then					  
    			print("command or commandList is not match!")  
    			return false  
    		end  
    	end  
      
    	return true  
    end  
      
    function  command_func.processCommandListAndCheckLegality(commandList)  
    	local commandList1 = commandList  
    	if next(commandList1) == nil then  
    		print("commandList is empty")  
    		return nil  
    	end  
    	for i,v in ipairs(commandList1) do  
    		v[1] = "-" .. v[1]  
    		v[2] = "--" .. v[2]  
    		if v[4] == nil then  
    			return nil  
    		end  
    	end  
    	return commandList1  
    end  
      
      
    return command_func  
      
  
---|---  
  
##### Test

    
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    10  
    11  
    12  
    13  
    14  
    15  
    16  
    17  
    18  
    19  
    20  
    21  
    

|

    
    
    require("command")  
    local function getFirstFile(firstFileName)  
    	print(firstFileName)  
    end  
    local function getCompareFile(compareFileName)  
    	print(compareFileName)  
    end  
    local function getSecondFile(secondFileName)  
    	print(secondFileName)  
    end  
    argList =  
    	{  
    		{"i", "input", "require", getFirstFile},  
    		{"o", "output", "require", getCompareFile},  
    		{"s", "second", "no", getSecondFile},  
    	}  
      
    local result = command_func.comandAnalysis(arg, argList)  
    if result == false then  
    	command_func.help()  
    end  
      
  
---|---  
  
##### compare

    
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    10  
    11  
    12  
    13  
    14  
    15  
    16  
    17  
    18  
    19  
    20  
    21  
    22  
    23  
    24  
    25  
    26  
    27  
    28  
    29  
    30  
    31  
    32  
    33  
    34  
    35  
    36  
    37  
    38  
    39  
    40  
    41  
    42  
    43  
    44  
    45  
    46  
    47  
    48  
    49  
    50  
    51  
    52  
    53  
    54  
    55  
    56  
    57  
    58  
    59  
    60  
    61  
    

|

    
    
    strFristFile = arg[1]  
    strSecondFile = arg[2]  
    strCompareFile = arg[3]  
      
    --根据命令行参数输入相关的文件命令  
    if strFristFile == nil or strSecondFile == nil then  
    	print("You do not enter the comparison file A or B / A and B, please check the command line parameters!")  
    	return 0  
    end  
      
    filePointerFrist = io.open(strFristFile, "r")  
    filePointerSencond = io.open(strSecondFile, "r")  
    if strCompareFile ~= nil then  
    	compareFilePointer = io.open(strCompareFile, "w")  
    else  
    	compareFilePointer = io.open("CompareFile.txt", "w")  
    end  
      
    --判断文件是否为空 或者说文件是否打开成功  
    if filePointerFrist == nil and filePointerSencond == nil then  
    	print("All files are empty!")  
    	return 0  
    elseif filePointerFrist == nil then  
    	print(strFristFile, "文件指针为nil!")  
    	return 0  
    elseif filePointerSencond == nil then  
    	print(strSecondFile, "文件指针为nil!")  
    	return 0  
    end  
      
    --读文件并做比较  
    local strFirstLine = filePointerFrist:read("*l")  
    local strSecondLine = filePointerSencond:read("*l")  
    while strFirstLine ~= nil and strSecondLine ~= nil do  
    	if strFirstLine ~= strSecondLine then  
    		compareFilePointer:write(strFristFile, "显示："", strFirstLine, " " 和", strSecondFile, "显示为：" ", strSecondLine, " " 不同n")  
    	end  
    	strFirstLine = filePointerFrist:read("*l")  
    	strSecondLine = filePointerSencond:read("*l")  
    end  
      
    --文件行数不一样的情况  
    if strFirstLine == nil and strSecondLine == nil then  
    	print("file is null/ line is equal！")  
    elseif strFirstLine == nil then  
    	tempLine = strSecondLine;  
    	strSecondLine = filePointerSencond:read("*a")  
    	--Write = tempLine..strSecondLine  
    	strWrite = table.concat({tempLine, strSecondLine})  
    	compareFilePointer:write(strFristFile, "为空，和", strSecondFile, "显示为：" ", strWrite, " " 不同n")  
    elseif strSecondLine == nil then  
    	tempLine = strFirstLine  
    	strFirstLine = filePointerFrist:read("*a")  
    	--strWrite = tempLine..strFirstLine  
    	strWrite = table.concat({tempLine, strFirstLine})  
    	compareFilePointer:write(strSecondFile, "为空，和", strFristFile, "显示为："", strWrite, " " 不同n")  
    end  
      
    filePointerFrist:close()  
    filePointerSencond:close()  
    compareFilePointer:close()  
      
  
---|---