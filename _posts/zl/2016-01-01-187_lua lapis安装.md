---
layout: post
title: lua lapis安装 
tags: [lua文章]
categories: [topic]
---
<article class="article" itemscope itemprop="blogPost">
    
    
    
    <section class="article-body markdown-body">
        
        <h3 id="lapis安装">
<a href="http://www.mhwkhome.cn/#lapis%E5%AE%89%E8%A3%85" class="headerlink" title="lapis安装"></a>lapis安装</h3>
<p><a href="http://leafo.net/lapis/" target="_blank" rel="noopener noreferrer">lapis</a>是lua中的web框架，基于<a href="http://openresty.org/cn/" target="_blank" rel="noopener noreferrer">openresty</a>,直接和nginx整合在一起，<br>支持lua和<a href="http://moonscript.org/" target="_blank" rel="noopener noreferrer">moonscript</a>.</p>

<h4 id="安装openresty">
<a href="http://www.mhwkhome.cn/#%E5%AE%89%E8%A3%85openresty" class="headerlink" title="安装openresty"></a>安装openresty</h4>
<p>openresty有win，linux，mac等版本，但为了更方便的安装lapis，建议在linux上安装，我这边使用的是centos7(我在win10上折腾了一天，还没装好lapis)</p>
<p>首先下载openresty，现在最新的是1.15版本，不建议安装（会出现一个全局变量导致的线程竞争的警告），建议用比这低一点的版本，但是也别太低，我用的是1.13.6.2版本</p>
<figure class="highlight bash"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td>
<td class="code"><pre><span class="line"></span><br><span class="line">yum install pcre-devel openssl-devel gcc curl unzip</span><br><span class="line"></span><br><span class="line">wget https://openresty.org/download/openresty-1.13.6.2.tar.gz</span><br><span class="line">tar zxvf openresty-1.13.6.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openresty-1.13.6.2/</span><br><span class="line">./configure</span><br><span class="line">gmake &amp;&amp; gmake install</span><br></pre></td>
</tr></table></figure>

<p>默认安装在/usr/local/openresty中<br>可以进去看看</p>
<figure class="highlight bash"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td>
<td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/openresty</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> site/lualib</span><br><span class="line">mkdir work</span><br><span class="line"><span class="built_in">cd</span> work</span><br><span class="line">mkdir logs/ conf/</span><br><span class="line">vim /conf/nginx/conf</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log logs/error.log;</span><br><span class="line">events {</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">}</span><br><span class="line">http {</span><br><span class="line">    server {</span><br><span class="line">        listen 8080;</span><br><span class="line">        location / {</span><br><span class="line">            default_type text/html;</span><br><span class="line">            content_by_lua_block {</span><br><span class="line">                ngx.say(<span class="string">"&lt;p&gt;hello, world&lt;/p&gt;"</span>)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/openresty/nginx/sbin/nginx -p `<span class="built_in">pwd</span>`/ -c conf/nginx.conf</span><br><span class="line"></span><br><span class="line">curl http://localhost:8080</span><br><span class="line"></span><br></pre></td>
</tr></table></figure>

<p>openresty安装成功,<strong>最后记得把nginx进程杀掉哟</strong></p>
<h4 id="安装luarocks">
<a href="http://www.mhwkhome.cn/#%E5%AE%89%E8%A3%85luarocks" class="headerlink" title="安装luarocks"></a>安装luarocks</h4>
<p>luarocks是lua的包管理器，centos7自带lua5.1版本，但是我们用openresty自带的luajit更好，因此不需要安装lua，直接装luarocks就行</p>
<figure class="highlight bash"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td>
<td class="code"><pre><span class="line"> wget http://luarocks.github.io/luarocks/releases/luarocks-3.1.3.tar.gz</span><br><span class="line"> tar zxvf luarocks-3.1.3.tar.gzcd </span><br><span class="line"> <span class="built_in">cd</span> luarocks-3.1.3/</span><br><span class="line"> ./configure --prefix=/usr/<span class="built_in">local</span>/openresty/luajit </span><br><span class="line">    --with-lua=/usr/<span class="built_in">local</span>/openresty/luajit/ </span><br><span class="line">    --lua-suffix=jit </span><br><span class="line">    --with-lua-include=/usr/<span class="built_in">local</span>/openresty/luajit/include/luajit-2.1</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">vim ~/.bash_profile</span><br><span class="line"> <span class="comment">#加入PATH=$PATH:/usr/local/openresty/luajit/bin</span></span><br><span class="line"> <span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"> </span><br><span class="line"> luarocks install moonscript</span><br><span class="line"> luarocks install lapis</span><br></pre></td>
</tr></table></figure>

<p>到这里lapis就安装完成了</p>
<h4 id="测试lapis">
<a href="http://www.mhwkhome.cn/#%E6%B5%8B%E8%AF%95lapis" class="headerlink" title="测试lapis"></a>测试lapis</h4>
<figure class="highlight bash"><table><tr>
<td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td>
<td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/openresty/site/lualib</span><br><span class="line">lapis new --lua</span><br><span class="line">lapis server</span><br><span class="line"></span><br><span class="line"> curl http://localhost:8080</span><br><span class="line"><span class="comment">#&lt;!DOCTYPE HTML&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;Lapis Page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Welcome to Lapis 1.7.0&lt;/body&gt;&lt;/html&gt;[root@VM_0_6_centos ~]</span></span><br></pre></td>
</tr></table></figure>

<p>lapis默认前台运行，方便开发</p>

        
    </section>
</article>



<div class="comments">
    
    
    
</div>