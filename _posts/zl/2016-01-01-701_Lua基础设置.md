---
layout: post
title: Lua基础设置 
tags: [lua文章]
categories: [topic]
---
<p>#Lua</p>
<blockquote>
<p>Lua 是一种轻量小巧的脚本语言，其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。详情参阅<a href="http://www.runoob.com/lua/lua-tutorial.html" target="_blank" rel="noopener noreferrer">Lua 教程</a></p>
</blockquote>
<p>在LIMS系统中，无需进行lua环境的安装搭建，只需在编辑器(win系统推荐notepad++)中写好再粘贴到网页中即可，甚至可以直接在网页中直接编写。</p>
<p><em>无论有没有写过Lua的经历，都推荐通读下此文章，<strong>进阶</strong>中提到的，也是期望您全部理解</em></p>
<p>##基础</p>
<p>###注释</p>
<blockquote>
<p>两个减号是单行注释:</p>
<pre><code>--自定义脚本
</code></pre></blockquote>
<p>###标示符</p>
<blockquote>
<p>Lua 标示符用于定义一个变量。标示符以一个字母 A 到 Z 或 a 到 z 或下划线 _ 开头后    加上0个或多个字母，下划线，数字(0到9)。</p>
<p>赋值是改变一个变量的值和改变表域的最基本的方法。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line">&gt;a = &#34;hello&#34; .. &#34;world&#34;</span><br/><span class="line">&gt;t.n = t.n + 1</span><br/><span class="line">&gt;</span><br/></pre></td></tr></tbody></table></figure>
</blockquote>
<p><strong>LIMS中的自定义脚本只关注于几个结果：</strong></p>
<ul>
<li><p>预约自定义脚本只关注于<code>can_reserv</code> <code>(boolean)</code>与<code>err_msg</code> <code>(string)</code>两个变量</p>
<p>_<code>can_reserv</code>为<code>true</code>时，当前用户操作(添加、编辑、删除)预约有效，当为<code>false</code>时，操作无效，并提示<code>err_msg</code>信息_</p>
<p>Demo:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">can_resrv = <span class="literal">false</span></span><br/><span class="line">err_msg = <span class="string">&#34;不约不约，叔叔我们不约&#34;</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
<li><p>计费自定义脚本只关注于<code>fee</code> <code>(number)</code>与<code>description</code> <code>(string)</code>两个变量</p>
<p><em><code>fee</code>为此次计费金额，<code>description</code>为计费备注(当计费不为0时必须)</em></p>
<p>Demo:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--开机费20块，使用每小时免费</span></span><br/><span class="line">fee = <span class="number">20</span></span><br/><span class="line">description = T(<span class="string">&#34;&lt;p&gt;原价1百多，2百多，3百多的钱包，通通20块&lt;/p&gt;&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p>###流程控制</p>
<blockquote>
<p>Lua 编程语言流程控制语句通过程序设定一个或多个条件语句来设定。在条件为 true 时执行指定程序代码，在条件为 false 时执行其他指定代码。LIMS中的Lua脚本高频使用<code>if</code>进行流程控制</p>
</blockquote>
<ul>
<li><code>if</code>语句及<code>elseif</code>语句后要加<code>then</code>，<code>else</code>后不用。</li>
<li>闭合<code>if</code>要用<code>end</code>语句。</li>
<li><p><strong>强烈建议缩进规范。</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">if</span> ( a &lt;= <span class="number">10</span> ) </span><br/><span class="line"><span class="keyword">then</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;a 小于 10&#34;</span>)</span><br/><span class="line"><span class="keyword">elseif</span> ( a == <span class="number">10</span> ) </span><br/><span class="line"><span class="keyword">then</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;a 的值为 10&#34;</span>)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">   <span class="built_in">print</span>(<span class="string">&#34;a 大于 10&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p><strong>进阶：</strong><code>if</code>语句一定要覆盖全部可能性。以预约脚本为例:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--校内用户的预约开始时间，只能是每天八点后</span></span><br/><span class="line">can_resrv = <span class="literal">false</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">if</span> ( user_tag(<span class="string">&#34;校内&#34;</span>) ) <span class="keyword">then</span></span><br/><span class="line">	<span class="keyword">if</span> (dateT(start_time)[<span class="string">&#39;hour&#39;</span>] &gt;= <span class="number">8</span> ) <span class="keyword">then</span></span><br/><span class="line">		can_reserv = <span class="literal">true</span></span><br/><span class="line">	<span class="keyword">else</span> </span><br/><span class="line">		err_msg = <span class="string">&#34;校内用户的预约开始时间，只能是每天八点后&#34;</span>;</span><br/><span class="line">	<span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>这段虽然保存到LIMS时不会报错，可是当非校内用户预约时，会得到“自定义脚本未知错误”的提示</p>
<p>###Lua 运算符</p>
<blockquote>
<p>运算符是一个特殊的符号，用于告诉解释器执行特定的数学或逻辑运算。<br/>Lua提供了以下几种运算符类型：</p>
<ul>
<li>算术运算符</li>
<li>关系运算符</li>
<li>逻辑运算符</li>
<li>其他运算符</li>
</ul>
</blockquote>
<p>必要了解的运算符：<code>==</code> <code>and</code> <code>or</code> <code>not</code> <code>..</code> <code>#</code><em>(<code>#</code>后面会有使用示例)</em></p>
<p><a href="http://www.runoob.com/lua/lua-miscellaneous-operator.html" target="_blank" rel="noopener noreferrer">Lua 运算符</a> 已经介绍得非常详细了，不再赘述。</p>
<p>###Lua 函数</p>
<p>编写LIMS使用到的Lua脚本时，我们很少在Lua中定义函数。Lua 提供了许多的内建函数，足以满足需求，更重要的是，LIMS为Lua脚本开放了许多函数，Lua脚本中只要调用就好了。</p>
<p><strong>进阶：</strong>內建函数推荐了解下<a href="http://www.runoob.com/manual/lua53doc/manual.html#6.7" target="_blank" rel="noopener noreferrer">math库</a></p>
<p>LIMS中脚本具体可以使用哪些函数，详见下一篇教程<a href="http://dev.genee.cn/doku.php/public/luafunc.md" target="_blank" rel="noopener noreferrer">LIMS开放的Lua函数</a>。</p>
<p>##结语</p>
<ul>
<li>掌握此篇设计到的知识后，即可独立完成90%以上的Lua脚本编写。</li>
<li>如果遇到功能，不清楚能否实现、如何实现，请阅读<a href="http://dev.genee.cn/doku.php/public/luafunc.md" target="_blank" rel="noopener noreferrer">LIMS开放的Lua函数</a>。</li>
<li>如果本篇有知识遗漏或者错误，欢迎随时联系作者。</li>
<li>如果想再深入了解Lua，甚至可以细读<a href="http://www.runoob.com/manual/lua53doc/contents.html" target="_blank" rel="noopener noreferrer">Lua 5.3 参考手册</a>。</li>
</ul>