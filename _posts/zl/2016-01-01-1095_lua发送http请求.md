---
layout: post
title: lua发送http请求 
tags: [lua文章]
categories: [topic]
---
<div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
    </div>
    

    <h3 id="直接发送"><a href="#直接发送" class="headerlink" title="直接发送"></a>直接发送</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><div class="line">local http = require(&#34;socket.http&#34;);</div><div class="line">local body = http.request(&#34;http://x86.pub&#34;);</div><div class="line">print(body)</div></pre></td></tr></tbody></table></figure>
<h3 id="获取状态码"><a href="#获取状态码" class="headerlink" title="获取状态码"></a>获取状态码</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><div class="line">local http = require(&#34;socket.http&#34;);</div><div class="line">local body, code = http.request(&#34;http://x86.pub&#34;);</div><div class="line">print(body)</div><div class="line">print(code)</div></pre></td></tr></tbody></table></figure>
<h3 id="获取-response-header"><a href="#获取-response-header" class="headerlink" title="获取 response header"></a>获取 response header</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><div class="line">local http = require(&#34;socket.http&#34;);</div><div class="line">local body, code, response_headers = http.request(&#34;http://x86.pub&#34;);</div><div class="line">print_table(response_headers)</div></pre></td></tr></tbody></table></figure>
<h3 id="自定义-http-请求"><a href="#自定义-http-请求" class="headerlink" title="自定义 http 请求"></a>自定义 http 请求</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><div class="line">local http = require(&#34;socket.http&#34;)</div><div class="line"></div><div class="line">local request_body = [[login=user&amp;password=123]]</div><div class="line">local response_body = {}</div><div class="line">local res, code, response_headers = http.request {</div><div class="line">    url = &#34;http://httpbin.org/post&#34;,</div><div class="line">    method = &#34;POST&#34;,</div><div class="line">    headers = {</div><div class="line">        [&#34;Content-Type&#34;] = &#34;application/x-www-form-urlencoded&#34;;</div><div class="line">        [&#34;Content-Length&#34;] = #request_body;</div><div class="line">    },</div><div class="line">    source = ltn12.source.string(request_body),</div><div class="line">    sink = ltn12.sink.table(response_body),</div><div class="line">}</div><div class="line"></div><div class="line">print(res)</div><div class="line">print(code)</div><div class="line"></div><div class="line">if type(response_headers) == &#34;table&#34; then</div><div class="line">  for k, v in pairs(response_headers) do</div><div class="line">    print(k, v)</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">print(&#34;Response body:&#34;)</div><div class="line">if type(response_body) == &#34;table&#34; then</div><div class="line">    print(table.concat(response_body))</div><div class="line">else</div><div class="line">    print(&#34;Not a table:&#34;, type(response_body))</div><div class="line">end</div></pre></td></tr></tbody></table></figure>