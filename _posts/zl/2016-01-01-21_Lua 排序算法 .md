---
layout: post
title: Lua 排序算法  
tags: [lua文章]
categories: [topic]
---
<p>快速排序使用分治法（Divide and conquer）策略来把一个序列（list）分为两个子序列（sub-lists）。</p>

<p>分治法的基本思想是：将原问题分解为若干个规模更小但结构与原问题相似的子问题。递归地解这些子问题，然后将这些子问题的解组合为原问题的解。</p>

<h5 id="算法步骤">算法步骤</h5>

<ol>
  <li>从数列中挑出一个元素，称为 “基准”（pivot）</li>
  <li>重新排序数列，所有元素比基准值小的摆放在基准前面，所有元素比基准值大的摆在基准的后面（相同的数可以到任一边）。在这个分区退出之后，该基准就处于数列的中间位置。这个称为分区（partition）操作</li>
  <li>对 “基准” 左边和右边的两个子集，不断重复第一步和第二步，直到所有子集只剩下一个元素为止。</li>
</ol>

<h5 id="动画演示">动画演示</h5>

<p><img src="https://img.dazhuanlan.com/2019/11/27/5dde027bb1627.gif" alt="Alt text"/></p>

<h5 id="lua-实现">Lua 实现</h5>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="k">function</span> <span class="nf">partition</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">low</span> <span class="o">=</span> <span class="n">low</span>
    <span class="kd">local</span> <span class="n">high</span> <span class="o">=</span> <span class="n">high</span>
    <span class="kd">local</span> <span class="n">pivotKey</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="c1">-- 定义一个中介值</span>

    <span class="c1">-- 下面将中介值移动到列表的“中间”</span>
    <span class="c1">-- 当左索引与右索引相邻时停止循环</span>
    <span class="k">while</span> <span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span> <span class="k">do</span>
        <span class="c1">-- 假如当前右值大于等于中介值则右索引左移</span>
        <span class="c1">-- 否则交换中介值和右值位置</span>
        <span class="k">while</span> <span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span> <span class="ow">and</span> <span class="n">list</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pivotKey</span> <span class="k">do</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">high</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">end</span>
        <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">high</span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">]</span>

        <span class="c1">-- 假如当前左值小于等于中介值则左索引右移</span>
        <span class="c1">-- 否则交换中介值和左值位置</span>
        <span class="k">while</span> <span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span> <span class="ow">and</span> <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivotKey</span> <span class="k">do</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">low</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">end</span>
        <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">high</span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n">low</span><span class="p">]</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">low</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">quickSort</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;</span> <span class="n">high</span> <span class="k">then</span>
        <span class="c1">-- 返回列表中中介值所在的位置，该位置左边的值都小于等于中介值，右边的值都大于等于中介值</span>
        <span class="kd">local</span> <span class="n">pivotKeyIndex</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
        <span class="c1">-- 分别将中介值左右两边的列表递归快排</span>
        <span class="n">quickSort</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">pivotKeyIndex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">quickSort</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">pivotKeyIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">-</span><span class="mi">81</span><span class="p">,</span> <span class="o">-</span><span class="mi">93</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">53</span><span class="p">,</span> <span class="o">-</span><span class="mi">31</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">45</span><span class="p">.</span><span class="mi">94</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="o">-</span><span class="mi">95</span><span class="p">.</span><span class="mi">03</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="o">-</span><span class="mi">39</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="o">-</span><span class="mi">23</span><span class="p">,</span> <span class="mi">36</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="o">-</span><span class="mi">41</span>
<span class="p">}</span>
<span class="n">quickSort</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">table.concat</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="s2">&#34;, &#34;</span><span class="p">))</span>
</code></pre></div></div>

<p><strong>值得注意的是 Lua 自带的<code class="highlighter-rouge">table.sort</code>就是使用的快排，性能肯定比这个纯 Lua 的版本要好</strong></p>


                <hr style="visibility: hidden;"/>