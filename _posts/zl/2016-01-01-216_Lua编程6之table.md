---
layout: post
title: Lua编程6之table 
tags: [lua文章]
categories: [topic]
---


      
      

      
        <p>思考并回答以下问题：<br>1.如何初始化表并指定值？<br>2.a和b指向同一个table1，a设置为nil，b还可以访问table1的元素吗？<br>3.table.concat、table.insert、table.remove、table.sort的含义分别是什么？<br>4.#为什么得不到正确的table长度？</p>


<p>Lua中有一个非常重要的数据结构，就是Table，几乎所有高级语法的实现都离不开Table，就像C#中的类一样重要。</p>
<p>table 是 Lua 的一种数据结构，用来创建不同的数据类型，如：数组、字典等。</p>
<p>Lua table 使用关联型数组，你可以用任意类型的值来作数组的索引，但这个值不能是 nil。</p>
<p>Lua table 是不固定大小的，你可以根据自己需要进行扩容。</p>
<p>Lua也是通过table来解决模块（module）、包（package）和对象（Object）的。 例如string.format表示使用”format”来索引table string。</p>
<h2 id="table-表-的构造"><a href="https://chebincarl.github.io/#table-%E8%A1%A8-%E7%9A%84%E6%9E%84%E9%80%A0" class="headerlink" title="table(表)的构造"></a><span style="color:#EF7060;">table(表)的构造</span></h2><p>构造器是创建和初始化表的表达式。表是Lua特有的功能强大的东西。最简单的构造函数是{}，用来创建一个空表。可以直接初始化数组:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mytable = {}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mytable[<span class="number">1</span>]= <span class="string">"Lua"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mytable = <span class="literal">nil</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当我们为 table a 并设置元素，然后将 a 赋值给 b，则 a 与 b 都指向同一个内存。如果 a 设置为 nil ，则 b 同样能访问 table 的元素。如果没有指定的变量指向a，Lua的垃圾回收机制会清理相对应的内存。</p>
<p>以下实例演示了以上的描述情况：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 简单的 table</span></span><br><span class="line">mytable = {}</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 的类型是 "</span>,<span class="built_in">type</span>(mytable))</span><br><span class="line"></span><br><span class="line">mytable[<span class="number">1</span>]= <span class="string">"Lua"</span></span><br><span class="line">mytable[<span class="string">"wow"</span>] = <span class="string">"修改前"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 1 的元素是 "</span>, mytable[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alternatetable和mytable的是指同一个 table</span></span><br><span class="line">alternatetable = mytable</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"alternatetable 索引为 1 的元素是 "</span>, alternatetable[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, alternatetable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line">alternatetable[<span class="string">"wow"</span>] = <span class="string">"修改后"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放变量</span></span><br><span class="line">alternatetable = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"alternatetable 是 "</span>, alternatetable)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mytable 仍然可以访问</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line">mytable = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 是 "</span>, mytable)</span><br></pre></td></tr></table></figure>

<p>以上代码执行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mytable 的类型是     table</span><br><span class="line">mytable 索引为 1 的元素是     Lua</span><br><span class="line">mytable 索引为 wow 的元素是     修改前</span><br><span class="line">alternatetable 索引为 1 的元素是     Lua</span><br><span class="line">mytable 索引为 wow 的元素是     修改前</span><br><span class="line">mytable 索引为 wow 的元素是     修改后</span><br><span class="line">alternatetable 是     nil</span><br><span class="line">mytable 索引为 wow 的元素是     修改后</span><br><span class="line">mytable 是     nil</span><br></pre></td></tr></table></figure>

<h2 id="Table-操作"><a href="https://chebincarl.github.io/#Table-%E6%93%8D%E4%BD%9C" class="headerlink" title="Table 操作"></a><span style="color:#EF7060;">Table 操作</span></h2><p>以下列出了 Table 操作常用的方法：</p>
<p><span style="color:red">table.concat (table [, sep [, start [, end]]])</span>:<br>concat是concatenate(连锁, 连接)的缩写. table.concat()函数列出参数中指定table的数组部分从start位置到end位置的所有元素, 元素间以指定的分隔符(sep)隔开。</p>
<p><span style="color:red">table.insert (table, [pos,] value)</span>:<br>在table的数组部分指定位置(pos)插入值为value的一个元素. pos参数可选, 默认为数组部分末尾.</p>
<p><span style="color:red">table.maxn (table)</span><br>指定table中所有正数key值中最大的key值. 如果不存在key值为正数的元素, 则返回0。(Lua5.2之后该方法已经不存在了，我们自定义一个函数实现)</p>
<p><span style="color:red">table.remove (table [, pos])</span><br>返回table数组部分位于pos位置的元素. 其后的元素会被前移. pos参数可选, 默认为table长度, 即从最后一个元素删起。</p>
<p><span style="color:red">table.sort (table [, comp])</span><br>对给定的table进行升序排序。</p>
<p>** <span style="color:red">实例</span> **<br>接下来我们来看下这几个方法的实例。</p>
<p>** Table 连接 **<br>我们可以使用 concat() 方法来连接两个 table:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fruits = {<span class="string">"banana"</span>,<span class="string">"orange"</span>,<span class="string">"apple"</span>}</span><br><span class="line"><span class="comment">-- 返回 table 连接后的字符串</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"连接后的字符串 "</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定连接字符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"连接后的字符串 "</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits,<span class="string">", "</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定索引来连接 table</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"连接后的字符串 "</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits,<span class="string">", "</span>, <span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>执行以上代码输出结果为：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">连接后的字符串     bananaorangeapple</span><br><span class="line">连接后的字符串     banana, orange, apple</span><br><span class="line">连接后的字符串     orange, apple</span><br></pre></td></tr></table></figure>

<p>** 插入和移除 **<br>以下实例演示了 table 的插入和移除操作:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fruits = {<span class="string">"banana"</span>,<span class="string">"orange"</span>,<span class="string">"apple"</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在末尾插入</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(fruits,<span class="string">"mango"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"索引为 4 的元素为 "</span>,fruits[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在索引为 2 的键处插入</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(fruits,<span class="number">2</span>,<span class="string">"grapes"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"索引为 2 的元素为 "</span>,fruits[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"最后一个元素为 "</span>,fruits[<span class="number">5</span>])</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">remove</span>(fruits)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"移除后最后一个元素为 "</span>,fruits[<span class="number">5</span>])</span><br></pre></td></tr></table></figure>

<p>执行以上代码输出结果为：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">索引为 <span class="number">4</span> 的元素为     mango</span><br><span class="line">索引为 <span class="number">2</span> 的元素为     grapes</span><br><span class="line">最后一个元素为     mango</span><br><span class="line">移除后最后一个元素为     <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<p>** Table 排序 **<br>以下实例演示了 sort() 方法的使用，用于对 Table 进行排序：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fruits = {<span class="string">"banana"</span>,<span class="string">"orange"</span>,<span class="string">"apple"</span>,<span class="string">"grapes"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"排序前"</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(fruits) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k,v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(fruits)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"排序后"</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(fruits) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k,v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>执行以上代码输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">排序前</span><br><span class="line">1    banana</span><br><span class="line">2    orange</span><br><span class="line">3    apple</span><br><span class="line">4    grapes</span><br><span class="line">排序后</span><br><span class="line">1    apple</span><br><span class="line">2    banana</span><br><span class="line">3    grapes</span><br><span class="line">4    orange</span><br></pre></td></tr></table></figure>

<p>** Table 最大值 **</p>
<p>table.maxn 在 Lua5.2 之后该方法已经不存在了，我们定义了 table_maxn 方法来实现。</p>
<p>以下实例演示了如何获取 table 中的最大值：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(t)</span></span></span><br><span class="line">  <span class="keyword">local</span> mn=<span class="literal">nil</span>;</span><br><span class="line">  <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span>(mn==<span class="literal">nil</span>) <span class="keyword">then</span></span><br><span class="line">      mn=v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> mn &lt; v <span class="keyword">then</span></span><br><span class="line">      mn = v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> mn</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">tbl = {[<span class="number">1</span>] = <span class="number">2</span>, [<span class="number">2</span>] = <span class="number">6</span>, [<span class="number">3</span>] = <span class="number">34</span>, [<span class="number">26</span>] =<span class="number">5</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tbl 最大值："</span>, table_maxn(tbl))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tbl 长度 "</span>, #tbl)</span><br></pre></td></tr></table></figure>

<p>执行以上代码输出结果为：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tbl 最大值：    <span class="number">34</span></span><br><span class="line">tbl 长度     <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>注意：当我们获取 table 的长度的时候无论是使用 # 还是 table.getn 其都会在索引中断的地方停止计数，而导致无法正确取得 table 的长度。</p>
<p>可以使用以下方法来代替：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(t)</span></span></span><br><span class="line">  <span class="keyword">local</span> leng=<span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    leng=leng+<span class="number">1</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> leng;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="https://chebincarl.github.io/#%E6%80%BB%E7%BB%93" class="headerlink" title="总结"></a><span style="color:#039BE5;">总结</span></h1><p>table的花式用法有很多，基于table可以实现各种各样的结构和功能。</p>