---
layout: post
title: Lua模块与包 · 花生肉泥 
tags: [lua文章]
categories: [topic]
---
<p>lua的模块是由变量，函数等已知元素组成的table，因此创建一个模块很简单，就是创建一个table，然后把需要导出的常量，函数放入其中，最后返回这个table就行。</p>
<p>例：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="comment">-- 定义一个名为module的模块</span></span><br/><span class="line">module = {}</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 定义一个常量</span></span><br/><span class="line">module.constant = <span class="string">&#34;这是一个常量&#34;</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 定义一个函数</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br/><span class="line">     <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&#34;这是一个公有函数！&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">func2</span><span class="params">()</span></span></span><br/><span class="line">     <span class="built_in">print</span>(<span class="string">&#34;这是一个私有函数！&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func3</span><span class="params">()</span></span></span><br/><span class="line">     func2()</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">return</span> module</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>由上可知，模块的结构就是一个table结构，因此可以像操作调用table里的元素那样来操作调用模块里的常量或变量</p>
<p>require函数</p>
<p>lua提供了一个名为require的函数来加载模块，要加载一个模块，只要简单的调用就就可以了<br/>例;<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#34;&lt;模块名&gt;&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>或者<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">&#34;&lt;模块名&gt;&#34;</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>执行require后会返回一个由模块常量或函数组成的table，并且还会定义一个包含table的全局变量<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- test_module.lua</span></span><br/><span class="line"><span class="comment">-- module 模块为上文提到的module.lua</span></span><br/><span class="line"><span class="built_in">require</span>(<span class="string">&#34;module&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(module.constant)</span><br/><span class="line"></span><br/><span class="line">module.func3()</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>以上代码执行结果为：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">这是一个常量</span><br/><span class="line">这是一个私有函数！</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>或者给加载的模块定义一个别名变量，方便调用：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- test_module2.lua 文件</span></span><br/><span class="line"><span class="comment">-- module 模块为上文提到的module.lua</span></span><br/><span class="line"><span class="comment">-- 别名变量 m</span></span><br/><span class="line"><span class="keyword">local</span> m = <span class="built_in">require</span>(<span class="string">&#34;module&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(m.constant)</span><br/><span class="line"></span><br/><span class="line">m.func3()</span><br/></pre></td></tr></tbody></table></figure><p></p>