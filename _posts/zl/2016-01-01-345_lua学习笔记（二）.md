---
layout: post
title: lua学习笔记（二） 
tags: [lua文章]
categories: [topic]
---
<h2 id="Lua变量"><a href="#Lua变量" class="headerlink" title="Lua变量"></a>Lua变量</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="comment">Lua变量三种类型：全局变量（储存在名称为_G的table中）、局部变量、table中的域</span></span><br/><span class="line"><span class="comment">Lua中的变量全都是全局变量，即使在语句块或函数里，除非用local显式声明为局部变量</span></span><br/><span class="line"><span class="comment">局部变量作用域与C/C++概念相同</span></span><br/><span class="line"><span class="comment">变量默认值为nil</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="comment">-- test.lua文件脚本</span></span><br/><span class="line">a=<span class="number">1</span>			<span class="comment">-- 全局变量</span></span><br/><span class="line"><span class="keyword">local</span> b=<span class="number">2</span>	<span class="comment">-- 文件内局部变量</span></span><br/><span class="line"> </span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br/><span class="line">    c=<span class="number">5</span>			<span class="comment">-- 全局变量</span></span><br/><span class="line">    <span class="keyword">local</span> d=<span class="number">6</span>	<span class="comment">-- 局部变量</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">rua()</span><br/><span class="line"><span class="built_in">print</span>(c,d)		<span class="comment">--输出:5 nil</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">do</span></span><br/><span class="line">    <span class="keyword">local</span> a=<span class="number">6</span>	<span class="comment">-- 局部变量，这里局部变量覆盖了全局变量，引用外部全局变量时可以用_G.a来引用，类似于C/C++的::a</span></span><br/><span class="line">    b=<span class="number">6</span>			<span class="comment">-- 对局部变量重新赋值</span></span><br/><span class="line">    <span class="built_in">print</span>(a,b)	<span class="comment">-- 输出：6 6</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(a,b)		<span class="comment">-- 输出：5 6</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="赋值语句"><a href="#赋值语句" class="headerlink" title="赋值语句"></a>赋值语句</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 赋值可以改变一个变量的值和表域</span></span><br/><span class="line">a=<span class="string">&#34;hello&#34;</span> .. <span class="string">&#34;world&#34;</span></span><br/><span class="line">t.n=t.n+<span class="number">1</span></span><br/><span class="line"><span class="comment">-- 可以对多个变量同时赋值</span></span><br/><span class="line">a,b=<span class="number">10</span>,<span class="number">2</span>*x		<span class="comment">-- a=10,b=2*x</span></span><br/><span class="line"><span class="comment">-- 赋值语句会先计算右边所有的值，然后再执行赋值操作</span></span><br/><span class="line"><span class="comment">-- 交换变量写法</span></span><br/><span class="line">x,y=y,x</span><br/><span class="line"></span><br/><span class="line"><span class="comment">变量和值个数不一致:</span></span><br/><span class="line"><span class="comment">变量个数&gt;值的个数		按变量个数补足nil</span></span><br/><span class="line"><span class="comment">变量个数&lt;值的个数		多余的值被忽略</span></span><br/><span class="line"><span class="comment">]]</span> </span><br/><span class="line">a,b,c=<span class="number">0</span></span><br/><span class="line"><span class="built_in">print</span>(a,b,c)	<span class="comment">-- 输出：0 nil nil</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- table的索引使用方括号[]和点.的操作</span></span><br/><span class="line">t[i]</span><br/><span class="line">t.i					<span class="comment">-- 当索引为字符串类型时的一种简化写法</span></span><br/><span class="line">gettable_event(t,i)	<span class="comment">-- 采用索引访问本质上是一个类似这样的函数调用</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="Lua循环"><a href="#Lua循环" class="headerlink" title="Lua循环"></a>Lua循环</h2><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(condition) <span class="keyword">do</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="数值for循环"><a href="#数值for循环" class="headerlink" title="数值for循环"></a>数值for循环</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- var从exp1变化到exp2，每次变化以exp3为步长，可选，不指定默认为1</span></span><br/><span class="line"><span class="keyword">for</span> var=exp1,exp2,[exp3] <span class="keyword">do</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="泛型for循环"><a href="#泛型for循环" class="headerlink" title="泛型for循环"></a>泛型for循环</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 相当于foreach</span></span><br/><span class="line">a={<span class="string">&#34;a&#34;</span>,<span class="string">&#34;b&#34;</span>,<span class="string">&#34;c&#34;</span>}</span><br/><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(i,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="repeat…until循环"><a href="#repeat…until循环" class="headerlink" title="repeat…until循环"></a>repeat…until循环</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 相当于C/C++的do...while</span></span><br/><span class="line"><span class="keyword">repeat</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">until</span>(condition)</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="break语句"><a href="#break语句" class="headerlink" title="break语句"></a>break语句</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Lua仅支持break，不支持continue，同其他语言</span></span><br/><span class="line"><span class="keyword">while</span>(condition) <span class="keyword">do</span></span><br/><span class="line">    <span class="keyword">break</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="Lua流程控制"><a href="#Lua流程控制" class="headerlink" title="Lua流程控制"></a>Lua流程控制</h2><h3 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition) <span class="keyword">then</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="if…else语句"><a href="#if…else语句" class="headerlink" title="if…else语句"></a>if…else语句</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 两条分支</span></span><br/><span class="line"><span class="keyword">if</span>(condition) <span class="keyword">then</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 多条分支</span></span><br/><span class="line"><span class="keyword">if</span>(condition1) <span class="keyword">then</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">elseif</span>(condition2) <span class="keyword">then</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">    <span class="comment">-- do something</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>