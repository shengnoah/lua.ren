---
layout: post
title: lua基础 
tags: [lua文章]
categories: [topic]
---
<nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">赵子清技术文章</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> »</li>
        
          <li><a href="../index.html">开发语言</a> »</li>
        
      <li>lua基础</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lua">

<p>Lua本身以简单优雅为美, 着眼于处理那些C不擅长的任务. 借助C/C++为其扩展, Lua可以展现无穷的魅力. Lua本身完全遵循ANSI C写成, 只要有C编译器的地方, Lua便可以发挥它的力量. Lua不需要追求python那样大而全的库, 太多的累赘, 反而会破坏她的优美.</p>
<blockquote>
<div>— &lt;Lua中文教程&gt;译序</div></blockquote>
<p>本文章基于lua 5.2.</p>
<div class="section" id="id1">
<h2>预备知识<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="section" id="id2">
<h3>获得lua<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>lua非常小, 且支持几乎所有的系统. Linux上基本已预装了lua, 其他系统如何获得lua请参考: <a class="reference external" href="http://lua-users.org/wiki/LuaBinaries">http://lua-users.org/wiki/LuaBinaries</a></p>
</div>
<div class="section" id="id3">
<h3>lua命令行<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>安装好lua后, 即可使用lua命令行, 它的使用非常简单:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>usage: lua [options] [script [args]]
Available options are:
  -e stat  execute string &#39;stat&#39;
  -i       enter interactive mode after executing &#39;script&#39;
  -l name  require library &#39;name&#39;
  -v       show version information
  -E       ignore environment variables
  --       stop handling options
  -        stop handling options and execute stdin
</pre></div>
</div>
<p>不加任何参数则进入交互式环境.</p>
<p>arg全局变量保存了所有参数, 脚本名索引为0, 脚本参数的索引从1开始, 而脚本之前参数的索引为负数. 比如运行:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$lua -e &#34;print &#39;hello&#39;&#34; test.lua a b
</pre></div>
</div>
<p>arg保存的值如下:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>arg[-3] = lua
arg[-2] = -e
arg[-1] = print &#39;hello&#39;
arg[0] = test.lua
arg[1] = a
arg[2] = b
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>保留关键字<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>lua的变量命令和C语言一致, 但最好不要使用下划线加大字字母的标识符, 因为这样的标识符一般供内部使用. lua的保留关键字如下:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>and     break   do      else        elseif
end     false   for     function    if
in      local   nil     not         or
repeat  return  then    true        until
while
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>注释<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>单行注释: –</li>
<li>多行注释 –[[  –]]</li>
</ul>
</div>
<div class="section" id="chunk">
<h3>Chunk<a class="headerlink" href="#chunk" title="永久链接至标题">¶</a></h3>
<p>Chunk就是一系列语句. lua执行的语句块, 比如一个文件交互模式下的每一行就是一个chunk.</p>
</div>
</div>
<div class="section" id="id6">
<h2>数据类型<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>lua是动态类型语言, 声明变量时不需要指定数据类型.</p>
<p>lua一其有8种基本类型:</p>
<ul class="simple">
<li>nil</li>
<li>boolean</li>
<li>number</li>
<li>string</li>
<li>userdata</li>
<li>function</li>
<li>thread</li>
<li>table</li>
</ul>
<p>使用type()函数可以查看给定变量或值的类型.</p>
<div class="section" id="string">
<h3>string<a class="headerlink" href="#string" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>字符串字面值可以用单引号也可以用双引号, 最好保持风格统一</li>
<li>还可以用 <code class="docutils literal"><span class="pre">[[string]]</span></code> 这种形式表示字符串, 此时字符串可以包含多行,且不会进行转义</li>
<li>lua会在需要时把number和string进行互相转化, 也可以使用tostring()和tonumber()进行显式转换</li>
<li><code class="docutils literal"><span class="pre">..</span></code> 是字符串连接符, 相当于某些语言中的+</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<ol class="last arabic simple">
<li>在lua里使用条件判断时, 除了false和nil为假, 其他条件都为真, 所以数字0和空字符串也为真.</li>
<li>string里可以有0, 且是可读的, 要修改必须新建一个变量</li>
</ol>
</div>
</div>
<div class="section" id="userdata">
<h3>userdata<a class="headerlink" href="#userdata" title="永久链接至标题">¶</a></h3>
<p>userdata可以将C数据存放在lua变量中, 它除了赋值和相等比较外没有其他操作. userdata用来描述应用程序或者使用C实现的库创建的新类型.</p>
<p>// todo</p>
</div>
<div class="section" id="thread">
<h3>thread<a class="headerlink" href="#thread" title="永久链接至标题">¶</a></h3>
<p>// todo</p>
</div>
</div>
<div class="section" id="id7">
<h2>表达式<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<div class="section" id="id8">
<h3>算术运算符<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>二元: + - * / ^(幂)</p>
<p>一元: -(取负)</p>
</div>
<div class="section" id="id9">
<h3>关系运算符<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>lua关系运算符包括:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>&lt;   &gt;   &lt;=  &gt;=  ==  ~=
</pre></div>
</div>
<p>关系运算符的结果是true或false. 对于table, userdata和function, 是通过引用比较的,而不是值比较.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">不等于是~=而不是!=</p>
</div>
</div>
<div class="section" id="id10">
<h3>逻辑运算符<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>lua逻辑运算符包括:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>and     or    not
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">and和or的结果不是true/false, 而是和2个操作数有关, 见下例.</p>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="mi">4</span> <span class="ow">and</span> <span class="mi">5</span><span class="p">)</span>      <span class="c1">--&gt; 5</span>
<span class="nb">print</span><span class="p">(</span><span class="kc">nil</span> <span class="ow">and</span> <span class="mi">13</span><span class="p">)</span>   <span class="c1">--&gt; nil</span>
<span class="nb">print</span><span class="p">(</span><span class="kc">false</span> <span class="ow">and</span> <span class="mi">13</span><span class="p">)</span> <span class="c1">--&gt; false</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">4</span> <span class="ow">or</span> <span class="mi">5</span><span class="p">)</span>       <span class="c1">--&gt; 4</span>
<span class="nb">print</span><span class="p">(</span><span class="kc">false</span> <span class="ow">or</span> <span class="mi">5</span><span class="p">)</span>   <span class="c1">--&gt; 5</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>连接运算符<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<p>即两个点 <code class="docutils literal"><span class="pre">..</span></code> , 使用时最好在两边加上空格.</p>
</div>
<div class="section" id="id12">
<h3>运算符优先级<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>lua运算符优先级从高到低顺序如下:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>^
not     - (unary)
*   /
+   -
..
&lt;   &gt;   &lt;=  &gt;=  ~=  ==
and
or
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h2>语句<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<div class="section" id="id14">
<h3>赋值<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<p>lua可以一次性给多个变量同时赋值, 变量列表和值列表的各元素用逗号隔开:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>a, b = 10, 2*x
</pre></div>
</div>
<p>lua会先计算赋值语句右边所有的值, 然后再进行赋值操作, 所以在lua里可以通过下面这样来交换两个变量的值:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>x, y = y, x
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>局部变量<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>可以通过local声明一个局部变量, 它只在被声明的代码块中有效. 访问局部变量比全局变量更快, 并且可以避免命名冲突. 可以把局部变量放在 do..end 中, 就好像C中的{}中一样.</p>
</div>
<div class="section" id="id16">
<h3>条件语句<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p>lua条件语句主要有3种结构:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">if</span> <span class="n">cond</span> <span class="kr">then</span>            <span class="c1">-- C: if(cond) {</span>
    <span class="kr">then</span><span class="o">-</span><span class="n">part</span>           <span class="c1">--     }</span>
<span class="kr">end</span><span class="p">;</span>

<span class="kr">if</span> <span class="n">cond</span> <span class="kr">then</span>            <span class="c1">-- C: if(cond) {</span>
    <span class="kr">then</span><span class="o">-</span><span class="n">part</span>           <span class="c1">--    }</span>
<span class="kr">else</span>                    <span class="c1">--    else {</span>
    <span class="kr">else</span><span class="o">-</span><span class="n">part</span>           <span class="c1">--    }</span>
<span class="kr">end</span><span class="p">;</span>

<span class="kr">if</span> <span class="n">cond1</span> <span class="kr">then</span>           <span class="c1">-- C: if(cond1) {</span>
    <span class="kr">then</span><span class="o">-</span><span class="n">part</span>           <span class="c1">--    }</span>
<span class="kr">elseif</span> <span class="n">cond2</span> <span class="kr">then</span>       <span class="c1">--    else if(cond2) {</span>
    <span class="kr">elseif</span><span class="o">-</span><span class="n">part</span>         <span class="c1">--    }</span>
<span class="o">..</span>                      <span class="c1">--    ..</span>
<span class="kr">else</span>                    <span class="c1">--    else {</span>
    <span class="kr">else</span><span class="o">-</span><span class="n">part</span>           <span class="c1">--    }</span>
<span class="kr">end</span><span class="p">;</span>
</pre></div>
</div>
<p>注意if语句后面的then以及最后的end.</p>
</div>
<div class="section" id="id17">
<h3>循环语句<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<p>while:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">while</span> <span class="n">cond</span> <span class="kr">do</span>       <span class="c1">-- C: while(cond) {</span>
    <span class="n">statements</span><span class="p">;</span>     <span class="c1">--    }</span>
<span class="kr">end</span><span class="p">;</span>
</pre></div>
</div>
<p>repeat-until:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">repeat</span>              <span class="c1">-- C: do{</span>
    <span class="n">statements</span><span class="p">;</span>     <span class="c1">--    } while(cond)</span>
<span class="kr">until</span> <span class="n">cond</span><span class="p">;</span>
</pre></div>
</div>
<p>for:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">var</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="kr">end</span><span class="p">,</span><span class="n">step</span> <span class="kr">do</span>   <span class="c1">-- C: for(var=start;var&lt;=end;var+=step) {</span>
    <span class="n">loop</span><span class="o">-</span><span class="n">part</span>               <span class="c1">--    }</span>
<span class="kr">end</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<ol class="last arabic simple">
<li>for后面的表达式只会在循环开始前被计算1次</li>
<li>上面的C等价语句其实不完全一致, 因为step也可以是负数</li>
<li>step可以省略, 默认为1</li>
<li>end值也被循环一次, 所以逻辑不等于C的for(i=start; i!=end; i+=step)</li>
<li>循环过程中不要改变控制变量的值, 否则结果是不可预知的</li>
</ol>
</div>
<p>break语句可以用来退出循环，但必须是语句块的最后一句.</p>
</div>
</div>
<div class="section" id="id18">
<h2>函数<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        
      
      
        
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        © Copyright 2019, 赵子清

    </p>
  </div> 

</footer>

        </div>
      </div>