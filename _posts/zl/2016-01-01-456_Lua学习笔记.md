---
layout: post
title: Lua学习笔记 
tags: [lua文章]
categories: [topic]
---
<p>  学习资料地址：<a href="http://www.runoob.com/lua/lua-tutorial.html" target="_blank" rel="external noopener noreferrer">http://www.runoob.com/lua/lua-tutorial.html</a></p>
<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>  在Windows环境下，使用SciTE来运行Lua程序。</p>
<p>  项目GitHub地址：<a href="https://github.com/rjpcomputing/luaforwindows/releases" target="_blank" rel="external noopener noreferrer">https://github.com/rjpcomputing/luaforwindows/releases</a></p>
<p>  上面的官方下载无法保证下载速度，我使用的是菜鸟教程分流的下载地址：<a href="http://static.runoob.com/download/LuaForWindows_v5.1.4-46.exe" target="_blank" rel="external noopener noreferrer">http://static.runoob.com/download/LuaForWindows_v5.1.4-46.exe</a></p>
<h2 id="开始编程"><a href="#开始编程" class="headerlink" title="开始编程"></a>开始编程</h2><p>  和Python一样，Lua也有交互式的编程方式。在命令行中输入<code>lua</code>或者<code>lua -i</code>启用。</p>
<p>  同时也可以使用脚本式编程，就是将代码存放在一个lua文件中，命令行执行<code>lua xxx.lua</code>即可。</p>
<p>  需要注意的是，交互式编程状态下不能使用lua命令，会出现下面的错误，这一点我也是犯了好多次：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stdin:1: &#39;=&#39; expected near &#39;hello&#39;</div></pre></td></tr></tbody></table></figure>
<p>  教程中没有提到怎样退出lua环境 。<code>os.exit()</code>退出。</p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>  单行注释:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"></div></pre></td></tr></tbody></table></figure>
<p>  多行注释：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--[[</span></div><div class="line">XXX</div><div class="line">XXX</div><div class="line">]]</div></pre></td></tr></tbody></table></figure>
<h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="string">&#34;hello world!&#34;</span>)</div></pre></td></tr></tbody></table></figure>
<h1 id="数据类型与变量"><a href="#数据类型与变量" class="headerlink" title="数据类型与变量"></a>数据类型与变量</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>  Lua有三种变量类型：全局变量，局部变量和表中的域。默认情况下，变量都是全局变量，函数里面没有做特殊声明的变量也都是全局变量。全局变量不需要声明，直接赋值即创建了这个全局变量。如果访问了一个没有创建的变量，会返回一个nil。同样，如果想要删除一个变量，直接赋值nil即可。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="built_in">print</span>(b)</div><div class="line"><span class="keyword">nil</span></div><div class="line">&gt; b=<span class="number">10</span></div><div class="line">&gt; <span class="built_in">print</span>(b)</div><div class="line"><span class="number">10</span></div></pre></td></tr></tbody></table></figure>
<p>  如果想要一个局部变量，需要使用<code>local</code>显式声明：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> b = <span class="number">5</span></div></pre></td></tr></tbody></table></figure>
<h3 id="赋值语句"><a href="#赋值语句" class="headerlink" title="赋值语句"></a>赋值语句</h3><p>  赋值时改变一个变量的值和改变表域的最基本方法。同大多数编程语言类似，Lua使用从右到左的赋值方式。除此之外，还能够实现多个变量同时赋值：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a, b = <span class="number">10</span>, <span class="number">2</span>*x</div></pre></td></tr></tbody></table></figure>
<p>  上面的语句在功能上，等同于：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = <span class="number">10</span></div><div class="line">b = <span class="number">2</span>*x</div></pre></td></tr></tbody></table></figure>
<p>  在对多个变量进行赋值时，Lua采用的计算方式是<strong>先计算右侧的值，再进行赋值</strong>的操作。所以再Lua中，实现两个变量值的交换只需要一行代码：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x, y = y, x</div></pre></td></tr></tbody></table></figure>
<p>  除此之外，当变量的个数和数值的个数不一致时，Lua会遵循这个策略：</p>
<ol>
<li>当 变量个数 &gt; 值的个数 时，右侧没有指定值的变量赋值为nil</li>
<li>当 变量个数 &lt; 值的个数 时，右侧多余的值会被忽略掉。</li>
</ol>
<p>  所以比较容易出现的错误是，在对多个变量进行相同赋值时：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a, b, c = <span class="number">0</span></div><div class="line"><span class="built_in">print</span>(a,b,c)             <span class="comment">--&gt; 0   nil   nil</span></div><div class="line">a, b, c = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line"><span class="built_in">print</span>(a,b,c)             <span class="comment">--&gt; 0   0   0</span></div></pre></td></tr></tbody></table></figure>
<p>  多赋值语句，除了用在上面的值交换的过程中之外，还常用于记录函数的多个返回值。Lua中，函数可以有多个返回值。如果想要将函数<code>f()</code>的两个返回值存放到全局变量<code>a</code>和<code>b</code>中去，可以使用下面的语句：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a, b = f()</div></pre></td></tr></tbody></table></figure>
<p>  上面的语句，实现了将函数的第一个返回值给a，第二个给b。</p>
<p>  虽然Lua定义全局变量比较方便，但是应当尽可能地使用局部变量。因为局部变量的访问时间要比全局变量更快，同时也避免了变量命名的冲突。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>  以下是常见的集中变量类型。</p>
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">nil</td>
<td style="text-align:center">无效值，没有赋值的变量都会返回nil</td>
</tr>
<tr>
<td style="text-align:center">boolean</td>
<td style="text-align:center">布尔</td>
</tr>
<tr>
<td style="text-align:center">number</td>
<td style="text-align:center">双精度浮点型</td>
</tr>
<tr>
<td style="text-align:center">string</td>
<td style="text-align:center">字符串，用单引号或双引号括起来</td>
</tr>
<tr>
<td style="text-align:center">function</td>
<td style="text-align:center">由C或Lua编写的函数</td>
</tr>
<tr>
<td style="text-align:center">userdata</td>
<td style="text-align:center">*表示任意存储在变量中的C数据结构</td>
</tr>
<tr>
<td style="text-align:center">thread</td>
<td style="text-align:center">*表示执行的独立线路，用于执行协同程序</td>
</tr>
<tr>
<td style="text-align:center">table</td>
<td style="text-align:center">*Lua 中的表（table）其实是一个”关联数组”（associative arrays），数组的索引可以是数字或者是字符串。在 Lua 里，table 的创建是通过”构造表达式”来完成，最简单构造表达式是{}，用来创建一个空表。</td>
</tr>
</tbody>
</table>
<p>  可以使用type函数测试给定变量或常量的类型：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="string">&#34;Hello world&#34;</span>))      <span class="comment">--&gt; string</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">10.4</span>*<span class="number">3</span>))             <span class="comment">--&gt; number</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">print</span>))              <span class="comment">--&gt; function</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>))               <span class="comment">--&gt; function</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="keyword">true</span>))               <span class="comment">--&gt; boolean</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="keyword">nil</span>))                <span class="comment">--&gt; nil</span></div><div class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>(X)))            <span class="comment">--&gt; string</span></div></pre></td></tr></tbody></table></figure>
<h3 id="nil（空）"><a href="#nil（空）" class="headerlink" title="nil（空）"></a>nil（空）</h3><p>  nil类型表示没有任何有效值，只有一个值，nil。打印一个没有赋值的变量会输出nil。对于全局变量和table变量，nil可以起到删除的作用。全局变量或者 table表里的变量赋一个nil值，等同于将他们删除。</p>
<p>  nil在比较时，需要使用双引号括起来。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="built_in">type</span>(X)</div><div class="line"><span class="keyword">nil</span></div><div class="line">&gt; <span class="built_in">type</span>(X)==<span class="keyword">nil</span></div><div class="line"><span class="keyword">false</span></div><div class="line">&gt; <span class="built_in">type</span>(X)==<span class="string">&#34;nil&#34;</span></div><div class="line"><span class="keyword">true</span></div><div class="line">&gt;</div></pre></td></tr></tbody></table></figure>
<h3 id="boolean（布尔）"><a href="#boolean（布尔）" class="headerlink" title="boolean（布尔）"></a>boolean（布尔）</h3><p>  Lua的布尔值与其他语言有一个显著的区别，它将false和nil看作假，其他的值，<strong>包括0，都为真</strong>。长时间使用其他编程语言的人可能会很难反应过来。</p>
<p>  除此之外，在进行逻辑判断时也和其他语言有很多不同。进行或、与运算时，如0 or false的值就为0，10 and 20返回值就为20。</p>
<h3 id="number（数字）"><a href="#number（数字）" class="headerlink" title="number（数字）"></a>number（数字）</h3><p>  Lua默认只有一种number类型，即双精度浮点型。</p>
<h3 id="string（字符串）"><a href="#string（字符串）" class="headerlink" title="string（字符串）"></a>string（字符串）</h3><p>  字符串由一对单引号或者双引号括起来。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">string1 = <span class="string">&#34;this is string1&#34;</span></div></pre></td></tr></tbody></table></figure>
<p>  也可以使用两个方括号<code>[[]]</code>来表示一块字符串。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">html = <span class="string">[[</span></div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;a href=&#34;http://www.z16388.com/&#34;&gt;崎径 其镜&lt;/a&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div><div class="line">]]</div></pre></td></tr></tbody></table></figure>
<p>  运行时，Lua会自动在string和number之间进行格式转换。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="string">&#34;10&#34;</span>+ <span class="number">1</span>)     <span class="comment">--&gt; 11</span></div><div class="line"><span class="built_in">print</span>(<span class="string">&#34;10 + 1&#34;</span>)  <span class="comment">--&gt; 10 + 1</span></div><div class="line"><span class="built_in">print</span>(<span class="string">&#34;hello&#34;</span>+ <span class="number">1</span>)    <span class="comment">-- 报错 (无法转换 &#34;hello&#34;)</span></div><div class="line"><span class="built_in">print</span>(<span class="number">10</span> .. <span class="number">20</span>) <span class="comment">--&gt; 1020</span></div></pre></td></tr></tbody></table></figure>
<p>  在一个数字后写<code>..</code>时应该<strong>加空格，防止被错误解释</strong>。</p>
<p>  可以使用两点<code>..</code>来连接两个字符串：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="built_in">print</span>(<span class="string">&#34;a&#34;</span> .. <span class="string">&#39;b&#39;</span>)</div><div class="line">ab</div><div class="line">&gt; <span class="built_in">print</span>(<span class="number">157</span> .. <span class="number">428</span>)</div><div class="line"><span class="number">157428</span></div></pre></td></tr></tbody></table></figure>
<p>  可以使用<code>#</code>来计算字符串的长度：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; len = <span class="string">&#34;www.z16388.top&#34;</span></div><div class="line">&gt; <span class="built_in">print</span>(#len)</div><div class="line"><span class="number">14</span></div><div class="line">&gt; <span class="built_in">print</span>(#<span class="string">&#34;www.z16388.top&#34;</span>)</div><div class="line"><span class="number">14</span></div></pre></td></tr></tbody></table></figure>
<h3 id="table（表）"><a href="#table（表）" class="headerlink" title="table（表）"></a>table（表）</h3><p>  表是一个关联数组，可以创建空表，也可以在创建的时候初始化：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> tbl1 = {}</div><div class="line"><span class="keyword">local</span> tbl2 = {<span class="string">&#34;apple&#34;</span>, <span class="string">&#34;pear&#34;</span>, <span class="string">&#34;orange&#34;</span>, <span class="string">&#34;grape&#34;</span>}</div></pre></td></tr></tbody></table></figure>
<p>  数组的索引可以是数字或者字符串：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a[key] = <span class="number">22</span></div><div class="line">a[<span class="number">2</span>] = <span class="number">11</span></div></pre></td></tr></tbody></table></figure>
<p>  需要注意的是，与其他语言不同，<strong>Lua默认初始索引是从1开始的！！！！</strong></p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> tbl = {<span class="string">&#34;apple&#34;</span>, <span class="string">&#34;pear&#34;</span>, <span class="string">&#34;orange&#34;</span>, <span class="string">&#34;grape&#34;</span>}</div><div class="line"><span class="keyword">for</span> key, val <span class="keyword">in</span> <span class="built_in">pairs</span>(tbl) <span class="keyword">do</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">&#34;Key&#34;</span>, key)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<p>  程序的运行结果是：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Key    <span class="number">1</span></div><div class="line">Key    <span class="number">2</span></div><div class="line">Key    <span class="number">3</span></div><div class="line">Key    <span class="number">4</span></div></pre></td></tr></tbody></table></figure>
<p>  对table的索引除了使用国际惯例<code>[]</code>之外，还可以使用<code>.</code>进行操作。需要注意的是，<strong>使用点号来索引时，索引的关键字不能为数字</strong>。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; site = {}</div><div class="line">&gt; site[<span class="string">&#34;key&#34;</span>] = <span class="string">&#34;www.z16388.top&#34;</span></div><div class="line">&gt; <span class="built_in">print</span>(site[<span class="string">&#34;key&#34;</span>])</div><div class="line">www.z16388.top</div><div class="line">&gt; <span class="built_in">print</span>(site.key)</div><div class="line">www.z16388.top</div></pre></td></tr></tbody></table></figure>
<p>  最后，table不会固定长度,没有被赋值的部分，返回值都为nil。如果直接使用for循环进行遍历，循环会在遇到nil值时终止，可能无法实现对整个数组的遍历。（如果其中有空值的话）具体的解决方法在table部分给出。</p>
<h3 id="function（函数）"><a href="#function（函数）" class="headerlink" title="function（函数）"></a>function（函数）</h3><p>  在Lua中，函数被看作第一类值，函数可以存在变量里。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="params">(n)</span></span></div><div class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">then</span></div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> n * factorial1(n - <span class="number">1</span>)</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"><span class="built_in">print</span>(factorial1(<span class="number">5</span>))</div><div class="line">factorial2 = factorial1</div><div class="line"><span class="built_in">print</span>(factorial2(<span class="number">5</span>))</div></pre></td></tr></tbody></table></figure>
<p>  可以以匿名函数的方式，通过参数传递。函数之所以有名字，就是为了方便进行调用。而只使用一次的函数，则可以不起名字，也就是匿名函数。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFun</span><span class="params">(tab,fun)</span></span></div><div class="line">    <span class="keyword">for</span> k ,v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab) <span class="keyword">do</span></div><div class="line">        <span class="built_in">print</span>(fun(k,v));</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line">tab={key1=<span class="string">&#34;val1&#34;</span>,key2=<span class="string">&#34;val2&#34;</span>}</div><div class="line">testFun(tab,</div><div class="line"><span class="function"><span class="keyword">function</span><span class="params">(key,val)</span></span><span class="comment">--匿名函数</span></div><div class="line">    <span class="keyword">return</span> key..<span class="string">&#34;=&#34;</span>..val</div><div class="line"><span class="keyword">end</span></div><div class="line">);</div></pre></td></tr></tbody></table></figure>
<h1 id="循环与流程控制"><a href="#循环与流程控制" class="headerlink" title="循环与流程控制"></a>循环与流程控制</h1><h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><p>  条件为<code>true</code>时会重复执行循环体的语句。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span>(condition)</div><div class="line"><span class="keyword">do</span></div><div class="line">   statements</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>  for循环是可以制定循环体执行次数的循环语句。Lua中的for循环需要相当地注意，分为两大类：</p>
<h4 id="数值for循环"><a href="#数值for循环" class="headerlink" title="数值for循环"></a>数值for循环</h4><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> var=exp1,exp2,exp3 <span class="keyword">do</span>  </div><div class="line">    &lt;执行体&gt;  </div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<p>  <code>exp1</code>为初值，<code>exp2</code>为终值，<code>exp3</code>为步长。若<code>exp3</code>不指定，值默认为1。需要注意的是，表达式中<strong>三个参数的值都会在循环开始前一次性求值，以后不再进行求值</strong>。</p>
<p>  参数</p>
<h4 id="泛型for循环"><a href="#泛型for循环" class="headerlink" title="泛型for循环"></a>泛型for循环</h4><p>  泛型for循环，通过一个迭代器来遍历所有的值，与C++类似。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) </div><div class="line">    <span class="keyword">do</span> <span class="built_in">print</span>(v) </div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<p>  其中，<code>i</code>是索引，<code>v</code>是索引对应的元素的值，ipairs是Lua提供的一个迭代器函数，用来迭代数组。它的参数<code>a</code>就是数组名。下面是一个对数组进行泛型for循环输出的例子。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">days = {<span class="string">&#34;Suanday&#34;</span>,<span class="string">&#34;Monday&#34;</span>,<span class="string">&#34;Tuesday&#34;</span>,<span class="string">&#34;Wednesday&#34;</span>,<span class="string">&#34;Thursday&#34;</span>,<span class="string">&#34;Friday&#34;</span>,<span class="string">&#34;Saturday&#34;</span>}  </div><div class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(days) <span class="keyword">do</span>  </div><div class="line">    <span class="built_in">print</span>(v) </div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<h3 id="repeat-…-until循环"><a href="#repeat-…-until循环" class="headerlink" title="repeat … until循环"></a>repeat … until循环</h3><p>  即do … while，重复执行循环体到循环条件为真时。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">repeat</span></div><div class="line">   statements</div><div class="line"><span class="keyword">until</span>( condition )</div></pre></td></tr></tbody></table></figure>
<h3 id="break语句"><a href="#break语句" class="headerlink" title="break语句"></a>break语句</h3><p>  Lua支持break语句。</p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><p>  if语句的格式：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(布尔表达式)</div><div class="line"><span class="keyword">then</span></div><div class="line">   <span class="comment">--[ 在布尔表达式为 true 时执行的语句 --]</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<p>  if … else 语句格式：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(布尔表达式)</div><div class="line"><span class="keyword">then</span></div><div class="line">   <span class="comment">--[ 布尔表达式为 true 时执行该语句块 --]</span></div><div class="line"><span class="keyword">else</span></div><div class="line">   <span class="comment">--[ 布尔表达式为 false 时执行该语句块 --]</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<p>  需要注意的是，Lua中<strong>0也为真值</strong>，只有false和nil为假。</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>  Lua中，函数的标准格式如下：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">optional_function_scope <span class="function"><span class="keyword">function</span> <span class="title">function_name</span><span class="params">( argument1, argument2, argument3..., argumentn)</span></span></div><div class="line">    function_body</div><div class="line">    <span class="keyword">return</span> result_params_comma_separated</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></tbody></table></figure>
<blockquote>
<ol>
<li><code>optional_function_scope</code>这个参数是可选的，表示函数是全局的还是局部的。默认为全局函数，设置为局部函数需要加关键字local</li>
<li><code>function_name</code>函数名</li>
<li><code>argument</code>函数的参数，用逗号隔开，也可以不带参数</li>
<li><code>function_body</code>函数体</li>
<li><code>result_params_comma_separated</code>返回值，可以有多个。</li>
</ol>
</blockquote>
<p>  <strong>函数可以作为参数</strong>。</p>
<h2 id="多返回值"><a href="#多返回值" class="headerlink" title="多返回值"></a>多返回值</h2><p>  Lua中的函数可以有多个返回值。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> res1,res2;</div></pre></td></tr></tbody></table></figure>
<h2 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h2><p>  Lua中的函数可以接受可变数目的参数，用三点<code>…</code>来代表多个参数。计算平均值的程序，可以这样写：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">average</span><span class="params">(...)</span></span></div><div class="line">   result = <span class="number">0</span></div><div class="line">   <span class="keyword">local</span> arg={...}</div><div class="line">   <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(arg) <span class="keyword">do</span></div><div class="line">      result = result + v</div><div class="line">   <span class="keyword">end</span></div><div class="line">   <span class="built_in">print</span>(<span class="string">&#34;总共传入 &#34;</span> .. #arg .. <span class="string">&#34; 个数&#34;</span>)</div><div class="line">   <span class="keyword">return</span> result/#arg</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">&#34;平均值为&#34;</span>,average(<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</div></pre></td></tr></tbody></table></figure>
<p>  在新的版本里，<code>#</code>不能用于返回数组元素的个数了，而是需要使用：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">select</span>(<span class="string">&#34;#&#34;</span>,...)</div></pre></td></tr></tbody></table></figure>
<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><p>  常用的算术运算符与其他语言类似。需要注意的是，Lua里没有整数，所以如果想要取整操作，必须要进行取整操作：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x = <span class="built_in">math</span>.ceil(x)</div></pre></td></tr></tbody></table></figure>
<p>  需要注意的是，这里的取整仍然是向上取整。也就是说，无论小数部分有多小，取整的结果都是要比原数的整数部分大1。</p>
<p>  除此之外，常用的操作应该还有数据精度的控制：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span>.format(<span class="string">&#34;%.2f&#34;</span>,dt)</div></pre></td></tr></tbody></table></figure>
<h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">==</td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center">~=</td>
<td style="text-align:center">不等</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
</tr>
</tbody>
</table>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">and</td>
<td style="text-align:center">与</td>
</tr>
<tr>
<td style="text-align:center">or</td>
<td style="text-align:center">或</td>
</tr>
<tr>
<td style="text-align:center">not</td>
<td style="text-align:center">非</td>
</tr>
</tbody>
</table>
<h2 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h2><table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">..</td>
<td style="text-align:center">连结两个字符串</td>
</tr>
<tr>
<td style="text-align:center">#</td>
<td style="text-align:center">返回字符串或表的长度</td>
</tr>
</tbody>
</table>
<p>  <code>#</code>运算符，获取的表的长度实际上获取的是表最大的索引值。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">tab1 = {<span class="string">&#34;1&#34;</span>,<span class="string">&#34;2&#34;</span>}</div><div class="line"><span class="built_in">print</span>(<span class="string">&#34;tab1长度&#34;</span>..#tab1)</div><div class="line">tab2 = {key1=<span class="string">&#34;1&#34;</span>,<span class="string">&#34;2&#34;</span>}</div><div class="line"><span class="built_in">print</span>(<span class="string">&#34;tab2长度&#34;</span>..#tab2)</div><div class="line">tab3 = {}</div><div class="line">tab3[<span class="number"