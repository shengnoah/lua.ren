---
layout: post
title: Lua 学习 chapter5  
tags: [lua文章]
categories: [topic]
---
<h3 id="目录">目录</h3>
<ol>
  <li>表索引</li>
  <li>表构造器</li>
  <li>数组、列表和序列</li>
  <li>遍历表</li>
  <li>安全访问</li>
  <li>表标准库</li>
  <li>练习</li>
</ol>

<blockquote>
  <p>Work hard, come on baby.
This chapter expresses the table.</p>
</blockquote>

<h2 id="表索引">表索引</h2>
<p>a.x 表示的意思和a[“x”]一样，所以前者的可读性更高。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">--空白表，建立了一个表的索引</span>
<span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="c1">--&gt; 10</span>
<span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="c1">--&gt; nil</span>
<span class="n">a</span> <span class="o">=</span> <span class="kc">nil</span> <span class="c1">--&gt;取消对表的索引，然后lua的垃圾处理器就会对其进行回收</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="表构造器">表构造器</h2>
<p>表构造器是用来创建和初始化表的表达式，也是lua语言中独有的也是最有用、最灵活的机制之一。</p>

<p>在构造表的时候可以使用记录式和列表式，当然你也可以混用它们：</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">days</span><span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Mon&#34;</span><span class="p">,</span><span class="s2">&#34;Tues&#34;</span><span class="p">,</span><span class="s2">&#34;Wednes&#34;</span><span class="p">,</span><span class="s2">&#34;Thurs&#34;</span><span class="p">,</span><span class="s2">&#34;Fri&#34;</span><span class="p">,</span><span class="s2">&#34;Satur&#34;</span><span class="p">,</span><span class="s2">&#34;Sun&#34;</span><span class="p">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">}</span>
<span class="n">poly</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">color</span> <span class="o">=</span> <span class="s2">&#34;blue&#34;</span><span class="p">,</span>
	<span class="n">thickness</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span> <span class="c1">--polyline[1]</span>
	<span class="n">nppoints</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span><span class="mi">2</span><span class="p">},</span> <span class="c1">--polyline[2]</span>
	<span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mi">6</span><span class="p">},</span> <span class="c1">--polyline[3]</span>
	<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span><span class="mi">8</span><span class="p">},</span>
	<span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>可以看到在表中你可以使用键值对方式，当然也可以直接存入值(或者整数作为元素的索引)。直接存入值的地方就可以通过整数来索引像上面的表索引的那样。</p>

<p>使用ipairs循环打印的时候，使用整数索引的值能够被打印出来，正如顺序构造的那样。</p>

<p><img src="https://i.imgur.com/MMD6oy1.png" alt=""/></p>

<p>当分别使用ipairs和pairs进行循环遍历的时候，我们会发现其中的特点。这说明表的存储结构，它是由数组部分和hashtable部分组成的，在输出的时候数组的部分会被优先输出，之后是hashtable部分。</p>

<p>其中ipairs只会遍历数组部分，而pairs会遍历所有部分。</p>

<p><strong>ipairs遍历的时候只会从1开始，直到顺序断开，pairs的遍历是乱序的，不能保证的</strong></p>

<p>当然你也可以使用特定的数字来作为表的索引，需要使用中括号,如上例[4]就能被ipairs遍历到，但是[6]就不行，因为不连续。</p>

<h2 id="数组列表和序列">数组、列表和序列</h2>

<p>在table中，想表示常见的数组或者列表，那么只需要使用整形作为索引的表即可。</p>

<p>当然当列表中不存在nil的时候这样的数组可以被称之为序列。</p>

<p>更准确的说序列是由指定的n个正整数为键值组成的[1…n]的集合。在中间既不能存在空洞(值为nil或者干脆没有键值直接越到后面的整数去)，这样通过<strong>#访问数组的长度只会返回空洞之前的有效长度。</strong></p>

<h2 id="遍历表">遍历表</h2>
<ol>
  <li>ipairs 针对于序列，顺序输出</li>
  <li>pairs  针对于所有表，输出所有元素，但是不保证顺序(因为存储方式为hashtable)</li>
  <li>for i = 1, #t do print(t[i]) end  使用for循环</li>
</ol>

<h2 id="安全访问">安全访问</h2>

<p>可以通过<strong>or</strong>来实现安全访问：</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">E</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">zip</span> <span class="o">=</span> <span class="p">(((</span><span class="n">company</span> <span class="ow">or</span> <span class="n">E</span><span class="p">).</span><span class="n">director</span> <span class="ow">or</span> <span class="n">E</span><span class="p">).</span><span class="n">address</span> <span class="ow">or</span> <span class="p">{}).</span><span class="n">zipcode</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这样不会报错，最后返回的值也是nil，而且还减少了对表的访问。</p>

<h2 id="表标准库">表标准库</h2>

<ol>
  <li>table.insert(t,pos,val)  –&gt;向指定的位置插入一个值，当然也可以不指定位置，就会直接在最后插入</li>
  <li>table.remove(t,pos) –&gt; 移除指定位置的元素，如不指定，移除最后一位，移除之后后面的元素会自动前移</li>
  <li>table.move(a,f,e,t) –&gt; 将表a中，从f到e的元素移到从t开始的位置</li>
  <li>table.move(a,f,e,t,{}) –&gt; 将a表中从f到e的元素移动到新表{},从t开始的位置</li>
  <li>table.concat(“hello”,” world”) –&gt; hello world 连接字符串</li>
</ol>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="n">t2</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">}</span>
<span class="kd">local</span> <span class="n">t3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">t3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">table</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">table</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">t3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://i.imgur.com/q882Pfl.png" alt=""/></p>

<h2 id="练习">练习</h2>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">a</span><span class="o">=</span><span class="p">{}</span>
<span class="n">a</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">)</span>
<span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在赋值3之前无论打印那个a他们都指向的是那张空表，当赋值之后a.a 指向3，所以a.a.a即3.a会报错</p>



                <hr style="visibility: hidden;"/>
                
                <hr style="visibility: hidden;"/>