---
layout: post
title: Lua特别之处笔记 
tags: [lua文章]
categories: [topic]
---
<div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/02/02/singleton_pattern/" rel="next" title="单例模式的析构问题和线程安全问题">
                <i class="fa fa-chevron-left"></i> 
                <p class="post-nav-pre-next-title">
                  单例模式的析构问题和线程安全问题
                </p> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/02/09/条件编译指令之if和ifdef和ifdefined之间的区别/" rel="prev" title="条件编译指令之#if和#ifdef和#if defined之间的区别">
              <p class="post-nav-pre-next-title">
                  条件编译指令之#if和#ifdef和#if defined之间的区别
              </p> 
              <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      

      
      

      
        <p>两个取值 false 和 true。但要注意 Lua 中所有的值都可以作为条件。在控制结构的条<br/>件中除了 false 和 nil 为假，其他值都为真。所以 Lua 认为 0 和空串都是真。</p>
<h1 id="2-5-table"><a href="#2-5-table" class="headerlink" title="2.5 table"></a>2.5 table</h1><p>我们用一个疑问来引入table的介绍</p>
<h2 id="传的是值还是引用"><a href="#传的是值还是引用" class="headerlink" title="传的是值还是引用?"></a>传的是值还是引用?</h2><p>lua的函数调用传的是值还是引用?</p>
<p><strong>. . .</strong></p>
<h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/></pre></td><td class="code"><pre><span class="line">tTableForTest = {}</span><br/><span class="line"></span><br/><span class="line">tTableForTest[<span class="number">1</span>] = <span class="number">9</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(tTable)</span></span></span><br/><span class="line">    tTable[<span class="number">1</span>] = <span class="number">11</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;tTableForTest[1]&#34;</span>..<span class="string">&#34; : &#34;</span>..tTableForTest[<span class="number">1</span>])</span><br/><span class="line">testTable(tTableForTest)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;tTableForTest[1]&#34;</span>..<span class="string">&#34; : &#34;</span>..tTableForTest[<span class="number">1</span>])</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;n==================n&#34;</span>)</span><br/><span class="line"></span><br/><span class="line">nNumberForTest = <span class="number">1</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestNumber</span><span class="params">( nNumber )</span></span></span><br/><span class="line">    nNumber = <span class="number">99</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;nNumberForTest&#34;</span>..<span class="string">&#34; : &#34;</span>..nNumberForTest)</span><br/><span class="line">TestNumber(nNumberForTest)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;nNumberForTest&#34;</span>..<span class="string">&#34; : &#34;</span>..nNumberForTest)</span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;n==================n&#34;</span>)</span><br/><span class="line"></span><br/><span class="line">nStringForTest = <span class="string">&#34;hi&#34;</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestNumber</span><span class="params">( nString )</span></span></span><br/><span class="line">    nString = <span class="string">&#34;hello&#34;</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;nStringForTest&#34;</span>..<span class="string">&#34; : &#34;</span>..nStringForTest)</span><br/><span class="line">TestNumber(nStringForTest)</span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;nStringForTest&#34;</span>..<span class="string">&#34; : &#34;</span>..nStringForTest)</span><br/></pre></td></tr></tbody></table></figure>
<h3 id="打印结果"><a href="#打印结果" class="headerlink" title="打印结果"></a>打印结果</h3><pre><code>tTableForTest[1] : 9
tTableForTest[1] : 11

==================

nNumberForTest : 1
nNumberForTest : 1

==================

nStringForTest : hi
nStringForTest : hi
</code></pre><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><ul>
<li>table传引用</li>
<li>number传值</li>
<li>string传值</li>
</ul>
<h2 id="为什么lua中table会不一样"><a href="#为什么lua中table会不一样" class="headerlink" title="为什么lua中table会不一样"></a>为什么lua中table会不一样</h2><p>在Lua中, table 既不是值也不是变量而是对象.</p>
<p>程序仅持有一个对他们的引用, Lua不会暗中产生table的副本或创建新的table.</p>
<p>事实上, table的创建是通过构造表达式完成的, 最简单的构造表达式就是{}</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line">a = {}</span><br/><span class="line">k = <span class="string">&#34;x&#34;</span></span><br/><span class="line">a[k] = <span class="number">10</span></span><br/><span class="line">a[<span class="number">20</span>] = <span class="string">&#34;great&#34;</span></span><br/><span class="line"><span class="built_in">print</span>(a[<span class="string">&#34;x&#34;</span>])   </span><br/><span class="line"></span><br/><span class="line">k = <span class="number">20</span></span><br/><span class="line"><span class="built_in">print</span>(a[k])     <span class="comment">--&gt; &#34;great&#34;</span></span><br/><span class="line">a[<span class="string">&#34;x&#34;</span>] = a[<span class="string">&#34;x&#34;</span>] + <span class="number">1</span></span><br/><span class="line"><span class="built_in">print</span>(a[<span class="string">&#34;x&#34;</span>])   <span class="comment">--&gt; 11</span></span><br/><span class="line"></span><br/><span class="line">b = a           <span class="comment">-- b与a引用了同一个table</span></span><br/><span class="line"><span class="built_in">print</span>(b[<span class="string">&#34;x&#34;</span>])   </span><br/><span class="line">b[<span class="string">&#34;x&#34;</span>] = <span class="number">20</span></span><br/><span class="line"><span class="built_in">print</span>(a[<span class="string">&#34;x&#34;</span>])   <span class="comment">--&gt; 20</span></span><br/><span class="line"></span><br/><span class="line">a = <span class="literal">nil</span>         <span class="comment">-- 现在只有b还在引用table</span></span><br/><span class="line">b = <span class="literal">nil</span>         <span class="comment">-- 再也没有对table的引用了</span></span><br/></pre></td></tr></tbody></table></figure>
<p>当一个程序再也没有对一个table的引用时, Lua的垃圾收集器最终会删除该table, 并<br/>复用它的内存.</p>
<h2 id="a-x-和a-x是不同的"><a href="#a-x-和a-x是不同的" class="headerlink" title="a[x]和a.x是不同的"></a>a[x]和a.x是不同的</h2><p><code>a.x</code>表示<code>a[&#34;x&#34;]</code> , 表示以字符串<code>&#34;x&#34;</code>来索引table</p>
<p><code>a[x]</code> 是以变量x的值来索引table</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">a = {}</span><br/><span class="line">x = <span class="string">&#34;y&#34;</span></span><br/><span class="line">a[x] = <span class="number">10</span></span><br/><span class="line"><span class="built_in">print</span>(a[x])     <span class="comment">--&gt; 表示a[&#34;y&#34;], 即 10</span></span><br/><span class="line"><span class="built_in">print</span>(a.x)      <span class="comment">--&gt; 表示a[&#34;x&#34;], 没有定义这个, 所以是 nil</span></span><br/><span class="line"><span class="built_in">print</span>(a.y)      <span class="comment">--&gt; 表示a[&#34;y&#34;], 即 10</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="用table作为数组时"><a href="#用table作为数组时" class="headerlink" title="用table作为数组时"></a>用table作为数组时</h2><p>就Lua的习惯而言, 数组通常以1作为索引的起始值, 并且还有不少lua机制依赖于这个惯例, 大多数lua内置的函数都假设数组起始于索引1, 这跟c语言以0为起始是不同的.</p>
<p>Lua5.1以上, 可以使用 <code>#</code> 来返回一个数组或者线性表的最后一个索引值或者其大小.</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 打印所有的行</span></span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>, #a <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(a[i])</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>