---
layout: post
title: Lua 正则表达式 
tags: [lua文章]
categories: [topic]
---
<div itemprop="articleBody">
                        



<h3 id="heading-lua字符串匹配">Lua字符串匹配</h3>

<p><em>与正则相关的函数</em></p>

<blockquote>
  <p>str = &#34;{1:[1,2,3],2:{idx2:2,level:60,reward_idx:2001,ring:100},test:{1:100,2:200}}&#34;</p>
</blockquote>

<p><strong>string.find(s, pattern[, init[, plaub]])</strong></p>

<p>在字符串 s 中匹配 pattern，如果匹配成功，则返回第一个匹配到的子串的起始索引和结束索引，如果 pattern 中有分组，那么分组匹配的内容也会接在两个索引值后面返回；如果匹配失败则返回 nil。
第三个可选参数 init 指明从哪里开始搜索，默认值为1，可以是负值。
第四个可选参数 plain 为true 时，关闭模式匹配机制，pattern 作为普通字符串进行匹配。</p>

<blockquote>
  <p>string.find(str, &#39;1,2,3&#39;)<br/>
5 9<br/>
string.find(str, &#39;%a+&#39;)<br/>
15 17<br/>
string.find(str, &#39;(%d+),(%d+),(%d+)&#39;)<br/>
5 9 &#34;1&#34; &#34;2&#34; &#34;3&#34;<br/>
string.find(str, &#39;%d&#39;, 1, true)<br/>
nil</p>
</blockquote>

<p><strong>string.match(s, pattern[, init])</strong></p>

<p>在字符串 s 中匹配 pattern，如果匹配成功，若 pattern 没有分组，则返回第一个匹配到的子串，若有分组，则依次返回各个匹配的分组；匹配失败则返回 nil。
第三个可选参数 init 指明从哪里开始搜索，默认值为1，可以是负值。</p>

<blockquote>
  <p>string.match(str, &#39;%d+,%d+,%d+&#39;)<br/>
&#34;1,2,3&#34;<br/>
string.match(str, &#39;(%d+)(:)([[]%d+)&#39;)<br/>
&#34;1&#34; &#34;:&#34; &#34;[1&#34;<br/>
string.match(str, &#39;((%d+)(:)([[]%d+))&#39;)<br/>
&#34;1:[1&#34; &#34;1&#34; &#34;:&#34; &#34;[1&#34;</p>
</blockquote>

<p><strong>string.gmatch(s, pattern)</strong></p>

<p>返回一个迭代器函数，每次调用迭代器，会返回下一个匹配到的子串，如果 pattern 中有分组，则返回的是子串对应的分组。
对这个函数来说，匹配模板前开始的 &#39;^&#39; 不会当成锚点，这样会阻止迭代。</p>

<blockquote>
  <p>for s, a in string.gmatch(&#39;Hanazawa Kana&#39;, &#39;(a(%a)a)&#39;) do print(s, a) end<br/>
&#34;ana&#34; &#34;n&#34;<br/>
&#34;awa&#34; &#34;w&#34;<br/>
&#34;ana&#34; &#34;n&#34;<br/>
注意：&#39;ana&#39; 匹配成功后，接下来的匹配从 &#39;z&#39; 开始，导致 &#39;z&#39; 没有被正确匹配到。</p>
</blockquote>

<p><strong>string.gsub(s, pattern, repl[, n])</strong></p>

<p>将字符串 s 中所有（或者可选参数前 n 个）pattern 替换成 repl，返回替换后的字符串和替换的次数。
如果 repl 是一个字符串，则把这个字符串作为替换品。字符 % 是一个转义符：repl 中所有形式为 %d 的串表示第 d 个捕获到的子串，d 可以是1到9，%0 表示整个匹配，%% 表示单个 %。
如果 repl 是表，每次匹配时会用第一个捕获作为建去查找表。
如果 repl 是函数，则每次匹配时会调用函数，所有捕获到的子串依次作为参数传入。</p>

<p>将 json 字符串转成 lua 字符串</p>
<blockquote>
  <p>str = string.gusb(str, &#34;[[]&#34;, &#34;{&#34;)<br/>
str = string.gsub(str, &#34;]&#34;, &#34;}&#34;)<br/>
str = string.gusb(str, &#34;([{,])(%d+):&#34;, &#34;%1[%2]=&#34;)<br/>
str = string.gsub(str, &#34;([{,])([%w_]+):&#34;, &#34;%1%2=&#34;)<br/>
print(str)<br/>
&#34;{[1]={1,2,3},[2]={idx2=2,level=60,reward_idx=2001,ring=100},test={[1]=100,[2]=200}&#34;<br/>
load(&#34;return &#34; .. str)()</p>
</blockquote>

<h3 id="heading-正则表达式">正则表达式</h3>

<table>
  <thead>
    <tr>
      <th>字符</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>普通字符</td>
      <td style="text-align: left">除去%.<a href=""></a>^$*+-?的字符，匹配字符本身</td>
    </tr>
    <tr>
      <td>.</td>
      <td style="text-align: left">匹配任意字符</td>
    </tr>
    <tr>
      <td>%</td>
      <td style="text-align: left">转义字符，当后面的字符是特殊字符时，还原特殊字符的愿意。% 和一些特定字母组合构成 lua 的预定义字符集。% 和数字 1~9 组合表示之前捕获的分组</td>
    </tr>
    <tr>
      <td>[…]</td>
      <td style="text-align: left">字符集，匹配一个包含于集合内的串，[…] 中的特殊字符表示原意</td>
    </tr>
    <tr>
      <td>[…-…]</td>
      <td style="text-align: left">- 表示 ASCII 码在它前一个字符到它后一个字符之间的所有字符</td>
    </tr>
    <tr>
      <td>[^…]</td>
      <td style="text-align: left">不在 … 中的字符集合</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>预定义字符集</th>
      <th style="text-align: left"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>%s</td>
      <td style="text-align: left">空白符[rntvf]</td>
    </tr>
    <tr>
      <td>%p</td>
      <td style="text-align: left">标点符号</td>
    </tr>
    <tr>
      <td>%c</td>
      <td style="text-align: left">控制符号</td>
    </tr>
    <tr>
      <td>%w</td>
      <td style="text-align: left">字母数字 [a-zA-Z0-9]</td>
    </tr>
    <tr>
      <td>%a</td>
      <td style="text-align: left">字母 [a-zA-Z]</td>
    </tr>
    <tr>
      <td>%l</td>
      <td style="text-align: left">小写字母 [a-z]</td>
    </tr>
    <tr>
      <td>%u</td>
      <td style="text-align: left">大写字母 [A-Z]</td>
    </tr>
    <tr>
      <td>%d</td>
      <td style="text-align: left">数字 [0-9]</td>
    </tr>
    <tr>
      <td>%x</td>
      <td style="text-align: left">16进制数 [0-9a-fA-F]</td>
    </tr>
    <tr>
      <td>%z</td>
      <td style="text-align: left">ASCII 码是 0 的字符</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>重复(数量词)</th>
      <th style="text-align: left"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>*</td>
      <td style="text-align: left">表示前一个字符出现 0 到多次</td>
    </tr>
    <tr>
      <td>+</td>
      <td style="text-align: left">表示前一个字符出现 1 到多次</td>
    </tr>
    <tr>
      <td>?</td>
      <td style="text-align: left">表示前一个字符出现 0 或 1 次</td>
    </tr>
    <tr>
      <td>-</td>
      <td style="text-align: left">表示前一个字符出现 0 到多次，与 * 不同的是会匹配尽可能短的串</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>分组/捕获</th>
      <th style="text-align: left"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(…)</td>
      <td style="text-align: left">表达式中用 () 包围的字符串作为一个分组，分组从左到右，组序号从 1 开始递增，空的捕获 () 将捕获到当前字符串的位置（是一个数字）。</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>边界匹配（属于零宽断言）</th>
      <th style="text-align: left"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>^</td>
      <td style="text-align: left">在模式最前面加 ^ 匹配字符串开头，出现在其它位置没有特殊含义</td>
    </tr>
    <tr>
      <td>$</td>
      <td style="text-align: left">在模式最后面加 $ 匹配字符串结尾，出现在其它位置没有特殊含义</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>%b</th>
      <th style="text-align: left"> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>%bxy</td>
      <td style="text-align: left">匹配 xy 对，x，y 是两个表示原本意义的字符，匹配到的串以 x 开始 y 结束，且其中 x 和 y 保持平衡。即这个字符从左到右开始计数，遇 x 就 +1，遇 y 就 -1，到最终结束的 y 处是第一个计数到 0 的 y。%b() 可以匹配到括号平衡的表达式。</td>
    </tr>
    <tr>
      <td>%f[…]</td>
      <td style="text-align: left">边界模式。会匹配到一个处于 … 内某个字符之前的一个空串，且这个位置的前一个字符不属于 …。</td>
    </tr>
  </tbody>
</table>

<h1 id="heading-参考链接">参考链接</h1>

<ul>
  <li><a href="https://www.runoob.com/manual/lua53doc/manual.html">Lua 5.3 参考手册</a></li>
</ul>

                    </div>