---
layout: post
title: 2.3 lua 表达式 
tags: [lua文章]
categories: [topic]
---
<h2 id="算术表达式"><a href="#算术表达式" class="headerlink" title="算术表达式"></a>算术表达式</h2><p>Lua 的算术运算符如下表所示：</p>
<table>
<thead>
<tr>
<th>表达符</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>加法</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
</tr>
<tr>
<td>/</td>
<td>除法</td>
</tr>
<tr>
<td>^</td>
<td>指数</td>
</tr>
<tr>
<td>%</td>
<td>取模</td>
</tr>
</tbody>
</table>
<p>实例<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span> + <span class="number">2</span>) </span><br/><span class="line"><span class="built_in">print</span>(<span class="number">5</span> / <span class="number">10</span>) <span class="comment">--&gt;打印 0.5。 这是Lua不同于c语言的</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">5.0</span> / <span class="number">10</span>) <span class="comment">--&gt;打印 0.5。 浮点数相除的结果是浮点数</span></span><br/><span class="line"><span class="comment">-- print(10 / 0) --&gt;注意除数不能为0，计算的结果会出错</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">2</span> ^ <span class="number">10</span>) <span class="comment">--&gt;打印 1024。 求2的10次方</span></span><br/><span class="line"><span class="keyword">local</span> num = <span class="number">1357</span></span><br/><span class="line"><span class="built_in">print</span>(num % <span class="number">2</span>) <span class="comment">--&gt;打印 1</span></span><br/><span class="line"><span class="built_in">print</span>((num % <span class="number">2</span>) == <span class="number">1</span>) <span class="comment">--&gt;打印 true。 判断num是否为奇数</span></span><br/><span class="line"><span class="built_in">print</span>((num % <span class="number">5</span>) == <span class="number">0</span>) <span class="comment">--&gt;打印 false。判断num是否能被5整数</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<h2 id="关系表达式"><a href="#关系表达式" class="headerlink" title="关系表达式"></a>关系表达式</h2><table>
<thead>
<tr>
<th>表达符</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于等于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于等于</td>
</tr>
<tr>
<td>==</td>
<td>等于</td>
</tr>
<tr>
<td>~=</td>
<td>不等于</td>
</tr>
</tbody>
</table>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span> &lt; <span class="number">2</span>) <span class="comment">--&gt;打印 true</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">1</span> == <span class="number">2</span>) <span class="comment">--&gt;打印 false</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">1</span> ~= <span class="number">2</span>) <span class="comment">--&gt;打印 true</span></span><br/><span class="line"><span class="keyword">local</span> a, b = <span class="literal">true</span>, <span class="literal">false</span></span><br/><span class="line"><span class="built_in">print</span>(a == b) <span class="comment">--&gt;打印 false</span></span><br/></pre></td></tr></tbody></table></figure>
<p><strong>特别注意：</strong></p>
<ol>
<li>不同于C/C++等语言，lua中的“不等于”是<code>~=</code>而非<code>!=</code>.</li>
<li>由于 Lua 字符串总是会被“内化”，即相同内容的字符串只会被保存一份，因此 Lua 字符串之间的相等性比较可以简化为其内部存储地址的比较。这意味着 Lua 字符串的相等性比较总是为 O(1). 而在其他编程语言中，字符串的相等性比较则通常为 O(n)，即需要逐个字节（ 或按若干个连续字节） 进行比较。</li>
<li>在使用“==”做等于判断时，要注意对于 table, userdata 和函数， Lua 是作引用比较的。也就是说，只有当两个变量引用同一个对象时，才认为它们相等。如实例：<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a = { x = <span class="number">1</span>, y = <span class="number">0</span>}</span><br/><span class="line"><span class="keyword">local</span> b = { x = <span class="number">1</span>, y = <span class="number">0</span>}</span><br/><span class="line"><span class="keyword">if</span> a == b <span class="keyword">then</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;a==b&#34;</span>)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;a~=b&#34;</span>)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">---output:</span></span><br/><span class="line">a~=b</span><br/></pre></td></tr></tbody></table></figure>
</li>
</ol>
<h2 id="逻辑表达式"><a href="#逻辑表达式" class="headerlink" title="逻辑表达式"></a>逻辑表达式</h2><table>
<thead>
<tr>
<th>表达符</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>and</td>
<td>逻辑与</td>
</tr>
<tr>
<td>or</td>
<td>逻辑或</td>
</tr>
<tr>
<td>not</td>
<td>逻辑非</td>
</tr>
</tbody>
</table>
<p>Lua 中的 <code>and</code> 和 <code>or</code> 是不同于C/C++语言的。在C/C++语言中，<code>and</code> 和 <code>or</code> 只得到两个值 1 和 0，其中 1表示真，0 表示假。而 Lua 中 <code>and</code>和<code>or</code> 的执行结果返回的表达式的结果，而非<code>true</code>或者<code>flase</code>这类逻辑结果。也就是说：</p>
<ol>
<li><code>a and b</code> 如果 a 为 <code>nil</code>，则返回 a，否则返回 b;</li>
<li><code>a or b</code> 如果 a 为 <code>nil</code>，则返回 b，否则返回 a。<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/></pre></td><td class="code"><pre><span class="line">local c = nil</span><br/><span class="line">local d = 0</span><br/><span class="line">local e = 100</span><br/><span class="line">print(c and d)</span><br/><span class="line">nil</span><br/><span class="line">print(c and e)</span><br/><span class="line">nil</span><br/><span class="line"><span class="meta">&gt;</span>print(d and e)</span><br/><span class="line">100</span><br/><span class="line"><span class="meta">&gt;</span>print(c or d)</span><br/><span class="line">0</span><br/><span class="line"><span class="meta">&gt;</span>print(c or e)</span><br/><span class="line">100</span><br/><span class="line"><span class="meta">&gt;</span>print(not c)</span><br/><span class="line">true</span><br/><span class="line"><span class="meta">&gt;</span>print(not d)</span><br/><span class="line">false</span><br/></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p><strong>特别注意：</strong></p>
<ol>
<li>所有逻辑操作符将 false 和 nil 视作假，其他任何值视作真；</li>
<li>对于 and 和 or，“短路求值”；</li>
<li>对于 not，永远只返回 true 或者 false。</li>
</ol>
<h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><table>
<thead>
<tr>
<th>优先级(由高到低)</th>
</tr>
</thead>
<tbody>
<tr>
<td>^</td>
</tr>
<tr>
<td>not   # -</td>
</tr>
<tr>
<td>*   /   %</td>
</tr>
<tr>
<td>+   -</td>
</tr>
<tr>
<td>..</td>
</tr>
<tr>
<td>&lt; &gt; &lt;=  &gt;=  ==  ~=</td>
</tr>
<tr>
<td>and</td>
</tr>
<tr>
<td>or</td>
</tr>
</tbody>
</table>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a, b = <span class="number">1</span>, <span class="number">2</span></span><br/><span class="line"><span class="keyword">local</span> x, y = <span class="number">3</span>, <span class="number">4</span></span><br/><span class="line"><span class="keyword">local</span> i = <span class="number">10</span></span><br/><span class="line"><span class="keyword">local</span> res = <span class="number">0</span></span><br/><span class="line">res = a + i &lt; b/<span class="number">2</span> + <span class="number">1</span> <span class="comment">--&gt;等价于res = (a + i) &lt; ((b/2) + 1)</span></span><br/><span class="line">res = <span class="number">5</span> + x^<span class="number">2</span>*<span class="number">8</span> <span class="comment">--&gt;等价于res = 5 + ((x^2) * 8)</span></span><br/><span class="line">res = a &lt; y <span class="keyword">and</span> y &lt;=x <span class="comment">--&gt;等价于res = (a &lt; y) and (y &lt;= x)</span></span><br/></pre></td></tr></tbody></table></figure>
<p><strong>tips</strong></p>
<ol>
<li>若不确定某些操作符的优先级，就应显示地用括号来指定运算顺序。这样做还可以提高代码的可读性。</li>
</ol>