---
layout: post
title: 2.3 lua 表达式 
tags: [lua文章]
categories: [topic]
---
## 算术表达式

Lua 的算术运算符如下表所示：

表达符 | 备注  
---|---  
+ | 加法  
- | 减法  
* | 乘法  
/ | 除法  
^ | 指数  
% | 取模  
  
实例  

    
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    

|

    
    
    print(1 + 2)   
    print(5 / 10) -->打印 0.5。 这是Lua不同于c语言的  
    print(5.0 / 10) -->打印 0.5。 浮点数相除的结果是浮点数  
    -- print(10 / 0) -->注意除数不能为0，计算的结果会出错  
    print(2 ^ 10) -->打印 1024。 求2的10次方  
    local num = 1357  
    print(num % 2) -->打印 1  
    print((num % 2) == 1) -->打印 true。 判断num是否为奇数  
    print((num % 5) == 0) -->打印 false。判断num是否能被5整数  
      
  
---|---  
  
## 关系表达式

表达符 | 备注  
---|---  
< | 小于  
> | 大于  
<= | 小于等于  
>= | 大于等于  
== | 等于  
~= | 不等于  
      
    
    1  
    2  
    3  
    4  
    5  
    

|

    
    
    print(1 < 2) -->打印 true  
    print(1 == 2) -->打印 false  
    print(1 ~= 2) -->打印 true  
    local a, b = true, false  
    print(a == b) -->打印 false  
      
  
---|---  
  
**特别注意：**

  1. 不同于C/C++等语言，lua中的“不等于”是`~=`而非`!=`.
  2. 由于 Lua 字符串总是会被“内化”，即相同内容的字符串只会被保存一份，因此 Lua 字符串之间的相等性比较可以简化为其内部存储地址的比较。这意味着 Lua 字符串的相等性比较总是为 O(1). 而在其他编程语言中，字符串的相等性比较则通常为 O(n)，即需要逐个字节（ 或按若干个连续字节） 进行比较。
  3. 在使用“==”做等于判断时，要注意对于 table, userdata 和函数， Lua 是作引用比较的。也就是说，只有当两个变量引用同一个对象时，才认为它们相等。如实例：
    
        1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    

|

    
        local a = { x = 1, y = 0}  
    local b = { x = 1, y = 0}  
    if a == b then  
    print("a==b")  
    else  
    print("a~=b")  
    end  
    ---output:  
    a~=b  
      
  
---|---  

## 逻辑表达式

表达符 | 备注  
---|---  
and | 逻辑与  
or | 逻辑或  
not | 逻辑非  
  
Lua 中的 `and` 和 `or` 是不同于C/C++语言的。在C/C++语言中，`and` 和 `or` 只得到两个值 1 和 0，其中 1表示真，0
表示假。而 Lua 中 `and`和`or` 的执行结果返回的表达式的结果，而非`true`或者`flase`这类逻辑结果。也就是说：

  1. `a and b` 如果 a 为 `nil`，则返回 a，否则返回 b;
  2. `a or b` 如果 a 为 `nil`，则返回 b，否则返回 a。
    
        1  
    2  
    3  
    4  
    5  
    6  
    7  
    8  
    9  
    10  
    11  
    12  
    13  
    14  
    15  
    16  
    17  
    

|

    
        local c = nil  
    local d = 0  
    local e = 100  
    print(c and d)  
    nil  
    print(c and e)  
    nil  
    >print(d and e)  
    100  
    >print(c or d)  
    0  
    >print(c or e)  
    100  
    >print(not c)  
    true  
    >print(not d)  
    false  
      
  
---|---  

**特别注意：**

  1. 所有逻辑操作符将 false 和 nil 视作假，其他任何值视作真；
  2. 对于 and 和 or，“短路求值”；
  3. 对于 not，永远只返回 true 或者 false。

## 优先级

优先级(由高到低)  
---  
^  
not # -  
* / %  
\+ -  
..  
< > <= >= == ~=  
and  
or  
      
    
    1  
    2  
    3  
    4  
    5  
    6  
    7  
    

|

    
    
    local a, b = 1, 2  
    local x, y = 3, 4  
    local i = 10  
    local res = 0  
    res = a + i < b/2 + 1 -->等价于res = (a + i) < ((b/2) + 1)  
    res = 5 + x^2*8 -->等价于res = 5 + ((x^2) * 8)  
    res = a < y and y <=x -->等价于res = (a < y) and (y <= x)  
      
  
---|---  
  
**tips**

  1. 若不确定某些操作符的优先级，就应显示地用括号来指定运算顺序。这样做还可以提高代码的可读性。