---
layout: post
title: Lua表达式 · 花生肉泥 
tags: [lua文章]
categories: [topic]
---
<h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>下表列出了lua语言中常用算术运算符(设定A的值为10，B的值为20)</p>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center">加法</td>
<td style="text-align:center">A + B 输出 30</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">减法</td>
<td style="text-align:center">A - B 输出 -10</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">乘法</td>
<td style="text-align:center">A * B 输出 200</td>
</tr>
<tr>
<td style="text-align:center">/</td>
<td style="text-align:center">除法</td>
<td style="text-align:center">B / A 输出 2</td>
</tr>
<tr>
<td style="text-align:center">%</td>
<td style="text-align:center">取余</td>
<td style="text-align:center">B % A 输出 0</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">乘幂</td>
<td style="text-align:center">A ^ 2 输出 100</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">负号</td>
<td style="text-align:center">-A 输出 -10</td>
</tr>
</tbody>
</table>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p>lua中的关系运算符有：<br/></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">&lt;     </span><br/><span class="line">&gt;</span><br/><span class="line">&lt;=     </span><br/><span class="line">&gt;=     </span><br/><span class="line">==   </span><br/><span class="line">~=</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>这些操作符返回结果为false或者true</p>
<p>==和~=比较两个值，如果两个值类型不同，lua认为两者不同；nil只和自己相等。lua通过引用比较tables、userdata、functions。也就是说当且仅当两者表示同一对象时相等。<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a,b = <span class="number">11</span>,<span class="string">&#34;33&#34;</span></span><br/><span class="line"><span class="built_in">print</span>(a==b)     </span><br/><span class="line"><span class="built_in">print</span>(a~=b)     <span class="comment">-- false</span></span><br/><span class="line"><span class="built_in">print</span>(a&gt;=b)     <span class="comment">-- trye</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>A=10 B=20</p>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">==</td>
<td style="text-align:center">等于，检测两个值是否相等，相等返回true，否则返回false</td>
<td style="text-align:center">（A == B） 为false</td>
</tr>
<tr>
<td style="text-align:center">~=</td>
<td style="text-align:center">等于，检测两个值是否相等，相等返回false，否则返回true</td>
<td style="text-align:center">(A ~= B) 为true</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于，如果左边的值大于右边的值，返回true，否则返回false</td>
<td style="text-align:center">(A &gt; B) 为false</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于，如果左边的值大于右边的值，返回false，否则返回true</td>
<td style="text-align:center">(A &gt;= B)返回false</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于，如果左边的值大于等于右边的值，返回true，否则返回false</td>
<td style="text-align:center">(A &gt;= B) 返回false</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于，如果左边的值小于等于右边的值，返回true，否则返回false</td>
<td style="text-align:center">(A &lt;= B) 返回true</td>
</tr>
</tbody>
</table>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span></span><br/><span class="line"><span class="keyword">or</span></span><br/><span class="line"><span class="keyword">not</span></span><br/></pre></td></tr></tbody></table></figure>
<p>逻辑运算符认为false和nil是假（false），其他是真，0和空字符串也是true</p>
<p>and和or的运算结果不是true和false，而是他的两个操作数相关</p>
<p>a and b      – 如果a为false，则返回a，否则返回b</p>
<p>a or b     – 如果a为true，则返回a，否则返回b<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">4</span> <span class="keyword">and</span> <span class="number">5</span>)     <span class="comment">-- 5</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="literal">nil</span> <span class="keyword">and</span> <span class="number">13</span>)     <span class="comment">-- nil</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="literal">false</span> <span class="keyword">and</span> <span class="number">13</span>)     <span class="comment">-- false</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="number">4</span> <span class="keyword">or</span> <span class="number">5</span>)     <span class="comment">-- 4</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="literal">false</span> <span class="keyword">or</span> <span class="number">5</span>)     <span class="comment">-- 5</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>A=10 B=20</p>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">and</td>
<td style="text-align:center">逻辑与操作符，如果两边的操作都为true，则条件为true</td>
<td style="text-align:center">(A and B) 为false</td>
</tr>
<tr>
<td style="text-align:center">or</td>
<td style="text-align:center">逻辑或操作符，如果两边的操作任意一个为true，则条件为true</td>
<td style="text-align:center">(A or B) 为true</td>
</tr>
<tr>
<td style="text-align:center">not</td>
<td style="text-align:center">逻辑非运算符，与逻辑运算结果相反没如果条件为true，逻辑非为false</td>
<td style="text-align:center">not(A and B)为true</td>
</tr>
</tbody>
</table>
<h3 id="连接运算符"><a href="#连接运算符" class="headerlink" title="连接运算符"></a>连接运算符</h3><p>lua中字符串的连接操作符写作两个点(‘..’)</p>
<p>字符串连接，如果操作数为数字，lua将数字转换成字符串</p>
<p>如果前面连接的是数值，靠近数值边的连接符要有空格，若数值实在后面则无要求<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a,b = <span class="number">11</span>,<span class="string">&#34;33&#34;</span></span><br/><span class="line"><span class="built_in">print</span>(a..b)     <span class="comment">-- 1133</span></span><br/><span class="line"><span class="built_in">print</span>(<span class="string">&#34;cc&#34;</span>.<span class="number">.1</span>)     <span class="comment">-- cc1</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>从高到低的顺序<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line">^</span><br/><span class="line"><span class="keyword">not</span>     -(unary)</span><br/><span class="line">*     /</span><br/><span class="line">+     -</span><br/><span class="line">..</span><br/><span class="line">&lt;     &gt;     &lt;=     &gt;=     ~=     ==</span><br/><span class="line"><span class="keyword">and</span></span><br/><span class="line"><span class="keyword">or</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>除了^和..以外所有的二元运算符都是左连接的<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--一个常见的错误</span></span><br/><span class="line"><span class="keyword">local</span> a,b = <span class="number">1</span>,<span class="number">2</span></span><br/><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> a&gt;b <span class="keyword">then</span></span><br/><span class="line">     <span class="built_in">print</span>(a)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">     <span class="built_in">print</span>(b)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">=====结果=====</span><br/><span class="line">错误</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>这里的错误是因为not a返回的是false，false和b不是一个类型，所以报错<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a,b = <span class="number">1</span>,<span class="number">2</span></span><br/><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> (a &gt; b) <span class="keyword">then</span></span><br/><span class="line">     <span class="built_in">print</span>(a)</span><br/><span class="line"><span class="keyword">else</span></span><br/><span class="line">     <span class="built_in">print</span>(b)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">=====结果=====</span><br/><span class="line"><span class="number">1</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<h3 id="table构造"><a href="#table构造" class="headerlink" title="table构造"></a>table构造</h3><p>lua中表既不是值也不是变量，而是对象。lua表没有固定尺寸，可动态地增加元素</p>
<p>表的创建：创建一张空表：local t = {}<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="keyword">local</span> t = {<span class="string">&#34;s&#34;</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#34;a&#34;</span>}</span><br/><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span></span><br/><span class="line">     <span class="built_in">print</span>(k,v)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">=====结果=====</span><br/><span class="line"><span class="number">1</span>     s</span><br/><span class="line"><span class="number">2</span>     <span class="number">2</span></span><br/><span class="line"><span class="number">3</span>     <span class="number">3</span></span><br/><span class="line"><span class="number">4</span>     a</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>表的索引，下表是从1开始的<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = {<span class="string">&#34;s&#34;</span> , <span class="number">2</span> , <span class="number">3</span> , x = <span class="string">&#34;a&#34;</span>}</span><br/><span class="line"><span class="built_in">print</span>(t.x)</span><br/><span class="line"><span class="keyword">local</span> x = <span class="number">3</span></span><br/><span class="line"><span class="built_in">print</span>(t[x])</span><br/><span class="line"><span class="built_in">print</span>(t[<span class="string">&#34;x&#34;</span>])</span><br/><span class="line"></span><br/><span class="line">=====结果=====</span><br/><span class="line">a</span><br/><span class="line"><span class="number">3</span></span><br/><span class="line">a</span><br/></pre></td></tr></tbody></table></figure><p></p>
<h3 id="取长度操作符"><a href="#取长度操作符" class="headerlink" title="取长度操作符"></a>取长度操作符</h3><p>取长度操作符写作一元操作#，字符串的长度是他的字节数</p>
<p>table t的长度被定义成一个整数下表n，它满足t[n]不是nil而t[n+1]为nil，此外，如果t[1]为nil，n就可能是0<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="keyword">local</span> t = {<span class="string">&#34;s&#34;</span>,<span class="number">2</span>,<span class="number">3</span>,x = <span class="number">4</span>,<span class="number">5</span>}</span><br/><span class="line"><span class="built_in">print</span>(#t)</span><br/><span class="line"></span><br/><span class="line">=====结果=====</span><br/><span class="line"><span class="number">4</span></span><br/></pre></td></tr></tbody></table></figure><p></p>