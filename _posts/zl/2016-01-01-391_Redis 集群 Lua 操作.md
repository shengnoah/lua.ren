---
layout: post
title: Redis 集群 Lua 操作 
tags: [lua文章]
categories: [topic]
---
redis 集群的单键操作，基本跟单机版一样，没有太大的区别  
redis集群的操作相对麻烦一点，由于slot的存在，同一组key可能会被分派到不同的slot中,这会导致lua在执行多键操作时遇到错误

需要使用redis 的hashtag来将一组类似的key分配到同一个slot中，方便lua操作

具体原理见[redis hash tag](https://redis.io/topics/cluster-spec#keys-hash-tags)

具体操作方式时对一组key，选取key中的某个部分，前后标记“{}” ，如：

    
    
    helloredisone->hello{redis}one
    helloredistwo->hello{redis}two
    

这样两个key由于相同的hash tag，会被分配到同一个slot中，这样lua操作就正常了