---
layout: post
title: Lua 学习 chapter3 数值  
tags: [lua文章]
categories: [topic]
---
<h3 id="目录">目录</h3>
<ol>
  <li>算术计算</li>
  <li>关系运算</li>
  <li>数学库</li>
  <li>表示范围</li>
  <li>运算符的优先级</li>
  <li>练习</li>
</ol>

<blockquote>
  <p>To be honest, i think what you have compare to others expection has a long way.</p>
</blockquote>

<h2 id="算术计算">算术计算</h2>

<p>在lua中，除法运算操作的永远是浮点数而且产生的结果也是浮点数。</p>

<p>在新的版本中针对于整数除法引入了一个floor除法的新运算符‘//’，floor除法会对得到的上进行向下取整，从而保证结果是一个整数。</p>

<p>如果操作数是整形类型结果就是整型类型，如果操作数是浮点类型那么结果就是浮点类型（其值是个整数），类似的取模运算(%)也是一样的。</p>

<h2 id="关系运算">关系运算</h2>

<p>Lua提供了下列的关系运算：</p>

<p>&lt; &gt; &lt;= &gt;= == ~=  这个关系运算的返回值都是Boolean类型的。</p>

<h2 id="数学库">数学库</h2>

<p>Lua提供了标准的数学库 math，包含三角函数，指数，取整，最大最小，用于生成伪随机的random函数以及pi和huge(最大可表示的值)。</p>

<h3 id="随机数发生器">随机数发生器</h3>

<p>lua中随机数共有三种调用方式：</p>

<ol>
  <li>不带参：随机返回一个伪随机的[0,1)的数</li>
  <li>带一个整型参：返回一个[1,n]的伪随机整数</li>
  <li>带两个整型参：返回一个[n,m]的伪随机整数</li>
</ol>

<p>函数randomseed用于设置伪随机数发生器的种子，该函数的唯一参数就是数值类型的种子。</p>

<p>在一个程序启动时，系统固定使用1为随机数发生器。如果不设置其它种子，每次系统启动都会产生一样的随机数。</p>

<p>所以为了解决这个问题通常使用<strong>math.randomseed(os.time())</strong> 来作为种子。</p>

<h3 id="取整函数">取整函数</h3>
<ol>
  <li>floor：向下取整</li>
  <li>ceil：向上取整</li>
  <li>modf：向0取整</li>
</ol>

<p>就近取整：</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
	<span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>  <span class="k">then</span> 
		<span class="k">return</span> <span class="n">x</span>
	<span class="k">else</span> 
		<span class="k">return</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
	<span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="表示范围">表示范围</h2>

<p>lua使用64个比特位来存储整型值，其最大值为2^63 - 1。</p>

<p>我们可以简单的使用整数加上0.0来转换成浮点数。</p>

<p>在lua的管理中，超过2^53之后这样转换就会失去精度。</p>

<p>特别是在进行浮点数的运算过程中，可能会导致计算的不精确。例如：</p>

<p>12.7 -20 + 7.3，即便使用双精度来表示结果也不是0，因为12.7和7.3的二进制表示不是有限的小数。</p>

<h2 id="运算符的优先级">运算符的优先级</h2>

<ol>
  <li></li>
  <li>一元运算符 （- # ~ not）</li>
  <li>/  //  %  （//  floor除）</li>
  <li>
    <ul>
      <li>-</li>
    </ul>
  </li>
  <li>..（连接）</li>
  <li>« » （按位移位）</li>
  <li>&amp;</li>
  <li>~</li>
  <li>
    <table>
      <tbody>
        <tr>
        </tr>
      </tbody>
    </table>
  </li>
  <li>&lt; &gt; &lt;= &gt;= ~= ==</li>
  <li>and or</li>
</ol>

<h2 id="练习">练习</h2>

<p>乘2，就是左移一位。</p>

<p>使用math.random生成正太分布的为随机数发生器</p>

<p>采用 Box-Muller 变换可以将均匀分布转化成正态分布</p>

<p>Z=R<em>cosθ 或 Z=R</em>sinθ （其中 R = sqrt(-2<em>ln(u1)), θ = 2</em>π*u2，u1和u2是（0，1]的均匀分布随机数，得到的Z就是标准正态分布随机数。</p>

<ol>
  <li>
    <p>生成均匀分布的随机数，math.random 函数生成的是 [ 0,1 ) 之间的随机数，只需在生成 0 时改为生成 1 。</p>
  </li>
  <li>
    <p>通过Box-Muller公式得到服从正态分布的随机数</p>
  </li>
</ol>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="n">rand1</span><span class="p">,</span><span class="n">rand2</span><span class="o">=</span><span class="nb">math.random</span><span class="p">(),</span><span class="nb">math.random</span><span class="p">()</span>
  <span class="n">rand1</span><span class="o">=</span><span class="n">rand1</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rand1</span><span class="p">)</span>
  <span class="n">rand2</span><span class="o">=</span><span class="p">(</span><span class="n">rand2</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rand2</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">math.sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="o">*</span><span class="p">(</span><span class="nb">math.log</span><span class="p">(</span><span class="n">rand1</span><span class="p">)))</span><span class="o">*</span><span class="nb">math.sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">math.pi</span><span class="o">*</span><span class="n">rand2</span><span class="p">);</span>	
</pre></td></tr></tbody></table></code></pre></div></div>


                <hr style="visibility: hidden;"/>
                
                <hr style="visibility: hidden;"/>