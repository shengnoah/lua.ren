---
layout: post
title: Lua 学习 chapter10  
tags: [lua文章]
categories: [topic]
---
<h3 id="目录">目录</h3>
<ol>
  <li>正则表达式</li>
  <li>模式匹配相关的函数</li>
  <li>URL编码</li>
  <li>制表符的展开</li>
  <li>诀窍</li>
  <li>模式</li>
</ol>

<blockquote>
  <p>Just be handsome.</p>
</blockquote>

<h2 id="正则表达式">正则表达式</h2>
<ol>
  <li>. 任意字符</li>
  <li>%a 字母</li>
  <li>%c 控制字符</li>
  <li>%d 数字</li>
  <li>%g 除空格外的可打印字符</li>
  <li>%l 小写字母</li>
  <li>%p标点符号</li>
  <li>%s 空白字符</li>
  <li>%u 大写字母</li>
  <li>%w 字母和数字</li>
  <li>%x 十六进制数字</li>
</ol>

<p>%它们的大写字母表示它们的补集。</p>

<p>还有一些魔法字符，也可以称之为元字符。</p>

<p>其中与其他的语言不同的是在lua中%是转义字符而不是’&#39;。</p>

<ol>
  <li>+ 重复一次或多次</li>
  <li>* 重复零次或者多次（最大匹配）</li>
  <li>- 重复零次或者多次（最小匹配）位于[]中中间表示范围</li>
  <li>？ 可选</li>
  <li>^ 位于模式的开头 从头开始匹配  位于[]中开头表示非</li>
  <li>$ 位于模式的结尾 从尾部向前匹配</li>
</ol>

<p>在lua中可以使用()来对匹配到的结果进行返回。这个称之为<strong>捕获</strong>。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">pair</span> <span class="o">=</span> <span class="s2">&#34;name = Anna&#34;</span>
<span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="s2">&#34;(%a+)%s*=%s*(%a+)&#34;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="c1">-- name Anna</span>

<span class="n">s</span> <span class="o">=</span> <span class="s">[[then he said: &#34;it&#39;s al right&#34;!]]</span>
<span class="n">q</span><span class="p">,</span> <span class="n">quotedPart</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;([&#34;</span><span class="s1">&#39;](.-)%1&#34;)
print(quotedPart) -- it&#39;</span><span class="n">s</span> <span class="n">al</span> <span class="n">right</span>

<span class="c1">--find的使用</span>
<span class="nb">string.find</span><span class="p">(</span><span class="s2">&#34;a [word]&#34;</span><span class="p">,</span><span class="s2">&#34;[&#34;</span><span class="p">)</span>
<span class="c1">-- stdin:1: malformed pattern(missing &#39;]&#39;)</span>
<span class="nb">string.find</span><span class="p">(</span><span class="s2">&#34;a [word]&#34;</span><span class="p">,</span><span class="s2">&#34;[&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="kc">true</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="模式匹配相关的函数">模式匹配相关的函数</h2>
<ol>
  <li>string.find(ste,reg) –返回开始和结束的index，find是存在是个参数的，如果寻找的是特殊的字符，例如‘[’是模式匹配中的，那就需要第三个参数和第四个参数，第三个参数表明从哪个位置开始索引，第四个数字表示简单查询。</li>
  <li>string.match – 返回匹配到的内容</li>
  <li>string.gmatch –返回一个函数，通过函数可以遍历一个字符串出现的指定模式</li>
  <li>string.sub –截取字符串</li>
  <li>string.gsub –替换字符串，当第三个参数是字符串的时候，直接替换。如果是函数，会把匹配的内容作为参数传给函数，将函数的返回值替换原来的值，如果是表，匹配的内容作为键值去取数据。</li>
</ol>

<p>string.sub 有三个参数，它的第三个参数不仅仅可以是字符串还可以是函数或者表。</p>

<p>当时函数的时候每次匹配到合适的字符串的时候就调用函数参数为匹配到的值，用函数的返回值来替换字符串；当是表的时候，将匹配到的字符串作为key值来得到用来替换的字符串。</p>

<p>%f[char-set]表示前置模式。该模式只有在后一个字符位于char-set内而前一个字符不在时匹配一个空字符串。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;some string&#34;</span>
<span class="kd">local</span> <span class="n">words</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">w</span> <span class="k">in</span> <span class="nb">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;%a+&#34;</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="k">end</span> <span class="c1">-- some string </span>

<span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Lua&#34;</span>
<span class="n">status</span> <span class="o">=</span> <span class="s2">&#34;great&#34;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expend</span><span class="p">(</span><span class="s2">&#34;$name is $status&#34;</span><span class="p">))</span> <span class="c1">--Lua is great	2 其中2表示匹配成功的字符串</span>

<span class="c1">--使用%bxy，x和y为任意字符，匹配它们两个中间的字符串</span>
<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;a (enclosed (in) parentheses) line&#34;</span>
<span class="kd">local</span> <span class="n">smatch</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;%b()&#34;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">smatch</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="url编码">url编码</h2>

<p>这种编码方式会将特殊字符编码为”%xx”的形式（=、&amp;、+）,会将空格转换为加号”+”。例如字符串”a+b = c”,就会别编码成”a%2Bb+%3D+c”。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">unescape</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
	<span class="n">s</span> <span class="o">=</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;+&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span>
	<span class="n">s</span> <span class="o">=</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;%%(%x%x&#34;</span><span class="p">),</span><span class="k">function</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">string.char</span><span class="p">(</span><span class="nb">tonumber</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
	<span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="制表符的展开">制表符的展开</h2>

<p>在lua语言中，像”()”这样的空白捕捉具有特殊的含义，表示捕捉模式在目标字符串中的位置。</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nb">print</span><span class="o">*</span><span class="nb">string.match</span><span class="p">(</span><span class="s2">&#34;hell0&#34;</span><span class="p">,</span> <span class="s2">&#34;()ll()&#34;</span><span class="p">)</span> <span class="c1">--&gt;3  5</span>
<span class="c1">--输出的是匹配的第一个字符的位置和输出最后一个字符之后的那个字符的位置</span>
<span class="k">function</span> <span class="nf">expandTabs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">tab</span><span class="p">)</span>
	<span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span> <span class="ow">or</span> <span class="mi">8</span>
	<span class="kd">local</span> <span class="n">corr</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">s</span> <span class="o">=</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;()t&#34;</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="kd">local</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">tab</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">corr</span><span class="p">)</span> <span class="o">%</span> <span class="n">tab</span>
		<span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sp</span>
		<span class="k">return</span> <span class="nb">string.rep</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
	<span class="k">end</span><span class="p">)</span>
<span class="k">return</span> <span class="n">s</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="诀窍">诀窍</h2>

<ol>
  <li>”(.-)%$”  和 “^(.-)%$”  –前面一种模式的匹配会导致当没有’$’符号时，模式匹配算法会从字符串的第一个位置开始匹配，到尾之后从第二个位置再次匹配，算法的复杂度为n的二次方。</li>
  <li>“%a*” 会导致空字符串</li>
</ol>

<p>所以在使用 “.-“的时候注意会匹配到空字符串。</p>

<h2 id="模式">模式</h2>

<p>%bxy匹配成对的字符串和%f[char-set]的前置模式（后一个字符位于模式内，而前一个字符不在模式内）</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;a [word]!&#34;</span>

<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;a [word]!&#34;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&#34;()(%b[])()&#34;</span><span class="p">))</span> <span class="c1">--3 [word] 9，()用来捕获输出值，当使用捕获的时候，没有输出捕获的内容，在这里双括号里面没有任何东西的时候，会输出匹配内容的第一个字符的位置和最后一个字符的后一个位置。</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="nb">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&#34;()%b[]()&#34;</span><span class="p">)))</span> <span class="c1">--[word]!</span>

<span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;one day i will find one way!&#34;</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&#34;%f[%w][%w*]%f[%W]&#34;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">word</span> <span class="k">in</span> <span class="nb">string.gmatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&#34;%f[%w][%w*]%f[%W]&#34;</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- 只有一个i</span>
<span class="c1">-- 如果将[%w*]换成one，将会输出两个one。</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>在捕获中，还有一个非常重要的概念，那就是匹配第几次捕捉到的内容，例如匹配双引号或者单引号中的字符串，如果仅仅使用”[&#34;’].-[&#34;’]”,这样的模式，但是遇到”it’s all right!”这样的就会出错。</p>

<p>所以在这里我们通过通过捕捉，然后使用“%n”这样的形式(表示匹配第n个不会的副本）。</p>

<p>还可以用在gsub中：</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">s</span> <span class="o">=</span> <span class="s">[[then he said:&#34;it&#39;s all right!&#34;]]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">string.match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&#34;([&#34;</span><span class="s1">&#39;])(.-)%1&#34;)) --捕获第一个匹配值，和要匹配的内容，其中%1里的内容应该是&#39;</span><span class="s2">&#34;&#39;

s = &#34;</span><span class="n">hello</span> <span class="n">world</span><span class="err">!</span><span class="s2">&#34;

print(string.gsub(s,&#34;</span><span class="p">(.)(.)</span><span class="s2">&#34;,&#34;</span><span class="o">%</span><span class="mi">2</span><span class="o">%</span><span class="mi">1</span><span class="s2">&#34;)) --ehll oowlr!d	6，6表示替换发生了几次
</span></pre></td></tr></tbody></table></code></pre></div></div>



                <hr style="visibility: hidden;"/>
                
                <hr style="visibility: hidden;"/>