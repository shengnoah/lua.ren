---
layout: post
title: Lua作图教程之lua面向对象 
tags: [lua文章]
categories: [topic]
---
<ul>
<li>C++</li>
<li>Java</li>
<li>Objective-C</li>
<li>Smalltalk</li>
<li>C#</li>
<li>Ruby</li>
</ul>
<h3 id="面向对象特征"><a href="#面向对象特征" class="headerlink" title="面向对象特征"></a>面向对象特征</h3><ul>
<li>1） 封装：指能够把一个实体的信息、功能、响应都装入一个单独的对象中的特性。</li>
<li>2） 继承：继承的方法允许在不改动原程序的基础上对其进行扩充，这样使得原功能得以保存，而新功能也得以扩展。这有利于减少重复编码，提高软件的开发效率。</li>
<li>3） 多态：同一操作作用于不同的对象，可以有不同的解释，产生不同的执行结果。在运行时，可以通过指向基类的指针，来调用实现派生类中的方法。</li>
<li>4）抽象：抽象(Abstraction)是简化复杂的现实问题的途径，它可以为具体问题找到最恰当的类定义，并且可以在最恰当的继承级别解释问题。</li>
</ul>
<h3 id="Lua-中面向对象"><a href="#Lua-中面向对象" class="headerlink" title="Lua 中面向对象"></a>Lua 中面向对象</h3><p>我们知道，对象由属性和方法组成。LUA中最基本的结构是table，所以需要用table来描述对象的属性。</p>
<p>lua中的function可以用来表示方法。那么LUA中的类可以通过table + function模拟出来。</p>
<p>至于继承，可以通过metetable模拟出来（不推荐用，只模拟最基本的对象大部分时间够用了）。</p>
<p>Lua中的表不仅在某种意义上是一种对象。像对象一样，表也有状态（成员变量）；也有与对象的值独立的本性，特别是拥有两个不同值的对象（table）代表两个不同的对象；一个对象在不同的时候也可以有不同的值，但他始终是一个对象；与对象类似，表的生命周期与其由什么创建、在哪创建没有关系。对象有他们的成员函数，表也有：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">Account = {balance = <span class="number">0</span>}</span><br/><span class="line"><span class="function"><span class="keyword">function</span>  <span class="params">(v)</span></span></span><br/><span class="line">    Account.balance = Account.balance - v</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>这个定义创建了一个新的函数，并且保存在Account对象的withdraw域内，下面我们可以这样调用：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">Account.withdraw(<span class="number">100.00</span>)</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="一个简单实例"><a href="#一个简单实例" class="headerlink" title="一个简单实例"></a>一个简单实例</h4><p>以下简单的类包含了三个属性： area, length 和 breadth，printArea方法用于打印计算结果：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">Rectangle = {area = <span class="number">0</span>, length = <span class="number">0</span>, breadth = <span class="number">0</span>}</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 派生类的方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:new</span> <span class="params">(o,length,breadth)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> {}</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  self.length = length <span class="keyword">or</span> <span class="number">0</span></span><br/><span class="line">  self.breadth = breadth <span class="keyword">or</span> <span class="number">0</span></span><br/><span class="line">  self.area = length*breadth;</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 派生类的方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;矩形面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><p>创建对象是为类的实例分配内存的过程。每个类都有属于自己的内存并共享公共数据。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">r = Rectangle:new(<span class="literal">nil</span>,<span class="number">10</span>,<span class="number">20</span>)</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h4><p>我们可以使用点号(.)来访问类的属性：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(r.length)</span><br/></pre></td></tr></tbody></table></figure>
<h4 id="访问成员函数"><a href="#访问成员函数" class="headerlink" title="访问成员函数"></a>访问成员函数</h4><p>我们可以使用冒号 : 来访问类的成员函数：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">r:printArea()</span><br/></pre></td></tr></tbody></table></figure>
<p>内存在对象初始化时分配。</p>
<h4 id="完整实例"><a href="#完整实例" class="headerlink" title="完整实例"></a>完整实例</h4><p>以下我们演示了 Lua 面向对象的完整实例：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">Shape = {area = <span class="number">0</span>}</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 基础类方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o,side)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> {}</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  side = side <span class="keyword">or</span> <span class="number">0</span></span><br/><span class="line">  self.area = side*side;</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 创建对象</span></span><br/><span class="line">myshape = Shape:new(<span class="literal">nil</span>,<span class="number">10</span>)</span><br/><span class="line"></span><br/><span class="line">myshape:printArea()</span><br/></pre></td></tr></tbody></table></figure>
<p>执行以上程序，输出结果为：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">面积为     <span class="number">100</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="Lua-继承"><a href="#Lua-继承" class="headerlink" title="Lua 继承"></a>Lua 继承</h4><p>继承是指一个对象直接使用另一对象的属性和方法。可用于扩展基础类的属性和方法。
以下演示了一个简单的继承实例：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"> </span><br/><span class="line">Shape = {area = <span class="number">0</span>}</span><br/><span class="line"><span class="comment">-- 基础类方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o,side)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> {}</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  side = side <span class="keyword">or</span> <span class="number">0</span></span><br/><span class="line">  self.area = side*side;</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>接下来的实例，Square 对象继承了 Shape 类:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line">Square = Shape:new()</span><br/><span class="line"><span class="comment">-- Derived class method new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:new</span> <span class="params">(o,side)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> Shape:new(o,side)</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="完整实例-1"><a href="#完整实例-1" class="headerlink" title="完整实例"></a>完整实例</h4><p>以下实例我们继承了一个简单的类，来扩展派生类的方法，派生类中保留了继承类的成员变量和方法：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line">Shape = {area = <span class="number">0</span>}</span><br/><span class="line"><span class="comment">-- 基础类方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o,side)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> {}</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  side = side <span class="keyword">or</span> <span class="number">0</span></span><br/><span class="line">  self.area = side*side;</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 创建对象</span></span><br/><span class="line">myshape = Shape:new(<span class="literal">nil</span>,<span class="number">10</span>)</span><br/><span class="line">myshape:printArea()</span><br/><span class="line"></span><br/><span class="line">Square = Shape:new()</span><br/><span class="line"><span class="comment">-- 派生类方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:new</span> <span class="params">(o,side)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> Shape:new(o,side)</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;正方形面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 创建对象</span></span><br/><span class="line">mysquare = Square:new(<span class="literal">nil</span>,<span class="number">10</span>)</span><br/><span class="line">mysquare:printArea()</span><br/><span class="line"></span><br/><span class="line">Rectangle = Shape:new()</span><br/><span class="line"><span class="comment">-- 派生类方法 new</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:new</span> <span class="params">(o,length,breadth)</span></span></span><br/><span class="line">  o = o <span class="keyword">or</span> Shape:new(o)</span><br/><span class="line">  <span class="built_in">setmetatable</span>(o, self)</span><br/><span class="line">  self.<span class="built_in">__index</span> = self</span><br/><span class="line">  self.area = length * breadth</span><br/><span class="line">  <span class="keyword">return</span> o</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;矩形面积为 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 创建对象</span></span><br/><span class="line">myrectangle = Rectangle:new(<span class="literal">nil</span>,<span class="number">10</span>,<span class="number">20</span>)</span><br/><span class="line">myrectangle:printArea()</span><br/></pre></td></tr></tbody></table></figure>
<p>执行以上代码，输出结果为：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/></pre></td><td class="code"><pre><span class="line">面积为     <span class="number">100</span></span><br/><span class="line">正方形面积为     <span class="number">100</span></span><br/><span class="line">矩形面积为     <span class="number">200</span></span><br/></pre></td></tr></tbody></table></figure>
<h4 id="函数重写"><a href="#函数重写" class="headerlink" title="函数重写"></a>函数重写</h4><p>Lua 中我们可以重写基础类的函数，在派生类中定义自己的实现方式：</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:printArea</span> <span class="params">()</span></span></span><br/><span class="line">  <span class="built_in">print</span>(<span class="string">&#34;正方形面积 &#34;</span>,self.area)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>