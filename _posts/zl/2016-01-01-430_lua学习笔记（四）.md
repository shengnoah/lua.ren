---
layout: post
title: lua学习笔记（四） 
tags: [lua文章]
categories: [topic]
---
<h2 id="Lua数组"><a href="#Lua数组" class="headerlink" title="Lua数组"></a>Lua数组</h2><h3 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/></pre></td><td class="code"><pre><span class="line">array={<span class="string">&#34;Lua&#34;</span>,<span class="string">&#34;Java&#34;</span>,<span class="string">&#34;C++&#34;</span>}</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">0</span>,<span class="number">2</span> <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(array[i])</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">输出结果：</span></span><br/><span class="line"><span class="comment">nil</span></span><br/><span class="line"><span class="comment">Lua</span></span><br/><span class="line"><span class="comment">Java</span></span><br/><span class="line"><span class="comment">结果分析：</span></span><br/><span class="line"><span class="comment">Lua索引值以1为起始，也可以指定0开始</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="comment">-- 以负数为数组索引值</span></span><br/><span class="line">array={}</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">-2</span>,<span class="number">2</span> <span class="keyword">do</span></span><br/><span class="line">    array[i]=i*<span class="number">2</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">-2</span>,<span class="number">2</span> <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(array[i])</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 初始化数组</span></span><br/><span class="line">array={}</span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">    array[i]={}</span><br/><span class="line">    <span class="keyword">for</span> j=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">        array[i][j]=i*j</span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 访问数组</span></span><br/><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">    <span class="keyword">for</span> j=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">        <span class="built_in">print</span>(array[i][j])</span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="Lua迭代器"><a href="#Lua迭代器" class="headerlink" title="Lua迭代器"></a>Lua迭代器</h2><p>一种对象，能够用来遍历标准模板库容器中的部分或全部元素，每个迭代器对象代表容器中的确定的地址。</p>
<p>在Lua中迭代器是一种支持指针类型的结构，它可以遍历集合的每一个元素</p>
<h3 id="泛型for迭代器"><a href="#泛型for迭代器" class="headerlink" title="泛型for迭代器"></a>泛型for迭代器</h3><p>泛型 for 在自己内部保存迭代函数，实际上它保存三个值：迭代函数、状态常量、控制变量</p>
<h4 id="泛型for的执行过程"><a href="#泛型for的执行过程" class="headerlink" title="泛型for的执行过程"></a>泛型for的执行过程</h4><p><a href="https://www.runoob.com/lua/lua-iterators.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/lua/lua-iterators.html</a></p>
<h3 id="Lua迭代器类型"><a href="#Lua迭代器类型" class="headerlink" title="Lua迭代器类型"></a>Lua迭代器类型</h3><ul>
<li>无状态的迭代器</li>
<li>多状态的迭代器</li>
</ul>
<h4 id="无状态的迭代器"><a href="#无状态的迭代器" class="headerlink" title="无状态的迭代器"></a>无状态的迭代器</h4><p>不保留任何状态的迭代器，每一次迭代，迭代函数都是用<strong>两个变量</strong>（状态常量和控制变量）的值作为参数被调用，一个无状态的迭代器只利用这两个值可以获取下一个元素。如：<code>ipairs</code>函数</p>
<h4 id="多状态的迭代器"><a href="#多状态的迭代器" class="headerlink" title="多状态的迭代器"></a>多状态的迭代器</h4><p>迭代器需要保存多个状态信息而不是简单的状态常量和控制变量，方法：</p>
<ul>
<li>使用闭包（类似于lambda表达式，该表达式能包含函数本身以及外部引用变量，外部引用变量类似于lambda表达式中<code>[]</code>内捕获的外部变量）</li>
<li>将所有状态信息封装到table内</li>
</ul>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/></pre></td><td class="code"><pre><span class="line">array={<span class="string">&#34;Google&#34;</span>,<span class="string">&#34;Apple&#34;</span>}</span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(collection)</span></span></span><br/><span class="line">    <span class="keyword">local</span> index=<span class="number">0</span></span><br/><span class="line">    <span class="keyword">local</span> count=#collection</span><br/><span class="line">    <span class="comment">-- 闭包函数</span></span><br/><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br/><span class="line">        index=index+<span class="number">1</span></span><br/><span class="line">        <span class="keyword">if</span> index&lt;=count <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> collection[index]</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elementIterator(array) <span class="keyword">do</span></span><br/><span class="line">    <span class="built_in">print</span>(element)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">输出结果：</span></span><br/><span class="line"><span class="comment">Google</span></span><br/><span class="line"><span class="comment">Apple</span></span><br/><span class="line"><span class="comment">]]</span></span><br/></pre></td></tr></tbody></table></figure>
<h2 id="Lua-table（表）"><a href="#Lua-table（表）" class="headerlink" title="Lua table（表）"></a>Lua table（表）</h2><p>table是一种数据结构，可以用于创建不同的数据类型：数组、字典等</p>
<p>table的特点：</p>
<ul>
<li>使用关联型数组，可以用任意非nil的类型作为数组的索引</li>
<li>大小不固定，可以根据需要扩容</li>
<li>可以用于解决模块（module）、包（package）和对象（Object）</li>
</ul>
<h3 id="table的构造"><a href="#table的构造" class="headerlink" title="table的构造"></a>table的构造</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 初始化表</span></span><br/><span class="line">mytable={}		<span class="comment">-- 最简单的构造函数</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 指定值</span></span><br/><span class="line">mytable[<span class="number">1</span>]=<span class="string">&#34;Lua&#34;</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 移除引用</span></span><br/><span class="line">mytable=<span class="literal">nil</span></span><br/><span class="line"><span class="comment">-- Lua垃圾回收会释放内存</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 注意：table间的赋值是传引用，两者指向同一个内存，只有当没有任何变量指向该内存（即所有table变量都指向了nil），Lua的垃圾回收机制才会清理相对应的内存</span></span><br/></pre></td></tr></tbody></table></figure>
<h3 id="table操作"><a href="#table操作" class="headerlink" title="table操作"></a>table操作</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/></pre></td><td class="code"><pre><span class="line"></span><br/><span class="line"><span class="comment">作用：列出参数中指定table的数组部分从start位置到end位置的所有元素, 元素间以指定的分隔符(sep)隔开</span></span><br/><span class="line"><span class="comment">参数列表：</span></span><br/><span class="line"><span class="comment">	table：操作对象</span></span><br/><span class="line"><span class="comment">	sep：分隔符</span></span><br/><span class="line"><span class="comment">	start：起始索引</span></span><br/><span class="line"><span class="comment">	end：末尾索引</span></span><br/><span class="line"><span class="comment">返回值：连接后的字符串</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">concat</span>(<span class="built_in">table</span>[,sep[,start[,<span class="keyword">end</span>]]])</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">作用：在table的数组部分指定位置(pos)插入值为value的一个元素</span></span><br/><span class="line"><span class="comment">参数列表：</span></span><br/><span class="line"><span class="comment">	table：操作对象</span></span><br/><span class="line"><span class="comment">	pos：插入位置，默认为数组部分的末尾</span></span><br/><span class="line"><span class="comment">	value：插入的值</span></span><br/><span class="line"><span class="comment">返回值：</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(<span class="built_in">table</span>,[pos,]value)</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">作用：删除table数组部分位于pos位置的元素，其后的元素会被前移</span></span><br/><span class="line"><span class="comment">参数列表：</span></span><br/><span class="line"><span class="comment">	table：操作对象</span></span><br/><span class="line"><span class="comment">	pos：删除的元素位置，默认为最后一个元素的位置</span></span><br/><span class="line"><span class="comment">返回值：删除的元素的值</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">remove</span>(<span class="built_in">table</span>[,pos])</span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">作用：对给定的table进行升序排序，数值按照数值大小，字符串按照首字母ASCCI码排序</span></span><br/><span class="line"><span class="comment">参数列表：</span></span><br/><span class="line"><span class="comment">	table：操作对象</span></span><br/><span class="line"><span class="comment">	comp：比较方法，接收两个参数，返回一个布尔值，为true不交换，为false交换</span></span><br/><span class="line"><span class="comment">返回值：nil</span></span><br/><span class="line"><span class="comment">]]</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(<span class="built_in">table</span>[,comp])</span><br/></pre></td></tr></tbody></table></figure>