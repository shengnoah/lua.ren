---
layout: post
title: Lua程序设计第4版 
tags: [lua文章]
categories: [topic]
---
<h2 id="Lua语言入门"><a href="#Lua语言入门" class="headerlink" title="Lua语言入门"></a>Lua语言入门</h2><h3 id="三目运算"><a href="#三目运算" class="headerlink" title="三目运算"></a>三目运算</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">((a <span class="keyword">and</span> b)<span class="keyword">or</span> c)或(a <span class="keyword">and</span> b <span class="keyword">or</span> c)</span><br/><span class="line"></span><br/></pre></td></tr></tbody></table></figure>

<h3 id="惯用写法-x-x-or-v"><a href="#惯用写法-x-x-or-v" class="headerlink" title="惯用写法 x=x or v"></a>惯用写法 x=x or v</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--等价于</span></span><br/><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">then</span> x = v <span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>

<h3 id="type-nil-nil-疑惑"><a href="#type-nil-nil-疑惑" class="headerlink" title="type(nil) == nil 疑惑"></a>type(nil) == nil 疑惑</h3><p>返回是string类型，用nil做比较应用”nil”</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">type</span>(<span class="literal">nil</span>) == <span class="literal">nil</span> </span><br/><span class="line"><span class="literal">false</span></span><br/><span class="line">&gt; <span class="built_in">type</span>(<span class="literal">nil</span>) == <span class="string">&#34;nil&#34;</span> </span><br/><span class="line"><span class="literal">true</span></span><br/></pre></td></tr></tbody></table></figure>

<h3 id="编写打印自身名称的程序"><a href="#编写打印自身名称的程序" class="headerlink" title="编写打印自身名称的程序"></a>编写打印自身名称的程序</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">arg</span>[<span class="number">0</span>])</span><br/><span class="line"><span class="comment">--考点在编译器运行代码前会先创建arg表来存储命令行参数。</span></span><br/></pre></td></tr></tbody></table></figure>

<h2 id="八皇后"><a href="#八皇后" class="headerlink" title="八皇后"></a>八皇后</h2><h3 id="输出1解"><a href="#输出1解" class="headerlink" title="输出1解"></a>输出1解</h3><p>addqueen中添加os.exit()</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--eight-queen.lua</span></span><br/><span class="line">N = <span class="number">8</span> <span class="comment">--棋盘大小</span></span><br/><span class="line">a = {<span class="number">3</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>}</span><br/><span class="line"><span class="comment">-- 打印棋盘</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(a)</span></span></span><br/><span class="line">	<span class="keyword">for</span> i=<span class="number">1</span>,N <span class="keyword">do</span></span><br/><span class="line">		<span class="keyword">for</span> j=<span class="number">1</span>,N <span class="keyword">do</span></span><br/><span class="line">			<span class="built_in">io</span>.<span class="built_in">write</span>(a[i]==j <span class="keyword">and</span> <span class="string">&#34;X&#34;</span> <span class="keyword">or</span> <span class="string">&#34;-&#34;</span>,<span class="string">&#34; &#34;</span>)</span><br/><span class="line">		<span class="keyword">end</span></span><br/><span class="line">		<span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&#34;n&#34;</span>)</span><br/><span class="line">	<span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 检查当前皇后是否会被攻击，c为列数</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isplaceok</span><span class="params">(a,n,c)</span></span></span><br/><span class="line">	<span class="keyword">for</span> i=<span class="number">1</span>,n<span class="number">-1</span> <span class="keyword">do</span></span><br/><span class="line">		<span class="keyword">if</span> (a[i]==c) <span class="keyword">or</span> <span class="comment">--同一列</span></span><br/><span class="line">		   (a[i]-i == c-n) <span class="keyword">or</span>	<span class="comment">--右下对角线</span></span><br/><span class="line">		   (a[i]+i==c+n) <span class="keyword">then</span>   <span class="comment">--左下对角线</span></span><br/><span class="line">			<span class="keyword">return</span> <span class="literal">false</span> <span class="comment">--遭受攻击</span></span><br/><span class="line">		<span class="keyword">end</span></span><br/><span class="line">		</span><br/><span class="line">	<span class="keyword">end</span></span><br/><span class="line">	<span class="keyword">return</span> <span class="literal">true</span> <span class="comment">--不会被攻击</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--添加皇后</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addqueen</span><span class="params">(a,n)</span></span></span><br/><span class="line">	<span class="keyword">if</span> n &gt; N <span class="keyword">then</span></span><br/><span class="line">		printsolution(a)</span><br/><span class="line">		<span class="built_in">os</span>.<span class="built_in">exit</span>()</span><br/><span class="line">	<span class="keyword">else</span></span><br/><span class="line">		<span class="keyword">for</span> c=<span class="number">1</span>,N <span class="keyword">do</span></span><br/><span class="line">			<span class="keyword">if</span> isplaceok(a,n,c) <span class="keyword">then</span></span><br/><span class="line">				a[n] = c</span><br/><span class="line">				addqueen(a,n+<span class="number">1</span>)</span><br/><span class="line">			<span class="keyword">end</span></span><br/><span class="line">		<span class="keyword">end</span></span><br/><span class="line">	<span class="keyword">end</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">addqueen({},<span class="number">1</span>)</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="强制返回一个结果"><a href="#强制返回一个结果" class="headerlink" title="强制返回一个结果"></a>强制返回一个结果</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--使用括号强制返回第一个返回值</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="string">&#34;a&#34;</span>, <span class="string">&#34;b&#34;</span> <span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>

<p><img src="https://img.dazhuanlan.com/2019/11/26/5ddc9464c69c5.png" alt="001"/></p>
<h2 id="table-unpack"><a href="#table-unpack" class="headerlink" title="table.unpack"></a>table.unpack</h2><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">--将列表转化成一组返回值</span></span><br/><span class="line"><span class="built_in">table</span>.<span class="built_in">unpack</span>({<span class="string">&#34;Sun&#34;</span>,<span class="string">&#34;Mon&#34;</span>,<span class="string">&#34;Tue&#34;</span>,<span class="string">&#34;Wed&#34;</span>},<span class="number">2</span>,<span class="number">3</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">--结果</span></span><br/><span class="line">Mon	Tue</span><br/></pre></td></tr></tbody></table></figure>

<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><h3 id="简单I-O模型"><a href="#简单I-O模型" class="headerlink" title="简单I/O模型"></a>简单I/O模型</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">io</span>.<span class="built_in">read</span>(<span class="string">&#34;a&#34;</span>) <span class="comment">--读取整个文件</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">read</span>(<span class="string">&#34;l&#34;</span>) <span class="comment">--读取下一行（丢弃换行符）</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">read</span>(<span class="string">&#34;L&#34;</span>) <span class="comment">--读取下一行（保留换行符）</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">read</span>(<span class="string">&#34;n&#34;</span>) <span class="comment">--读取一个数值</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">read</span>(num) <span class="comment">--以字符串读取num个字符</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 只读打开指定文件，并将文件设置为当前输入流</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>([file])</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 设置默认输出文件</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">output</span>([file])</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 不带参数关闭默认文件</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>([file])</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 不带参数使用默认文件，返回一个迭代器，用在for循环</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">lines</span>([file])</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 将字符串或数字写入输出流</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">write</span>(value)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 将换缓冲数据写入文件</span></span><br/><span class="line"><span class="built_in">io</span>.<span class="built_in">flush</span>()</span><br/></pre></td></tr></tbody></table></figure>

<h3 id="完整I-O模型"><a href="#完整I-O模型" class="headerlink" title="完整I/O模型"></a>完整I/O模型</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查错误方法</span></span><br/><span class="line"><span class="keyword">local</span> f = <span class="built_in">assert</span>(<span class="built_in">io</span>.<span class="built_in">open</span>(filename,mode))</span><br/></pre></td></tr></tbody></table></figure>

<p>seek获取设置文件位置</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">f:seek(whence,offset)</span><br/><span class="line"><span class="comment">-- 返回当前位置1相对于文件开头的偏移</span></span><br/><span class="line"><span class="comment">-- whence指定使用偏移的字符串  		</span></span><br/><span class="line"><span class="comment">-- set文件头 cur当前位置 end文件尾部 </span></span><br/><span class="line"><span class="comment">-- offset 偏移量</span></span><br/></pre></td></tr></tbody></table></figure>

<h3 id="运行系统命令"><a href="#运行系统命令" class="headerlink" title="运行系统命令"></a>运行系统命令</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">os</span>.<span class="built_in">execute</span> 和 <span class="built_in">io</span>.<span class="built_in">popen</span></span><br/></pre></td></tr></tbody></table></figure>