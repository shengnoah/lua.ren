---
layout: post
title: lua笔记 
tags: [lua文章]
categories: [topic]
---
<div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-9615043096">lua分割字符串</a></li>
</ul>
</div></div>


<h3 id="org-9615043096">lua分割字符串</h3>
<div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">ngx_find</span>    <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">re</span><span class="p">.</span><span class="n">find</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">split</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">sep</span> <span class="p">,</span> <span class="n">count</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span>

    <span class="kd">local</span> <span class="n">nfield</span><span class="p">,</span> <span class="n">nstart</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="kd">local</span> <span class="n">nfirst</span><span class="p">,</span><span class="n">nlast</span> <span class="o">=</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
    <span class="c1">-- local nfirst,nlast = ngx_find(str, sep, &#34;jo&#34;)</span>
    <span class="kr">while</span> <span class="n">nfirst</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">~=</span> <span class="mi">0</span> <span class="kr">do</span>
        <span class="n">t</span><span class="p">[</span><span class="n">nfield</span><span class="p">]</span> <span class="o">=</span> <span class="nb">string.sub</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">nstart</span><span class="p">,</span> <span class="n">nfirst</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">nfield</span> <span class="o">=</span> <span class="n">nfield</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">nstart</span> <span class="o">=</span> <span class="n">nlast</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">nfirst</span><span class="p">,</span><span class="n">nlast</span> <span class="o">=</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">nstart</span><span class="p">)</span>
        <span class="c1">-- nfirst,nlast = ngx_find(str, sep, &#34;jo&#34;, nil, nstart)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">-</span><span class="mi">1</span>
    <span class="kr">end</span>
    <span class="n">t</span><span class="p">[</span><span class="n">nfield</span><span class="p">]</span> <span class="o">=</span> <span class="nb">string.sub</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">nstart</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">t</span>
<span class="kr">end</span>
</pre></div>