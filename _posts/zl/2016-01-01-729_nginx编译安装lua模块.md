---
layout: post
title: nginx编译安装lua模块 
tags: [lua文章]
categories: [topic]
---
<h2 id="1-获取nginx源代码"><a href="#1-获取nginx源代码" class="headerlink" title="1. 获取nginx源代码"></a>1. 获取nginx源代码</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">git clone https://github.com/nginx/nginx.git nginx-release</span><br/></pre></td></tr></tbody></table></figure>
<h2 id="2-下载安装LuaJIT"><a href="#2-下载安装LuaJIT" class="headerlink" title="2. 下载安装LuaJIT"></a>2. 下载安装LuaJIT</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">git clone https://github.com/LuaJIT/LuaJIT.git</span><br/><span class="line">cd LuaJIT</span><br/><span class="line">make </span><br/><span class="line">make install</span><br/></pre></td></tr></tbody></table></figure>
<h2 id="3-下载lua-nginx-module"><a href="#3-下载lua-nginx-module" class="headerlink" title="3. 下载lua-nginx-module"></a>3. 下载lua-nginx-module</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.7.tar.gz</span><br/><span class="line">tar zxvf v0.10.7.tar.gz</span><br/></pre></td></tr></tbody></table></figure>
<p>或者<br/></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">git clone https://github.com/openresty/lua-nginx-module.git</span><br/></pre></td></tr></tbody></table></figure><p></p>
<h2 id="4-下载ngx-devel-kit"><a href="#4-下载ngx-devel-kit" class="headerlink" title="4. 下载ngx_devel_kit"></a>4. 下载ngx_devel_kit</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz</span><br/></pre></td></tr></tbody></table></figure>
<p>或者<br/></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">git clone https://github.com/simpl/ngx_devel_kit.git</span><br/></pre></td></tr></tbody></table></figure><p></p>
<h2 id="5-编译安装nginx"><a href="#5-编译安装nginx" class="headerlink" title="5. 编译安装nginx"></a>5. 编译安装nginx</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line">cd ~/opt/nginx-release/</span><br/><span class="line">./configure --prefix=/home/USERNAME/opt/nginx-1.9 --with-ld-opt=&#34;-Wl,-rpath,/usr/local/lib&#34; --add-module=/home/USERNAME/opt/nginx-module/lua-nginx-module-0.10.7 --add-module=/home/USERNAME/opt/nginx-module/ngx_devel_kit/ --with-http_stub_status_module --with-http_ssl_module --with-ipv6 --with-http_gzip_static_module --with-http_realip_module --with-http_flv_module --with-pcre-jit</span><br/><span class="line"></span><br/><span class="line">make -j4</span><br/><span class="line">make install</span><br/></pre></td></tr></tbody></table></figure>
<h2 id="6-修改nginx配置"><a href="#6-修改nginx配置" class="headerlink" title="6. 修改nginx配置"></a>6. 修改nginx配置</h2><p>在http server区域内添加如下内容<br/></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">location /hello_lua {</span><br/><span class="line">default_type &#39;text/plain&#39;;</span><br/><span class="line">content_by_lua &#39;ngx.say(&#34;hello, lua&#34;)&#39;;</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>重启nginx</p>
<h2 id="7-测试"><a href="#7-测试" class="headerlink" title="7. 测试"></a>7. 测试</h2><p>浏览器访问<code>IP/hello_lua</code>显示<br/>hello,lua  </p>
<p>nginx的lua模块安装完成。  </p>