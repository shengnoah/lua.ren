---
layout: post
title: 溪流 WarKey 3.0 论坛预览版 发布，支持Lua脚本 
tags: [lua文章]
categories: [topic]
---
<p>昨晚搞到近 2 点，终于把相关部分搞完了，放出个预览版玩玩。这一版本将支持组合键，比如，可以分别改Q、Ctrl+Q、Alt+Q 等，也将支持所有鼠标操作。此外，增加了一个脚本系统，允许用户进行更大程度上的自定义。</p>

<p><a href="http://www.cppblog.com/Files/Streamlet/xlWarKey30_preview1.rar">猛击这里下载</a></p>

<p>脚本使用 lua 语言，格式大致为（正式版出来之前可能还会有改动）：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua"><span style="color:#008000">-----------------------------------------------------------------------------</span>
<span style="color:#008000">-- SampleExtension.lua</span>
Extension =
{
    Application = <span style="color:#a31515">&#34;xlWarKey&#34;</span>, <span style="color:#008000">--请勿修改</span>
    Version = <span style="color:#a31515">&#34;3.0&#34;</span>, <span style="color:#008000">--请勿修改</span>
    NameSpace = <span style="color:#a31515">&#34;http://www.streamlet.org/api/xlwarkey/3.0&#34;</span>, <span style="color:#008000">--请勿修改</span>

    ExtensionName = <span style="color:#a31515">&#34;SampleExtension&#34;</span>, <span style="color:#008000">--请勿修改</span>
    Description = <span style="color:#a31515">&#34;This is a sample extension.&#34;</span>,

    Configuration =
    {
        setting1 = <span style="color:#008000">--设置项1（本例不使用）</span>
        {
            Type = <span style="color:#a31515">&#34;number&#34;</span>,
            Desc = <span style="color:#a31515">&#34;Please input an integer.&#34;</span>
        },
        setting2 = <span style="color:#008000">--设置项2（本例不使用）</span>
        {
            Type = <span style="color:#a31515">&#34;string&#34;</span>,
            Desc = <span style="color:#a31515">&#34;Please input a string.&#34;</span>
        }
        <span style="color:#008000">--其他设置项</span>
    },

    Entrance = <span style="color:#00f">function</span> (id) <span style="color:#008000">-- 入口函数</span>
        <span style="color:#008000">-- 所有代码都请写在这里</span>
        <span style="color:#00f">return</span> <span style="color:#00f">true</span>; <span style="color:#008000">--必须返回 true 或者 false。返回值意义目前暂未定义。</span>
    <span style="color:#00f">end</span>
};
<span style="color:#008000">----------------------------------------------------------------------------</span></code></pre></div>
<p>目前支持的 API 有：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">void PressKey(number vkcode [,
              boolean ctrl [, boolean shift [, boolean alt [, boolean win]]]])

<span style="">按下某键。</span>
<span style="">第一个参数为虚拟键码，也就是</span> Windows <span style="">的</span> VK_*<span style="">，脚本里给出了一个</span> Keys <span style="">变量，可以直接使用</span> Keys.VK_*<span style="">。其中</span> 0 - 9 <span style="">用</span> Keys.VK_0<span style="">、……、</span>Keys.VK_9<span style="">，字母键用</span> Keys.VK_A<span style="">、……、</span>Keys.VK_Z<span style="">。</span>
<span style="">后面四个表示状态键是否被按下。默认</span> <span style="color:#00f">false</span><span style="">。</span>
<span style="">若要按下</span> Ctrl+1<span style="">，可写成</span> PressKey(Keys.VK_1, <span style="color:#00f">true</span>, <span style="color:#00f">false</span>, <span style="color:#00f">false</span>, <span style="color:#00f">false</span>);
<span style="">也可简写为</span> PressKey(Keys.VK_1, <span style="color:#00f">true</span>)<span style="">。</span>


void ReleaseKey(number vkcode [,
                boolean ctrl [, boolean shift [, boolean alt [, boolean win]]]])

<span style="">同上，放开某键。</span>


void MoveMouse(number x, number y)

<span style="">移动鼠标到</span> (x, y) <span style="">位置。此坐标是相对于屏幕上最前面的那个窗口的客户区的左上角的（以后将相对于魔兽窗口）。</span>


void PressMouseButton(number button)
    button: 1 - Left
            2 - Right
            3 - XButton1
            4 - XButton2

<span style="">按下鼠标按钮</span>

 
void ReleaseMouseButton(number button)
    button: 1 - Left
            2 - Right
            3 - XButton1
            4 - XButton2

<span style="">放开鼠标按钮</span>

 

void MouseWheel(number button, number delta)
     button: 1 - VWheel
             2 - HWheel

<span style="">滚动鼠标滚轮</span>


void SetClipboard(string str)

<span style="">将一个字符串放到剪贴板</span>


string AnsiToUtf8(string ansi)

<span style="">将</span> Ansi <span style="">字符串转换为</span> UTF-8


width, height GetClientSize()

<span style="">取客户区大小。目前是取屏幕上最前面的那个窗口的客户区的大小（以后将会是魔兽窗口的大小）。</span>


x, y GetCursorPosition()

<span style="">取鼠标光标当前位置。此坐标是相对于屏幕上最前面的那个窗口的客户区的左上角的（以后将相对于魔兽窗口）。</span>


void Delay(number milliseconds)

<span style="">等待一段时间，参数的单位是毫秒。</span></code></pre></div>
<p>上面附件中的示例脚本实现了一次性扔掉物品栏所有物品的功能。请打开魔兽，然后按 Alt+1 来看效果。</p>

<p>论坛相应主题：<a href="http://forum.streamlet.org/thread-236-1-1.html">http://forum.streamlet.org/thread-236-1-1.html</a></p>

<p>介绍到此结束。</p>

<p>最后，如果有兴趣的，希望探讨下，目前的脚本格式定义是否合理，API 设置是否合理，脚本安全性如何控制，等等。</p>

<p>欢迎在下面评论中跟帖。</p>

<hr/>

<p>首发：<a href="http://www.cppblog.com/Streamlet/archive/2010/05/10/114988.html">http://www.cppblog.com/Streamlet/archive/2010/05/10/114988.html</a></p>